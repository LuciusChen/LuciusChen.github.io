<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>draft on Lucius | Braindump</title>
    <link>https://sheerwill.live/tags/draft/</link>
    <description>Recent content in draft on Lucius | Braindump</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 29 Nov 2022 16:26:44 +0800</lastBuildDate><atom:link href="https://sheerwill.live/tags/draft/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Replace text in Calibre</title>
      <link>https://sheerwill.live/posts/main/20221123120104-replace_text_in_calibre/</link>
      <pubDate>Tue, 29 Nov 2022 16:26:44 +0800</pubDate>
      
      <guid>https://sheerwill.live/posts/main/20221123120104-replace_text_in_calibre/</guid>
      <description>Readwise Reader 中无法识别中文批注版本 Epub 中的行内批注，为了更好的在 Readwise Reader 中阅读，以及当初在 Calibre 中阅读时批注，不好将批注内容很好的分地复制出来，所以需要将批注</description>
      <content:encoded><![CDATA[<p>Readwise Reader 中无法识别中文批注版本 Epub 中的行内批注，为了更好的在 Readwise Reader 中阅读，以及当初在 Calibre 中阅读时批注，不好将批注内容很好的分地复制出来，所以需要将批注的格式进行修改。</p>
<p>通过正则匹配替换内容，保留批注正文。</p>
<p><a id="table--《金瓶梅》批注替换"></a></p>
<table>
<thead>
<tr>
<th>Find Regex</th>
<th>Replace Regex</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;span class=&quot;xiu&quot;&gt;&lt;span class=&quot;ord&quot;&gt;绣&lt;span class=&quot;ord0&quot;&gt;旁&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「绣旁：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;xiu&quot;&gt;&lt;span class=&quot;ord&quot;&gt;绣&lt;span class=&quot;ord0&quot;&gt;眉&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「绣眉：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;xiu&quot;&gt;&lt;span class=&quot;ord&quot;&gt;绣&lt;span class=&quot;ord0&quot;&gt;夹&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「绣夹：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;jia&quot;&gt;&lt;span class=&quot;ord&quot;&gt;张&lt;span class=&quot;ord0&quot;&gt;旁&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「张旁：\1」</code></td>
</tr>
<tr>
<td><code>&lt;span class=&quot;jia&quot;&gt;&lt;span class=&quot;ord&quot;&gt;张&lt;span class=&quot;ord0&quot;&gt;眉&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「张眉：\1」</code></td>
</tr>
<tr>
<td><code>&lt;span class=&quot;jia&quot;&gt;&lt;span class=&quot;ord&quot;&gt;张&lt;span class=&quot;ord0&quot;&gt;夹&lt;\/span&gt;&lt;\/span&gt;(.*?)&lt;\/span&gt;</code></td>
<td><code>「张夹：\1」</code></td>
</tr>
<tr>
<td><code>&lt;div class=&quot;quote&quot;&gt;\s(&lt;p&gt;)&lt;span class=&quot;ord&quot;&gt;张&lt;span class=&quot;ord0&quot;&gt;回&lt;\/span&gt;&lt;\/span&gt;</code></td>
<td><code>\1「张回：</code></td>
</tr>
<tr>
<td><code>(&lt;\/p&gt;)\s&lt;\/div&gt;(\s&lt;p&gt;词曰)</code></td>
<td><code>」\1\2</code></td>
</tr>
<tr>
<td><code>(&lt;\/p&gt;)\s&lt;\/div&gt;(\s&lt;p&gt;诗曰)</code></td>
<td><code>」\1\2</code></td>
</tr>
<tr>
<td><code>&lt;div class=&quot;wenlong&quot;&gt;\s(&lt;p&gt;)&lt;span class=&quot;ord&quot;&gt;文&lt;span class=&quot;ord0&quot;&gt;回&lt;\/span&gt;&lt;\/span&gt;</code></td>
<td><code>\1「文回：</code></td>
</tr>
<tr>
<td><code>(&lt;\/p&gt;\s)&lt;\/div&gt;\s(&lt;\/body&gt;)</code></td>
<td><code>」\1\2</code></td>
</tr>
</tbody>
</table>
<p>这里主要用到的就是 <code>()</code> 内的内容可以用 <code>\</code> 加上数字来表示，进行保留。</p>
<p><a id="table--《红楼梦》批注替换"></a></p>
<table>
<thead>
<tr>
<th>Find Regex</th>
<th>Replace Regex</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;span class=&quot;kt&quot;&gt;&lt;img alt=&quot;庚辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00844.gif&quot;/&gt;(.*?)&lt;/span&gt;</code></td>
<td><code>「庚：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;kt&quot;&gt;&lt;img alt=&quot;甲戌本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00842.gif&quot;/&gt;(.*?)&lt;/span&gt;</code></td>
<td><code>「甲：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;kt&quot;&gt;&lt;img alt=&quot;戚序本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00845.gif&quot;/&gt;(.*?)&lt;/span&gt;</code></td>
<td><code>「戚：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;kt&quot;&gt;&lt;img alt=&quot;己卯本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00843.gif&quot;/&gt;(.*?)&lt;/span&gt;</code></td>
<td><code>「己：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;kt&quot;&gt;&lt;span class=&quot;red&quot;&gt;&lt;img alt=&quot;庚辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00844.gif&quot;/&gt;(.*?)&lt;/span&gt;&lt;/span&gt;</code></td>
<td><code>「庚：\1」</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;甲戌本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00842.gif&quot;/&gt;&lt;img alt=&quot;侧批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00851.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「甲侧：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;庚辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00844.gif&quot;/&gt;&lt;img alt=&quot;侧批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00851.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「庚侧：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;甲戌本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00842.gif&quot;/&gt;&lt;img alt=&quot;眉批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00850.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「甲眉：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;甲戌本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00842.gif&quot;/&gt;&lt;img alt=&quot;夹批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00852.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「甲夹：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;庚辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00844.gif&quot;/&gt;&lt;img alt=&quot;眉批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00850.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「庚眉：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;蒙府本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00846.gif&quot;/&gt;&lt;img alt=&quot;侧批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00851.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「蒙侧：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;庚辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00844.gif&quot;/&gt;&lt;img alt=&quot;夹批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00852.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「庚夹：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;戚序本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00845.gif&quot;/&gt;&lt;img alt=&quot;夹批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00852.gif&quot;/&gt;((?!img).*?)(&lt;/span&gt;)</code></td>
<td><code>「戚夹：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;small kt red&quot;&gt;((?!span).*?)&lt;/span&gt;</code></td>
<td><code>\1</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;x-small&quot;&gt;((?!span).*?)&lt;/span&gt;</code></td>
<td><code>\1</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;small kt&quot;&gt;((?!span).*?)&lt;/span&gt;</code></td>
<td><code>\1</code>​</td>
</tr>
<tr>
<td><code>&lt;span class=&quot;red&quot;&gt;((?!span).*?)&lt;/span&gt;</code></td>
<td><code>\1</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;戚序本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00845.gif&quot;/&gt;&lt;img alt=&quot;夹批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00852.gif&quot;/&gt;((?!img).*?)(&lt;/p&gt;)</code></td>
<td><code>「戚夹：\1」\2</code>​</td>
</tr>
<tr>
<td><code>&lt;img alt=&quot;甲辰本&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00849.gif&quot;/&gt;&lt;img alt=&quot;夹批&quot; class=&quot;font_patch&quot; src=&quot;../Images/image00852.gif&quot;/&gt;((?!img).*?)(&lt;/p&gt;)</code></td>
<td><code>「甲夹：\1」\2</code>​</td>
</tr>
</tbody>
</table>
<p>这里的 <code>(?!span)</code> 是防止出现 <code>&lt;span&gt;&lt;/span&gt;</code> 相互嵌套，导致匹配的内容并不是一个成对 HTML 标签的情况，也就是不允许 <code>&lt;span&gt;&lt;/span&gt;</code> 中存在额外的 <code>&lt;span&gt;</code> 标签。</p>
<p>红楼梦批注的 HTML 结构很乱，余者手动校对。</p>
<p>正则参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions">正则表达式 - JavaScript | MDN</a></p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
