<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Index | Lucius | Braindump</title>
<meta name="keywords" content="">
<meta name="description" content="B-Tree 和 B&#43; Tree 的不同 B-Tree B&#43;Tree All internal nodes and leaf nodes contain data pointers along with keys. Only leaf nodes contain data pointers along with keys, internal nodes contain keys only. There are no duplicate keys. Duplicate keys are present in this, all internal nodes are also present at leaves. Leaf nodes are not linked to each other. Leaf nodes are linked to each other. Sequential">
<meta name="author" content="Lucius Chen">
<link rel="canonical" href="http://localhost:1313/posts/main/20221008125127-index/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.8dd6f57454653644cba6929524e195dff93a26fa61dce2b3b2629e50b8d12816.css" integrity="sha256-jdb1dFRlNkTLppKVJOGV3/k6Jvph3OKzsmKeULjRKBY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/main/20221008125127-index/">
<script async defer data-website-id="f4e3ad0a-7fc1-4f18-b08c-9be77b60cdd5" src="https://oishii.reorx.com/oishii.js"></script>

<meta name="twitter:title" content="Index | Lucius | Braindump" />
<meta name="twitter:description" content="B-Tree 和 B&#43; Tree 的不同 B-Tree B&#43;Tree All internal nodes and leaf nodes contain data pointers along with keys. Only leaf nodes contain data pointers along with keys, internal nodes contain keys only. There are no duplicate keys. Duplicate keys are present in this, all internal nodes are also present at leaves. Leaf nodes are not linked to each other. Leaf nodes are linked to each other. Sequential" />
<meta property="og:title" content="Index | Lucius | Braindump" />
<meta property="og:description" content="B-Tree 和 B&#43; Tree 的不同 B-Tree B&#43;Tree All internal nodes and leaf nodes contain data pointers along with keys. Only leaf nodes contain data pointers along with keys, internal nodes contain keys only. There are no duplicate keys. Duplicate keys are present in this, all internal nodes are also present at leaves. Leaf nodes are not linked to each other. Leaf nodes are linked to each other. Sequential" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/main/20221008125127-index/" />
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2022-12-04T11:09:00&#43;08:00" />
  <meta property="article:modified_time" content="2022-12-04T11:09:00&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Index",
      "item": "http://localhost:1313/posts/main/20221008125127-index/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Index | Lucius | Braindump",
  "name": "Index",
  "description": "B-Tree 和 B+ Tree 的不同 B-Tree B+Tree All internal nodes and leaf nodes contain data pointers along with keys. Only leaf nodes contain data pointers along with keys, internal nodes contain keys only. There are no duplicate keys. Duplicate keys are present in this, all internal nodes are also present at leaves. Leaf nodes are not linked to each other. Leaf nodes are linked to each other. Sequential",
  "keywords": [
    
  ],
  "wordCount" : "1749",
  "inLanguage": "en",
  "datePublished": "2022-12-04T11:09:00+08:00",
  "dateModified": "2022-12-04T11:09:00+08:00",
  "author":[{
    "@type": "Person",
    "name": "Lucius Chen"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/main/20221008125127-index/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lucius | Braindump",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script><style>
  #icons {
    display: flex;
    flex-wrap: wrap;
    margin-top: 2em;
  }
  #icons .item {
    width: 80px;
    height: 50px;
    margin: 10px;
  }
  #icons .item .name {
    font-size: 12px;
    user-select: all;
    text-align: center;
  }
  #icons .item .icon {
    display: flex;
    justify-content: center;
  }
  #icons .item svg {
    width: 30px;
    height: 30px;
  }
</style>


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Lucius | Braindump (Alt + H)">Lucius | Braindump</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/tags/" title="Tags"
                >Tags
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archive"
                >Archive
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >Search
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">Index</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>December 4, 2022</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path><polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline><line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line><line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line><polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline></svg>
  <span>1749 words</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>4 min</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#b-tree-%e5%92%8c-b-plus-tree-%e7%9a%84%e4%b8%8d%e5%90%8c" aria-label="B-Tree 和 B&#43; Tree 的不同">B-Tree 和 B+ Tree 的不同</a></li>
                <li>
                    <a href="#%e5%a0%86%e8%a1%a8--heaps-table-without-clustered-indexes" aria-label="堆表 (Heaps: Table without Clustered Indexes)">堆表 (Heaps: Table without Clustered Indexes)</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e7%bb%84%e7%bb%87%e8%a1%a8--clustered-indexes-index-organized-tables-iot" aria-label="索引组织表 (Clustered Indexes / Index Organized Tables (IOT))">索引组织表 (Clustered Indexes / Index Organized Tables (IOT))</a><ul>
                        
                <li>
                    <a href="#%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95" aria-label="聚簇索引">聚簇索引</a></li>
                <li>
                    <a href="#%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95" aria-label="二级索引">二级索引</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e7%bb%84%e7%bb%87%e8%a1%a8%e7%9a%84%e5%a5%bd%e5%a4%84" aria-label="索引组织表的好处">索引组织表的好处</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e7%bb%84%e7%bb%87%e8%a1%a8%e7%9a%84%e7%bc%ba%e7%82%b9" aria-label="索引组织表的缺点">索引组织表的缺点</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%90%84%e5%b8%b8%e7%94%a8%e7%9a%84%e5%85%b3%e7%b3%bb%e5%9e%8b%e6%95%b0%e6%8d%ae%e5%ba%93%e7%b4%a2%e5%bc%95%e7%b1%bb%e5%9e%8b" aria-label="各常用的关系型数据库索引类型">各常用的关系型数据库索引类型</a><ul>
                        
                <li>
                    <a href="#mysql" aria-label="MySQL">MySQL</a></li>
                <li>
                    <a href="#oracle-database" aria-label="Oracle Database">Oracle Database</a></li>
                <li>
                    <a href="#postgresql" aria-label="PostgreSQL">PostgreSQL</a></li>
                <li>
                    <a href="#sql-server" aria-label="SQL Server">SQL Server</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95--concatenated-indexes" aria-label="联合索引 (Concatenated Indexes)">联合索引 (Concatenated Indexes)</a></li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="b-tree-和-b-plus-tree-的不同">B-Tree 和 B+ Tree 的不同<a hidden class="anchor" aria-hidden="true" href="#b-tree-和-b-plus-tree-的不同">¶</a></h2>
<table>
<thead>
<tr>
<th>B-Tree</th>
<th>B+Tree</th>
</tr>
</thead>
<tbody>
<tr>
<td>All internal nodes and leaf nodes contain data pointers along with keys.</td>
<td>Only leaf nodes contain data pointers along with keys, internal nodes contain keys only.</td>
</tr>
<tr>
<td>There are no duplicate keys.</td>
<td>Duplicate keys are present in this, all internal nodes are also present at leaves.</td>
</tr>
<tr>
<td>Leaf nodes are not linked to each other.</td>
<td>Leaf nodes are linked to each other.</td>
</tr>
<tr>
<td>Sequential access of nodes is not possible.</td>
<td>All nodes are present at leaves, so sequential access is possible just like a linked list.</td>
</tr>
<tr>
<td>Searching for a key is slower.</td>
<td>Searching is faster.</td>
</tr>
<tr>
<td>For a particular number of entries, the height of the B-tree is larger.</td>
<td>The height of the B+ tree is lesser than B-tree for the same number of entries.</td>
</tr>
</tbody>
</table>
<h2 id="堆表--heaps-table-without-clustered-indexes">堆表 (Heaps: Table without Clustered Indexes)<a hidden class="anchor" aria-hidden="true" href="#堆表--heaps-table-without-clustered-indexes">¶</a></h2>
<blockquote>
<p>A heap is a table without a clustered index. One or more nonclustered indexes can be created on tables stored as a heap. Data is stored in the heap without specifying an order. Usually data is initially stored in the order in which is the rows are inserted into the table, but the Database Engine can move data around in the heap to store the rows efficiently; so the data order cannot be predicted. To guarantee the order of rows returned from a heap, you must use the ORDER BY clause. To specify a permanent logical order for storing the rows, create a clustered index on the table, so that the table is not a heap.</p>
</blockquote>
<p>堆表就是含有一列或者多列无聚簇索引的表，其中的数据存储无序。通常数据是按照初始化的顺序存储，但数据库引擎会为了更高效的数据插入，将原有数据移动到别处来释放空间给新的数据。因此，数据的顺序是不确定的，为了保证数据的顺序，可以在查询的时候使用 <code>ORDER BY</code> 关键字进行排序。要保证数据物理存储的数据，就需要建立聚簇索引，这个时候就不是堆表了。</p>
<blockquote>
<p>When a table is stored as a heap, individual rows are identified by reference to an 8-byte row identifier (RID) consisting of the file number, data page number, and slot on the page (FileID:PageID:SlotID). The row ID is a small and efficient structure.</p>
</blockquote>
<p>ROWID 是文件编号、数据页编号以及页面上的卡槽组成。(FileID:PageID:SlotID)</p>
<figure>
    <img loading="lazy" src="/ox-hugo/b-tree-structure.png"
         alt="Figure 1: b-tree-structure"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>b-tree-structure</p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="/ox-hugo/index-based-access-on-a-heap-table.png"
         alt="Figure 2: index-based-access-on-a-heap-table"/> <figcaption>
            <p><span class="figure-number">Figure 2: </span>index-based-access-on-a-heap-table</p>
        </figcaption>
</figure>

<p>B-Tree 的上级 leaf nodes 存储的是下级 leaf nodes 中列值的最大值，可以从图中看出最底层的 leaf nodes 存储的是 ROWID，可以据此查找到堆表中的位置。</p>
<h2 id="索引组织表--clustered-indexes-index-organized-tables-iot">索引组织表 (Clustered Indexes / Index Organized Tables (IOT))<a hidden class="anchor" aria-hidden="true" href="#索引组织表--clustered-indexes-index-organized-tables-iot">¶</a></h2>
<blockquote>
<p>Some databases can indeed use an index as primary table store. The Oracle database calls this concept index-organized tables (IOT), other databases use the term clustered index. In this section, both terms are used to either put the emphasis on the table or the index characteristics as needed.</p>
<p>An index-organized table is thus a B-tree index without a heap table. This results in two benefits: (1) it saves the space for the heap structure; (2) every access on a clustered index is automatically an index-only scan.</p>
</blockquote>
<p>索引组织表以主键顺序组织物理数据存储，索引结构中的每个叶节点（leaf nodes）都存储着完整的行数据。对应的主键被称为聚簇索引（Clustered Indexes），除此之外的索引称为二级索引（Secondary Indexes）。</p>
<figure>
    <img loading="lazy" src="/ox-hugo/secondary-index-on-an-IOT.png"
         alt="Figure 3: secondary-index-on-an-IOT"/> <figcaption>
            <p><span class="figure-number">Figure 3: </span>secondary-index-on-an-IOT</p>
        </figcaption>
</figure>

<h3 id="聚簇索引">聚簇索引<a hidden class="anchor" aria-hidden="true" href="#聚簇索引">¶</a></h3>
<ul>
<li>在 MySQL 中通常主键即为「聚簇索引」；若没有定义主键，则第一个 <code>NOT NULL UNIQUE</code> 列是聚集索引；若没有 <code>NOT NULL UNIQUE</code> 列，InnoDB 会创建一个隐藏的 row-id 作为聚集索引。</li>
<li>聚簇索引是按照索引顺序对物理记录排序，存储完整的行记录。</li>
</ul>
<h3 id="二级索引">二级索引<a hidden class="anchor" aria-hidden="true" href="#二级索引">¶</a></h3>
<ul>
<li>除主键外的其他列上新建的索引都是二级索引。</li>
<li>二级索引的排序与物理记录的排序不一致，存储的是该列本身排序后的值和主键。</li>
</ul>
<h3 id="索引组织表的好处">索引组织表的好处<a hidden class="anchor" aria-hidden="true" href="#索引组织表的好处">¶</a></h3>
<ul>
<li>可以节省堆表占用的空间</li>
<li>访问聚簇索引可以直接获取数据（即「覆盖索引」）</li>
<li>二级索引需要回表，即需要根据二级索引的叶节点内的主键，再对主键形成的聚簇索引进行遍历，查找到具体的记录。</li>
</ul>
<h3 id="索引组织表的缺点">索引组织表的缺点<a hidden class="anchor" aria-hidden="true" href="#索引组织表的缺点">¶</a></h3>
<p>图 <code>secondary-index-on-an-IOT</code> 就是索引组织表中，二级索引获取数据的流程。再次根据主键在索引组织表中遍历查找就叫做「回表」。</p>
<h2 id="各常用的关系型数据库索引类型">各常用的关系型数据库索引类型<a hidden class="anchor" aria-hidden="true" href="#各常用的关系型数据库索引类型">¶</a></h2>
<h3 id="mysql">MySQL<a hidden class="anchor" aria-hidden="true" href="#mysql">¶</a></h3>
<p>The MyISAM engine only uses heap tables while the InnoDB engine always uses clustered indexes. That means you do not directly have a choice.</p>
<h3 id="oracle-database">Oracle Database<a hidden class="anchor" aria-hidden="true" href="#oracle-database">¶</a></h3>
<p>The Oracle database uses heap tables by default. Index-organized tables can be created using the ORGANIZATION INDEX clause:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w"> </span><span class="p">[...]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ORGANIZATION</span><span class="w"> </span><span class="k">INDEX</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>The Oracle database always uses the primary key as the clustering key.</p>
<h3 id="postgresql">PostgreSQL<a hidden class="anchor" aria-hidden="true" href="#postgresql">¶</a></h3>
<p>PostgreSQL only uses heap tables.</p>
<p>You can, however, use the CLUSTER clause to align the contents of the heap table with an index.</p>
<h3 id="sql-server">SQL Server<a hidden class="anchor" aria-hidden="true" href="#sql-server">¶</a></h3>
<p>By default SQL Server uses clustered indexes (index-organized tables) using the primary key as clustering key. Nevertheless you can use arbitrary columns for the clustering key—even non-unique columns.</p>
<p>To create a heap table you must use the NONCLUSTERED clause in the primary key definition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="p">[...]</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>Dropping a clustered index transforms the table into a heap table.</p>
<p>SQL Server’s default behavior often causes performance problems when using secondary indexes.</p>
<h2 id="联合索引--concatenated-indexes">联合索引 (Concatenated Indexes)<a hidden class="anchor" aria-hidden="true" href="#联合索引--concatenated-indexes">¶</a></h2>
<p>联合索引遵循「最左匹配原则（Leftmost Index Prefixes）」，MySQL 联合索引创建的时候会对 (a, b) 其中的 a 先进行排序，再在 a 的基础上对 b 进行排序。如果是 (a, b, c) 也是一样的方式。</p>
<figure>
    <img loading="lazy" src="/ox-hugo/concatenated-index.png"
         alt="Figure 4: concatenated-indexes"/> <figcaption>
            <p><span class="figure-number">Figure 4: </span>concatenated-indexes</p>
        </figcaption>
</figure>

<p>因此，判断是否符合「最左匹配原则」，是否能够使用索引，可以根据底层的索引实现逻辑来进行判断。即，按照创建索引时的顺序，联合索引中的第一个字段是有序的，一旦第一个字段确定值，那么第二个字段也是有序的，以此类推，有序即可用索引，否则不行。</p>
<ul>
<li><code>&lt;,&gt;</code> 和 <code>BETWEEN</code> 可以用索引，但是按照上述的逻辑，范围查询字段后的索引字段就无法用上索引，因为范围查询字段的值并没有确定，后续的字段就是无序的。</li>
<li><code>LIKE</code> 在 <code>&quot;a%&quot;</code> 这种右匹配时，会在索引是按照字母排序的情况下用上索引（% 左侧字符合适的情况下也可以建立前缀索引）。至于左匹配和全匹配，按照上述的逻辑，完全是无序的，无法使用索引。</li>
<li><code>WHERE b = ? AND a = ? AND c = ?</code> 这种颠倒了顺序的 SQL 是不影响「最左匹配原则」的，数据库执行前，解释器会对其重新排序优化。</li>
</ul>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">¶</a></h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/sql/relational-databases/indexes/heaps-tables-without-clustered-indexes?view=sql-server-ver16">Heaps (Tables without Clustered Indexes) - SQL Server | Microsoft Learn</a></li>
<li>Markus Winand (2012) SQL Performance Explained Everything Developers Need to Know about SQL Performance</li>
</ul>


    


   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   
	  
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

<hr>

  <div class="bl-section">
	<h4 style="color: var(--secondary);">Links to this note</h4>
	<div class="backlinks">
	  <ul>
	   
		  <li><a href="/posts/main/20220530185321-database/">Database</a></li>
	   
	 </ul>
	</div>
  </div>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/main/20221123120104-replace_text_in_calibre/">
    <span class="title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline></svg>&nbsp;Prev Page</span>
    <br>
    <span>Replace text in Calibre</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/main/20221019183132-mvcc/">
    <span class="title">Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg>
    </span>
    <br>
    <span>MVCC</span>
  </a>
</nav>

  </footer>
    <div class="comments-separator"></div>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2024 <a href="http://localhost:1313/">Lucius | Braindump</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>

<script src="/js/instantclick.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
</body>

</html>
