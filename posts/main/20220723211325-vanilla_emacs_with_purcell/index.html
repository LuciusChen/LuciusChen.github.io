<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Vanilla Emacs with Purcell | Lucius | Braindump</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融">
<meta name="author" content="Lucius Chen">
<link rel="canonical" href="https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.d51409937a6a45d5e89ac8501ed6d76be67500909282d7c628421c2c66c23074.css" integrity="sha256-1RQJk3pqRdXomshQHtbXa&#43;Z1AJCSgtfGKEIcLGbCMHQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://sheerwill.live/favicon.ico">
<link rel="apple-touch-icon" href="https://sheerwill.live/apple-touch-icon.png">
<script async defer data-website-id="f4e3ad0a-7fc1-4f18-b08c-9be77b60cdd5" src="https://oishii.reorx.com/oishii.js"></script>

<meta name="twitter:title" content="Vanilla Emacs with Purcell | Lucius | Braindump" />
<meta name="twitter:description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融" />
<meta property="og:title" content="Vanilla Emacs with Purcell | Lucius | Braindump" />
<meta property="og:description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/" />
<meta property="article:section" content="posts" />
  
  <meta property="article:modified_time" content="2022-09-24T12:49:05&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://sheerwill.live/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Vanilla Emacs with Purcell",
      "item": "https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Vanilla Emacs with Purcell | Lucius | Braindump",
  "name": "Vanilla Emacs with Purcell",
  "description": "Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融",
  "keywords": [
    
  ],
  "wordCount" : "10794",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "2022-09-24T12:49:05+08:00",
  "author":[{
    "@type": "Person",
    "name": "Lucius Chen"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lucius | Braindump",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sheerwill.live/favicon.ico"
    }
  }
}
</script><style>
  #icons {
    display: flex;
    flex-wrap: wrap;
    margin-top: 2em;
  }
  #icons .item {
    width: 80px;
    height: 50px;
    margin: 10px;
  }
  #icons .item .name {
    font-size: 12px;
    user-select: all;
    text-align: center;
  }
  #icons .item .icon {
    display: flex;
    justify-content: center;
  }
  #icons .item svg {
    width: 30px;
    height: 30px;
  }
</style>


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://sheerwill.live/" accesskey="h" title="Lucius | Braindump (Alt + H)">Lucius | Braindump</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        
        <ul id="menu">
            <li>
                <a href="https://sheerwill.live/tags/" title="Tags"
                >Tags
                </a>
            </li>
            <li>
                <a href="https://sheerwill.live/archives/" title="Archive"
                >Archive
                </a>
            </li>
            <li>
                <a href="https://sheerwill.live/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >Search
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">Vanilla Emacs with Purcell</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>September 24, 2022</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path><polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline><line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line><line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line><polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline></svg>
  <span>10794 words</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>22 min</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#install-emacs-plus-with-homebrew" aria-label="Install Emacs-plus With Homebrew">Install Emacs-plus With Homebrew</a></li>
                <li>
                    <a href="#workflow" aria-label="Workflow">Workflow</a><ul>
                        
                <li>
                    <a href="#gtd" aria-label="GTD">GTD</a><ul>
                        
                <li>
                    <a href="#capture" aria-label="Capture">Capture</a></li>
                <li>
                    <a href="#clarify" aria-label="Clarify">Clarify</a></li>
                <li>
                    <a href="#organize" aria-label="Organize">Organize</a></li>
                <li>
                    <a href="#reflect" aria-label="Reflect">Reflect</a></li>
                <li>
                    <a href="#engage" aria-label="Engage">Engage</a></li></ul>
                </li>
                <li>
                    <a href="#note-taking" aria-label="Note taking">Note taking</a><ul>
                        
                <li>
                    <a href="#book" aria-label="Book">Book</a></li>
                <li>
                    <a href="#daily-log" aria-label="Daily log">Daily log</a></li>
                <li>
                    <a href="#articles-work" aria-label="Articles/Work">Articles/Work</a></li>
                <li>
                    <a href="#export" aria-label="Export">Export</a></li>
                <li>
                    <a href="#org-roam-ui" aria-label="org-roam-ui">org-roam-ui</a></li></ul>
                </li>
                <li>
                    <a href="#scanned-document-management" aria-label="Scanned Document Management">Scanned Document Management</a></li></ul>
                </li>
                <li>
                    <a href="#personal-settings" aria-label="Personal Settings">Personal Settings</a><ul>
                        
                <li>
                    <a href="#ligature-dot-el" aria-label="ligature.el">ligature.el</a></li>
                <li>
                    <a href="#init-org-dot-el" aria-label="init-org.el">init-org.el</a><ul>
                        
                <li>
                    <a href="#org-babel" aria-label="Org-babel">Org-babel</a></li>
                <li>
                    <a href="#plantuml" aria-label="PlantUML">PlantUML</a></li></ul>
                </li>
                <li>
                    <a href="#init-sis-dot-el" aria-label="init-sis.el">init-sis.el</a></li>
                <li>
                    <a href="#init-font-dot-el" aria-label="init-font.el">init-font.el</a></li>
                <li>
                    <a href="#init-ebib-dot-el" aria-label="init-ebib.el">init-ebib.el</a></li>
                <li>
                    <a href="#init-meow-dot-el" aria-label="init-meow.el">init-meow.el</a></li>
                <li>
                    <a href="#beancount-dot-el" aria-label="beancount.el">beancount.el</a></li>
                <li>
                    <a href="#init-epla-dot-el" aria-label="init-epla.el">init-epla.el</a></li>
                <li>
                    <a href="#init-local-dot-el" aria-label="init-local.el">init-local.el</a><ul>
                        
                <li>
                    <a href="#consult" aria-label="Consult">Consult</a></li>
                <li>
                    <a href="#deft" aria-label="Deft">Deft</a></li>
                <li>
                    <a href="#ox-hugo" aria-label="Ox-hugo">Ox-hugo</a></li>
                <li>
                    <a href="#latex--auctex-plus-cdlatex" aria-label="Latex(auctex &#43; cdlatex)">Latex(auctex + cdlatex)</a></li></ul>
                </li>
                <li>
                    <a href="#init-corfu-dot-el" aria-label="init-corfu.el">init-corfu.el</a></li>
                <li>
                    <a href="#init-themes-dot-el" aria-label="init-themes.el">init-themes.el</a></li>
                <li>
                    <a href="#init-elfeed-dot-el" aria-label="init-elfeed.el">init-elfeed.el</a></li>
                <li>
                    <a href="#init-telega-dot-el" aria-label="init-telega.el">init-telega.el</a></li>
                <li>
                    <a href="#init-org-modern-dot-el" aria-label="init-org-modern.el">init-org-modern.el</a></li>
                <li>
                    <a href="#init-quick-menus-dot-el" aria-label="init-quick-menus.el">init-quick-menus.el</a></li>
                <li>
                    <a href="#init-tree-sitter-dot-el" aria-label="init-tree-sitter.el">init-tree-sitter.el</a></li>
                <li>
                    <a href="#init-org-enhance-dot-el" aria-label="init-org-enhance.el">init-org-enhance.el</a></li></ul>
                </li>
                <li>
                    <a href="#export" aria-label="Export">Export</a><ul>
                        
                <li>
                    <a href="#markdown-file" aria-label="Markdown file">Markdown file</a></li>
                <li>
                    <a href="#hugo" aria-label="Hugo">Hugo</a></li>
                <li>
                    <a href="#latex" aria-label="Latex">Latex</a><ul>
                        
                <li>
                    <a href="#dependency" aria-label="Dependency">Dependency</a></li>
                <li>
                    <a href="#latex-%e8%af%ad%e6%b3%95" aria-label="Latex 语法">Latex 语法</a></li>
                <li>
                    <a href="#pdf-%e5%af%bc%e5%87%ba%e6%8a%a5%e9%94%99" aria-label="PDF 导出报错">PDF 导出报错</a></li>
                <li>
                    <a href="#%e4%b8%ad%e6%96%87-pdf-%e5%af%bc%e5%87%ba%e8%ae%be%e7%bd%ae" aria-label="中文 PDF 导出设置">中文 PDF 导出设置</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">¶</a></h2>
<blockquote>
<p>Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish.</p>
<p>– Neal Stephenson, In the Beginning was the Command Line (1998)</p>
</blockquote>
<h2 id="install-emacs-plus-with-homebrew">Install Emacs-plus With Homebrew<a hidden class="anchor" aria-hidden="true" href="#install-emacs-plus-with-homebrew">¶</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew tap d12frosted/emacs-plus
</span></span><span class="line"><span class="cl">brew install emacs-plus --with-native-comp --with-modern-vscode-icon
</span></span><span class="line"><span class="cl">ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications
</span></span></code></pre></div><h2 id="workflow">Workflow<a hidden class="anchor" aria-hidden="true" href="#workflow">¶</a></h2>
<figure>
    <img loading="lazy" src="/ox-hugo/workflow.png"
         alt="Figure 1: workflow"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>workflow</p>
        </figcaption>
</figure>

<p>如上图所示，融合了笔记和 GTD 管理。</p>
<h3 id="gtd">GTD<a hidden class="anchor" aria-hidden="true" href="#gtd">¶</a></h3>
<h4 id="capture">Capture<a hidden class="anchor" aria-hidden="true" href="#capture">¶</a></h4>
<p>To-Dos 分为的来源分为六种：</p>
<ul>
<li>Habit Track: 即对于重复事件的循环，有利于习惯的养成。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li>Cyclic Tasks: 需要循环的任务。
<ul>
<li>生日提醒</li>
<li>周报</li>
<li>每日回顾</li>
<li>稍后读</li>
<li>etc.</li>
</ul>
</li>
<li>Inbox: 用来收集各种 To-Dos，设置的快捷键为 <code>C-c c</code>​。每日回顾的时候分发到各自的分类，并行进行 Scheduled。
<ul>
<li>personal: 个人事宜</li>
<li>someday: 存放一些不知道什么时候会做的 To-Dos，有时间回顾的时候再次分类。</li>
<li>technical: 存放个人需要偿还的技术债</li>
<li>work: 工作相关</li>
</ul>
</li>
<li>books: 阅读的书籍，通过 ebib 的 <code>ebib-add-reading-list-item</code> 添加。</li>
<li>Dynamic: 只要是 org 文件中的有 To-Dos，就会在保存文件时，自动给文件添加 <code>:dynamic:</code> 标签，纳入到 Agenda 文件中。</li>
<li>note: 对一些地方的备注或者 To-Dos，后者和 Dynamic To-Dos 场景重复。</li>
</ul>
<h4 id="clarify">Clarify<a hidden class="anchor" aria-hidden="true" href="#clarify">¶</a></h4>
<p>对 Inbox 当中的 To-Dos 进行分发，并用关键字标记 To-Dos 的属性，比如 <code>PROJECT</code>, <code>DELEGRTED</code> 等。对于 <code>PROJECT</code> 这类还要继续分解。</p>
<h4 id="organize">Organize<a hidden class="anchor" aria-hidden="true" href="#organize">¶</a></h4>
<p>对明天需要做的或知道明确日期的 To-Dos 进行 Scheduled，对于 <code>DONE</code> 或 <code>CANCELLED</code> 的 To-Dos 会自动复制到今日的 Daily log 当中，这样呈现的结果，其实和 Logseq 中在 Journals 里面管理 To-Dos 是一致的。</p>
<p>不过实现的过程，或者说内在逻辑是不一样的。在 Logseq 的 Journals 中管理 To-Dos 即便是通过查询汇聚展示 To-Dos 也没有 agenda 中这么灵活，另外前几天定下的需要后面完成的 To-Dos 有两种管理方式：1. 将 To-Dos 链接到需要做的某天，自动展示。这样的操作确实方便，但使得各种关联杂乱。2. 将 To-Dos 移动到对应需要做的某天。</p>
<p>上面说的呈现结果一致，就是指的第二种，回顾起来也非常清晰。在 org-roam 配合 agenda 使用中，To-Dos 有了单独的收集仓库，整理分发。也可以通过自定义的函数在 agenda 和 org-roam 之间联动，比如对于 <code>DONE</code> 或 <code>CANCELLED</code> 的 To-Dos 会自动复制到今日的 Daily log 当中，比如 org-roam 中的 To-Dos 也会呈现在 agenda view 中，完成后也会自动复制到 Daily log 中。</p>
<p>整体上来讲，内在逻辑 agenda 和 org-roam 配合起来更加清晰，灵活。</p>
<h4 id="reflect">Reflect<a hidden class="anchor" aria-hidden="true" href="#reflect">¶</a></h4>
<p>回顾所有的 To-Dos，选取明天或者近期需要完成。对已完成或取消的 To-Dos 归档，是按照结构<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>归档到同级别 <code>*.org</code> 文件的 <code>archive</code> 文件夹下的同名文件中。</p>
<p>同时，要回顾一下 Notes 当中的对某处的笔记或设定的 To-Dos。</p>
<h4 id="engage">Engage<a hidden class="anchor" aria-hidden="true" href="#engage">¶</a></h4>
<p>按照重要，简单等因素顺序执行需要做的 To-Dos</p>
<h3 id="note-taking">Note taking<a hidden class="anchor" aria-hidden="true" href="#note-taking">¶</a></h3>
<p>输入源分为工作、书籍和文章（来自于 RSS、Newsletter、Twitter 等平台）。</p>
<h4 id="book">Book<a hidden class="anchor" aria-hidden="true" href="#book">¶</a></h4>
<p>PDF 以及 Epub 格式的书籍或者论文通过 Ebib 管理 Bibtex，Ebib 的 <code>ebib-reading-list-file</code> 设置为 Agenda 中的 <code>books.org</code>​，这样就可以很方便新建任务到 <code>book.org</code> 在 Agenda View 中看到自己当前在阅读的书籍/论文，并查看进度。</p>
<p>书籍/论文对应的笔记则是在 <code>references</code> 文件夹下，可以方便笔记中进行引用。</p>
<p>书籍除了 ebib 管理的 bibtex 汇总可以查看，还通过 Dynamic Table 进行管理，这样可以更加直观的看到书籍的评价以及关联到读书笔记。（其实 ebib 那里也可以关联到笔记，毕竟笔记的创建就是利用 ebib 的命令，连接在 external note 这个字段中。）</p>
<p>文件顶部这样设置即可，根据自己的情况进行修改适配，其中 <code>file</code> 是指数据源，这里就是将数据源放在与表格同一个文件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+title</span><span class="c">: Book reviews</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+COLUMNS</span><span class="c">: %25ITEM(书名) %10AUTHOR(Author) %10CATEGORY(Category) %15STATE(State) %15SCORE(Score) %10VERSION(Version) %15REMARK(Remark) %25NOTELINK(Notelink)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cs">#+BEGIN</span><span class="c">: columnview :hlines 1 :id &#34;file:~/Dropbox/org/references/Book-Reviews.org&#34; :skip-empty-rows t</span>
</span></span><span class="line"><span class="cl">#+END
</span></span></code></pre></div><p>统计的 <code>COLUMNS</code> 来自与 Head 的 Properties，两者要一一对应，如此都设置好了之后在表格处（columnview 那里）按 <code>C-c C-c</code> 生成表格，即 Dynamic Table。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="c">:PROPERTIES:
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="cs">:Author: 作者
</span></span></span><span class="line"><span class="cl"><span class="cs">:Category: 分类
</span></span></span><span class="line"><span class="cl"><span class="cs">:Score: 9.7
</span></span></span><span class="line"><span class="cl"><span class="cs">:State: Reading
</span></span></span><span class="line"><span class="cl"><span class="cs">:Version: 版本
</span></span></span><span class="line"><span class="cl"><span class="cs">:Remark:
</span></span></span><span class="line"><span class="cl"><span class="cs">:Notelink: [[id:xxx][笔记名称]]
</span></span></span><span class="line"><span class="cl"><span class="cs"></span><span class="c">:END:</span>
</span></span></code></pre></div><h4 id="daily-log">Daily log<a hidden class="anchor" aria-hidden="true" href="#daily-log">¶</a></h4>
<p>每个 Daily log 文件头部都有 <code>#+ARCHIVE: journal.org::</code> 来控制归档的位置，每天回顾完当天的 log 就归档到 <code>journal.org</code> 文件中，如果后续这个文件太大，还可以按照年份来继续归档。</p>
<p>而且在 <code>journal.org</code> 中通过 <code>C-c \</code> 可以查看所有的 tags，选择对应的 tag 就可以过滤出想要的内容，其他内容全部收缩。</p>
<h4 id="articles-work">Articles/Work<a hidden class="anchor" aria-hidden="true" href="#articles-work">¶</a></h4>
<p>文章的阅读笔记是放在 Daily log 当中的，在 What I read? 的标题下，打上对应的 tags。后期回顾的时候，或者积累一定数量的同类型、同话题文章，可能会 refile 到 org-roam 内进行总结，形成知识点。</p>
<p>工作中的事情都是记在 Daily log 中，每条 log 有明确的时间。</p>
<p>对于问题的解决，有详细的原因和解决方案，后续遇到同样的问题可以参考之前的思路；对于与他人沟通的内容，有详细的操作记录、数据记录以及邮件聊天等记录链接或截图，有背锅风险时可以轻松应对。</p>
<p>同样的，工作中某个类型的知识点的笔记积累多了，会在 org-roam 中进行总结，形成知识点。</p>
<h4 id="export">Export<a hidden class="anchor" aria-hidden="true" href="#export">¶</a></h4>
<p>输出是 org 的强项，Hugo 方便与人在线分享，PDF/Markdown 离线分享。</p>
<h4 id="org-roam-ui">org-roam-ui<a hidden class="anchor" aria-hidden="true" href="#org-roam-ui">¶</a></h4>
<p>方便的查看笔记之间的关系，进行系统性回顾。</p>
<h3 id="scanned-document-management">Scanned Document Management<a hidden class="anchor" aria-hidden="true" href="#scanned-document-management">¶</a></h3>
<p>扫描件都是通过 <code>org-attach</code> 包辅助管理，主要就是将扫描件的主要内容手工录入，便于后期文件搜索，源文件作为附件用 <code>org-attach</code> 管理，存放在文本同目录下的 <code>data</code> 文件夹下，按照 <code>org-attach</code> 生成的 ID 存放。</p>
<p>Daily Log 当中一些很长的文件、执行脚本、代码等也可以通过相同的方式进行管理，减少 <code>Journal.org</code> 的体积，减少分割次数。</p>
<h2 id="personal-settings">Personal Settings<a hidden class="anchor" aria-hidden="true" href="#personal-settings">¶</a></h2>
<p>目前在 <a href="https://github.com/purcell/emacs.d">purcell</a> 中就增加或修改了这些文件。</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">.
├── lisp
    ├── ligature.el
    ├── init-org.el
    ├── init-sis.el
    ├── init-font.el
    ├── init-ebib.el
    ├── init-meow.el
    ├── beancount.el
    ├── init-elpa.el
    ├── init-local.el
    ├── init-corfu.el
    ├── init-themes.el
    ├── init-elfeed.el
    ├── init-telega.el
    ├── init-org-modern.el
    ├── init-quick-menus.el
    ├── init-tree-sitter.el
    └── init-org-enhance.el
</code></pre><h3 id="ligature-dot-el">ligature.el<a hidden class="anchor" aria-hidden="true" href="#ligature-dot-el">¶</a></h3>
<p><a href="https://github.com/mickeynp/ligature.el">GitHub - mickeynp/ligature.el: Display typographical ligatures in Emacs</a>，这里是将其中的 <code>ligature.el</code> 下载到 <code>.emacs.d/lisp/</code> 目录下，加上下列代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;; Enable the www ligature in every possible major mode</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">ligature-set-ligatures</span> <span class="ss">&#39;t</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;www&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Enable ligatures in programming modes</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">ligature-set-ligatures</span> <span class="ss">&#39;prog-mode</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;www&#34;</span> <span class="s">&#34;**&#34;</span> <span class="s">&#34;***&#34;</span> <span class="s">&#34;**/&#34;</span> <span class="s">&#34;*&gt;&#34;</span> <span class="s">&#34;*/&#34;</span> <span class="s">&#34;\\\\&#34;</span> <span class="s">&#34;\\\\\\&#34;</span> <span class="s">&#34;{-&#34;</span> <span class="s">&#34;::&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;:::&#34;</span> <span class="s">&#34;:=&#34;</span> <span class="s">&#34;!!&#34;</span> <span class="s">&#34;!=&#34;</span> <span class="s">&#34;!==&#34;</span> <span class="s">&#34;-}&#34;</span> <span class="s">&#34;----&#34;</span> <span class="s">&#34;--&gt;&#34;</span> <span class="s">&#34;-&gt;&#34;</span> <span class="s">&#34;-&gt;&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;-&lt;&#34;</span> <span class="s">&#34;-&lt;&lt;&#34;</span> <span class="s">&#34;-~&#34;</span> <span class="s">&#34;#{&#34;</span> <span class="s">&#34;#[&#34;</span> <span class="s">&#34;##&#34;</span> <span class="s">&#34;###&#34;</span> <span class="s">&#34;####&#34;</span> <span class="s">&#34;#(&#34;</span> <span class="s">&#34;#?&#34;</span> <span class="s">&#34;#_&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;#_(&#34;</span> <span class="s">&#34;.-&#34;</span> <span class="s">&#34;.=&#34;</span> <span class="s">&#34;..&#34;</span> <span class="s">&#34;..&lt;&#34;</span> <span class="s">&#34;...&#34;</span> <span class="s">&#34;?=&#34;</span> <span class="s">&#34;??&#34;</span> <span class="s">&#34;;;&#34;</span> <span class="s">&#34;/*&#34;</span> <span class="s">&#34;/**&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;/=&#34;</span> <span class="s">&#34;/==&#34;</span> <span class="s">&#34;/&gt;&#34;</span> <span class="s">&#34;//&#34;</span> <span class="s">&#34;///&#34;</span> <span class="s">&#34;&amp;&amp;&#34;</span> <span class="s">&#34;||&#34;</span> <span class="s">&#34;||=&#34;</span> <span class="s">&#34;|=&#34;</span> <span class="s">&#34;|&gt;&#34;</span> <span class="s">&#34;^=&#34;</span> <span class="s">&#34;$&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;++&#34;</span> <span class="s">&#34;+++&#34;</span> <span class="s">&#34;+&gt;&#34;</span> <span class="s">&#34;=:=&#34;</span> <span class="s">&#34;==&#34;</span> <span class="s">&#34;===&#34;</span> <span class="s">&#34;==&gt;&#34;</span> <span class="s">&#34;=&gt;&#34;</span> <span class="s">&#34;=&gt;&gt;&#34;</span> <span class="s">&#34;&lt;=&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;=&lt;&lt;&#34;</span> <span class="s">&#34;=/=&#34;</span> <span class="s">&#34;&gt;-&#34;</span> <span class="s">&#34;&gt;=&#34;</span> <span class="s">&#34;&gt;=&gt;&#34;</span> <span class="s">&#34;&gt;&gt;&#34;</span> <span class="s">&#34;&gt;&gt;-&#34;</span> <span class="s">&#34;&gt;&gt;=&#34;</span> <span class="s">&#34;&gt;&gt;&gt;&#34;</span> <span class="s">&#34;&lt;*&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;&lt;*&gt;&#34;</span> <span class="s">&#34;&lt;|&#34;</span> <span class="s">&#34;&lt;|&gt;&#34;</span> <span class="s">&#34;&lt;$&#34;</span> <span class="s">&#34;&lt;$&gt;&#34;</span> <span class="s">&#34;&lt;!--&#34;</span> <span class="s">&#34;&lt;-&#34;</span> <span class="s">&#34;&lt;--&#34;</span> <span class="s">&#34;&lt;-&gt;&#34;</span> <span class="s">&#34;&lt;+&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;&lt;+&gt;&#34;</span> <span class="s">&#34;&lt;=&#34;</span> <span class="s">&#34;&lt;==&#34;</span> <span class="s">&#34;&lt;=&gt;&#34;</span> <span class="s">&#34;&lt;=&lt;&#34;</span> <span class="s">&#34;&lt;&gt;&#34;</span> <span class="s">&#34;&lt;&lt;&#34;</span> <span class="s">&#34;&lt;&lt;-&#34;</span> <span class="s">&#34;&lt;&lt;=&#34;</span> <span class="s">&#34;&lt;&lt;&lt;&#34;</span>
</span></span><span class="line"><span class="cl">                                     <span class="s">&#34;&lt;~&#34;</span> <span class="s">&#34;&lt;~~&#34;</span> <span class="s">&#34;&lt;/&#34;</span> <span class="s">&#34;&lt;/&gt;&#34;</span> <span class="s">&#34;~@&#34;</span> <span class="s">&#34;~-&#34;</span> <span class="s">&#34;~&gt;&#34;</span> <span class="s">&#34;~~&#34;</span> <span class="s">&#34;~~&gt;&#34;</span> <span class="s">&#34;%%&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-ligature-mode</span> <span class="ss">&#39;t</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="init-org-dot-el">init-org.el<a hidden class="anchor" aria-hidden="true" href="#init-org-dot-el">¶</a></h3>
<p>org-roam 和 Emacs 自带的 agenda 可以很方便的将笔记和 GTD 结合起来。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-org.el --- Org-mode config -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Among settings for many aspects of `org-mode&#39;, this code includes</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; an opinionated setup for the Getting Things Done (GTD) system based</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; around the Org Agenda.  I have an &#34;inbox.org&#34; file with a header</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; including</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;     #+CATEGORY: Inbox</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;     #+FILETAGS: INBOX</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; and then set this file as `org-default-notes-file&#39;.  Captured org</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; items will then go into this file with the file-level tag, and can</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; be refiled to other locations as necessary.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Those other locations are generally other org files, which should</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; be added to `org-agenda-files-list&#39; (along with &#34;inbox.org&#34; org).</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; With that done, there&#39;s then an agenda view, accessible via the</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; `org-agenda&#39; command, which gives a convenient overview.</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; `org-todo-keywords&#39; is customised here to provide corresponding</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO states, which should make sense to GTD adherents.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 都是方便插入超链接的</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="vg">*is-a-mac*</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;grab-mac-link</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;org-cliplink</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 图片宽度</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-image-actual-width</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c l&#34;</span><span class="p">)</span> <span class="ss">&#39;org-store-link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c a&#34;</span><span class="p">)</span> <span class="ss">&#39;org-agenda</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A keymap for handy global access to org helpers, particularly clocking.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;j&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-goto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;l&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-in-last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;i&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-in</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;o&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c o&#34;</span><span class="p">)</span> <span class="nv">sanityinc/org-global-prefix-map</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Various preferences</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-log-done</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-edit-timestamp-down-means-later</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-hide-emphasis-markers</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-catch-invisible-edits</span> <span class="ss">&#39;show</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-export-coding-system</span> <span class="ss">&#39;utf-8</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-fast-tag-selection-single-key</span> <span class="ss">&#39;expert</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-html-validation-link</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-export-kill-product-buffer-when-displayed</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-tags-column</span> <span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Lots of stuff from http://doc.norang.ca/org-mode.html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Re-align tags when window shape changes</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-agenda-mode-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;window-configuration-change-hook</span> <span class="ss">&#39;org-agenda-align-tags</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Capturing</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-directory</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c c&#34;</span><span class="p">)</span> <span class="ss">&#39;org-capture</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-capture-templates</span>
</span></span><span class="line"><span class="cl">      <span class="o">`</span><span class="p">((</span><span class="s">&#34;i&#34;</span> <span class="s">&#34;inbox&#34;</span> <span class="nv">entry</span>  <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;agenda/inbox.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;* TODO %?\n%U&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;note&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;agenda/note.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="s">&#34;* %? :NOTE:\n%U\n%a\n&#34;</span> <span class="nb">:clock-resume</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Refiling</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-cache</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Targets include this file and any file contributing to the agenda - up to 5 levels deep</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-targets</span> <span class="o">&#39;</span><span class="p">((</span><span class="no">nil</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-agenda-files</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-agenda-after-show-hook</span> <span class="ss">&#39;org-show-entry</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-refile</span> <span class="nb">:after</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-save-all-org-buffers</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Exclude DONE state tasks from refile targets</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/verify-refile-target</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Exclude todo keywords with a done state from refile targets.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="p">(</span><span class="nv">org-heading-components</span><span class="p">))</span> <span class="nv">org-done-keywords</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-target-verify-function</span> <span class="ss">&#39;sanityinc/verify-refile-target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/org-refile-anywhere</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">goto</span> <span class="nv">default-buffer</span> <span class="nv">rfloc</span> <span class="nv">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A version of </span><span class="ss">`org-refile&#39;</span><span class="s"> which allows refiling to any subtree.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-target-verify-function</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-refile</span> <span class="nv">goto</span> <span class="nv">default-buffer</span> <span class="nv">rfloc</span> <span class="nv">msg</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/org-agenda-refile-anywhere</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">goto</span> <span class="nv">rfloc</span> <span class="nv">no-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A version of </span><span class="ss">`org-agenda-refile&#39;</span><span class="s"> which allows refiling to any subtree.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-target-verify-function</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-agenda-refile</span> <span class="nv">goto</span> <span class="nv">rfloc</span> <span class="nv">no-update</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Targets start with the file name - allows creating level 1 tasks</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(setq org-refile-use-outline-path (quote file))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-outline-path</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-outline-path-complete-in-steps</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Allow refile to create parent tasks with confirmation</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-allow-creating-parent-nodes</span> <span class="ss">&#39;confirm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; To-do settings</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; HOLD(h@)       ; 进入时添加笔记</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; HOLD(h/!)      ; 离开时添加变更信息</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; HOLD(h@/!)     ; 进入时添加笔记，离开时添加变更信息</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keywords</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">quote</span> <span class="p">((</span><span class="nv">sequence</span> <span class="s">&#34;TODO(t)&#34;</span> <span class="s">&#34;NEXT(n)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d!/!)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">sequence</span> <span class="s">&#34;PROJECT(p)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d!/!)&#34;</span> <span class="s">&#34;CANCELLED(c/!)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">sequence</span> <span class="s">&#34;WAITING(w/!)&#34;</span> <span class="s">&#34;DELEGATED(e!)&#34;</span> <span class="s">&#34;HOLD(h)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;CANCELLED(c/!)&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-todo-repeat-to-state</span> <span class="s">&#34;NEXT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keyword-faces</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">quote</span> <span class="p">((</span><span class="s">&#34;NEXT&#34;</span> <span class="nb">:inherit</span> <span class="nv">warning</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="s">&#34;PROJECT&#34;</span> <span class="nb">:inherit</span> <span class="nv">font-lock-string-face</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Agenda views</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 将没有时间标记的任务，放在上方显示。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-sort-notime-is-late</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 时间显示为两位数(9:30 -&gt; 09:30)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-time-leading-zero</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 过滤掉部分 tags</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-hide-tags-regexp</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;dynamic&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span> <span class="p">(</span><span class="nv">file-expand-wildcards</span> <span class="s">&#34;~/Dropbox/org/agenda/*.org&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">org-agenda-clockreport-parameter-plist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:link</span> <span class="no">t</span> <span class="nb">:maxlevel</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">active-project-match</span> <span class="s">&#34;-INBOX/PROJECT&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-stuck-projects</span>
</span></span><span class="line"><span class="cl">        <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">active-project-match</span> <span class="p">(</span><span class="s">&#34;NEXT&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-compact-blocks</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-sticky</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-start-on-weekday</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-span</span> <span class="ss">&#39;day</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-include-diary</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">        <span class="o">&#39;</span><span class="p">((</span><span class="nv">agenda</span> <span class="nv">habit-down</span> <span class="nv">time-up</span> <span class="nv">user-defined-up</span> <span class="nv">effort-up</span> <span class="nv">category-keep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">todo</span> <span class="nv">category-up</span> <span class="nv">effort-up</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">tags</span> <span class="nv">category-up</span> <span class="nv">effort-up</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">search</span> <span class="nv">category-up</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-window-setup</span> <span class="ss">&#39;current-window</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-custom-commands</span>
</span></span><span class="line"><span class="cl">        <span class="o">`</span><span class="p">((</span><span class="s">&#34;N&#34;</span> <span class="s">&#34;Notes&#34;</span> <span class="nv">tags</span> <span class="s">&#34;NOTE&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Notes&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="s">&#34;GTD&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="p">((</span><span class="nv">agenda</span> <span class="s">&#34;&#34;</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags</span> <span class="s">&#34;inbox&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Inbox&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">nil</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; (stuck &#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;        ((org-agenda-overriding-header &#34;Stuck Projects&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-agenda-tags-todo-honor-ignore-options t)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-tags-match-list-sublevels t)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-agenda-todo-ignore-scheduled &#39;future)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Next Actions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;HOLD&#34;</span> <span class="s">&#34;WAITING&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-entry-if</span> <span class="ss">&#39;nottodo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;NEXT&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">todo-state-down</span> <span class="nv">effort-up</span> <span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="o">,</span><span class="nv">active-project-match</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Projects&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;/WAITING&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Waiting&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;/DELEGATED&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Delegated&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;On Hold&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;WAITING&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-entry-if</span> <span class="ss">&#39;nottodo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;HOLD&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX/-NEXT&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Orphaned Tasks&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;PROJECT&#34;</span> <span class="s">&#34;HOLD&#34;</span> <span class="s">&#34;WAITING&#34;</span> <span class="s">&#34;DELEGATED&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;nottododo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;TODO&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; (tags-todo &#34;-NEXT&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;            ((org-agenda-overriding-header &#34;All other TODOs&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;             (org-match-list-sublevels t)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-agenda-mode-hook</span> <span class="ss">&#39;hl-line-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Org clock</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save the running clock and all clock history when exiting Emacs, load it on startup</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-clock-persistence-insinuate</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-persist</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-in-resume</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save clock data and notes in the LOGBOOK drawer</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-into-drawer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Save state changes in the LOGBOOK drawer</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-log-into-drawer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Removes clocked tasks with 0:00 duration</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-out-remove-zero-time-clocks</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Show clock sums as hours and minutes, not &#34;n days&#34; etc.</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-time-clocksum-format</span>
</span></span><span class="line"><span class="cl">      <span class="o">&#39;</span><span class="p">(</span><span class="nb">:hours</span> <span class="s">&#34;%d&#34;</span> <span class="nb">:require-hours</span> <span class="no">t</span> <span class="nb">:minutes</span> <span class="s">&#34;:%02d&#34;</span> <span class="nb">:require-minutes</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Show the clocked-in task - if any - in the header line</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/show-org-clock-in-header-line</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">header-line-format</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34; &#34;</span> <span class="nv">org-mode-line-string</span> <span class="s">&#34; &#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/hide-org-clock-from-header-line</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">header-line-format</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-in-hook</span> <span class="ss">&#39;sanityinc/show-org-clock-in-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-out-hook</span> <span class="ss">&#39;sanityinc/hide-org-clock-from-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-cancel-hook</span> <span class="ss">&#39;sanityinc/hide-org-clock-from-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-clock</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-clock-mode-line-map</span> <span class="p">[</span><span class="nv">header-line</span> <span class="nv">mouse-2</span><span class="p">]</span> <span class="ss">&#39;org-clock-goto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-clock-mode-line-map</span> <span class="p">[</span><span class="nv">header-line</span> <span class="nv">mouse-1</span><span class="p">]</span> <span class="ss">&#39;org-clock-menu</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="vg">*is-a-mac*</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="s">&#34;/Applications/org-clock-statusbar.app&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-in-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">call-process</span> <span class="s">&#34;/usr/bin/osascript&#34;</span> <span class="no">nil</span> <span class="mi">0</span> <span class="no">nil</span> <span class="s">&#34;-e&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;tell application \&#34;org-clock-statusbar\&#34; to clock in \&#34;&#34;</span> <span class="nv">org-clock-current-task</span> <span class="s">&#34;\&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-out-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">call-process</span> <span class="s">&#34;/usr/bin/osascript&#34;</span> <span class="no">nil</span> <span class="mi">0</span> <span class="no">nil</span> <span class="s">&#34;-e&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="s">&#34;tell application \&#34;org-clock-statusbar\&#34; to clock out&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO: warn about inconsistent items, e.g. TODO inside non-PROJECT</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO: nested projects!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Archiving</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-mark-done</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-location</span> <span class="s">&#34;%s_archive::* Archive&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-pomodoro</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-pomodoro-keep-killed-pomodoro-time</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-agenda-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;P&#34;</span><span class="p">)</span> <span class="ss">&#39;org-pomodoro</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; ;; Show iCal calendars in the org agenda</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (when (and *is-a-mac* (require &#39;org-mac-iCal nil t))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (setq org-agenda-include-diary t</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;         org-agenda-custom-commands</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;         &#39;((&#34;I&#34; &#34;Import diary from iCal&#34; agenda &#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;            ((org-agenda-mode-hook #&#39;org-mac-iCal)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;   (add-hook &#39;org-agenda-cleanup-fancy-diary-hook</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;             (lambda ()</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (goto-char (point-min))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (save-excursion</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (while (re-search-forward &#34;^[a-z]&#34; nil t)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (goto-char (match-beginning 0))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (insert &#34;0:00-24:00 &#34;)))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (while (re-search-forward &#34;^ [a-z]&#34; nil t)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (goto-char (match-beginning 0))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (save-excursion</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (re-search-backward &#34;^[0-9]+:[0-9]+-[0-9]+:[0-9]+ &#34; nil t))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (insert (match-string 0))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-&lt;up&gt;&#34;</span><span class="p">)</span> <span class="ss">&#39;org-up-element</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="vg">*is-a-mac*</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;M-h&#34;</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c g&#34;</span><span class="p">)</span> <span class="ss">&#39;grab-mac-link</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="ss">&#39;org-babel-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">seq-filter</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">pair</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">featurep</span> <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;ob-&#34;</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">pair</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">((</span><span class="nv">R</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ditaa</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">rust</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">dot</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">emacs-lisp</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">gnuplot</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">haskell</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">latex</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ledger</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ocaml</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">octave</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ruby</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">screen</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sh</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; obsolete</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">shell</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sql</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sqlite</span> <span class="o">.</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; plantuml</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="ss">&#39;org-babel-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="c1">;; other Babel languages</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">plantuml</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">python</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span>  <span class="nv">org-plantuml-jar-path</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;~/Dropbox/org/planuml/plantuml.jar&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 这里应该就是 .zshrc 里面配置的 python3</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-babel-python-command</span> <span class="s">&#34;python3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;emacsql-sqlite-builtin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:demand</span> <span class="no">t</span> <span class="c1">;; ensure org-roam is loaded by default</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-directory</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 需要 emacs-plus@29 版本</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-database-connector</span> <span class="ss">&#39;sqlite-builtin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-location</span> <span class="s">&#34;~/Dropbox/org/org.db&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-gc-threshold</span> <span class="nv">most-positive-fixnum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-completion-everywhere</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-capture-templates</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; #+OPTIONS: toc:nil 为了导出 .md 的格式更加符合使用</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="s">&#34;default&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/default.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;main/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="s">&#34;article&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/article.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;article/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="s">&#34;book notes&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/book-notes.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;book/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;  (&#34;p&#34; &#34;project&#34; plain &#34;* Goals\n\n%?\n\n* Tasks\n\n** TODO Add initial tasks\n\n* Dates\n\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :if-new (file+head &#34;%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34; &#34;#+title: ${title}\n#+category: ${title}\n#+filetags: Project&#34;)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :unnarrowed t)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;  (&#34;l&#34; &#34;programming language&#34; plain</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   &#34;* Reference:\n\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :if-new (file+head &#34;programming language/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34; &#34;#+title: ${title}\n#+OPTIONS: toc:nil\n&#34;)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :unnarrowed t)</span>
</span></span><span class="line"><span class="cl">     <span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-dailies-capture-templates</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; %&lt;%H:%M&gt; 为24小时制，%&lt;%I:%M %p&gt; 为12小时制</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="s">&#34;default&#34;</span> <span class="nv">entry</span> <span class="s">&#34;** %&lt;%H:%M&gt; %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="s">&#34;read&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;What I read? :read:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="s">&#34;tasks&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;Tasks :task:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;notes&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;Notes :note:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;o&#34;</span> <span class="s">&#34;online&#34;</span> <span class="nv">entry</span> <span class="s">&#34;** %&lt;%H:%M&gt; %? :online:&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c n l&#34;</span> <span class="o">.</span> <span class="nv">org-roam-buffer-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n f&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n i&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-insert</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n j&#34;</span> <span class="o">.</span> <span class="nv">org-roam-dailies-capture-today</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n I&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-insert-immediate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n m&#34;</span> <span class="o">.</span> <span class="nv">dired-copy-images-links</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">         <span class="c1">;; Ctrl-Alt-i</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-M-i&#34;</span> <span class="o">.</span> <span class="nv">completion-at-point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">org-roam-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">org-roam-directory</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-autosync-enable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;使用侧边栏而不是完整buffer</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;display-buffer-alist</span>
</span></span><span class="line"><span class="cl">               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\*org-roam\\*&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">display-buffer-in-direction</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">direction</span> <span class="o">.</span> <span class="nv">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">window-width</span> <span class="o">.</span> <span class="mf">0.33</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">window-height</span> <span class="o">.</span> <span class="nv">fit-window-to-buffer</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-export-backends</span> <span class="p">(</span><span class="nb">quote</span> <span class="p">(</span><span class="nv">ascii</span> <span class="nv">html</span> <span class="nv">icalendar</span> <span class="nv">latex</span> <span class="nv">md</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; code hightlight</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-src-fontify-natively</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; If using org-roam-protocol</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam-protocol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam-export</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-tempo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; Copy Done To-Dos to Today</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-copy-todo-to-today</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-keep</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; Set this to nil to delete the original!</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-after-refile-insert-hook</span> <span class="nf">#&#39;</span><span class="nv">save-buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nv">today-file</span>
</span></span><span class="line"><span class="cl">          <span class="nv">pos</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-window-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-dailies-capture-today</span> <span class="no">t</span> <span class="s">&#34;t&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">today-file</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">;; Only refile if the target file is different than the current file</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="nv">today-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">file-truename</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-refile</span> <span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="nf">list</span> <span class="s">&#34;Tasks&#34;</span> <span class="nv">today-file</span> <span class="no">nil</span> <span class="nv">pos</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-after-todo-state-change-hook</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">;; DONE 和 CANCELLED 的 To-Dos 自动复制到今日</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">;; 同时过滤掉 habit 的 To-Dos</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-state</span> <span class="s">&#34;DONE&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-state</span> <span class="s">&#34;CANCELLED&#34;</span><span class="p">))</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-find-property</span> <span class="s">&#34;STYLE&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">org-roam-copy-todo-to-today</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; node-find 的时候展示文件夹</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; org-roam-node-type</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-type</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return the TYPE of NODE.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">condition-case</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">file-name-nondirectory</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">directory-file-name</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">file-name-directory</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">file-relative-name</span> <span class="p">(</span><span class="nv">org-roam-node-file</span> <span class="nv">node</span><span class="p">)</span> <span class="nv">org-roam-directory</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; 在记录的时候创建新的 node 时不退出当前状态，保存新建的 node。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-node-insert-immediate</span> <span class="p">(</span><span class="nv">arg</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">args</span> <span class="p">(</span><span class="nb">push</span> <span class="nv">arg</span> <span class="nv">args</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-capture-templates</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">append</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-roam-capture-templates</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="o">&#39;</span><span class="p">(</span><span class="nb">:immediate-finish</span> <span class="no">t</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">org-roam-node-insert</span> <span class="nv">args</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; C-x d 进入 dired 模式，m 来标记对应需要复制链接的图片，C-c n m 即可复制到需要的图片插入文本。</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; source: https://org-roam.discourse.group/t/is-there-a-solution-for-images-organization-in-org-roam/925</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">dired-copy-images-links</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Works only in dired-mode, put in kill-ring,
</span></span></span><span class="line"><span class="cl"><span class="s">  ready to be yanked in some other org-mode file,
</span></span></span><span class="line"><span class="cl"><span class="s">  the links of marked image files using file-name-base as #+CAPTION.
</span></span></span><span class="line"><span class="cl"><span class="s">  If no file marked then do it on all images files of directory.
</span></span></span><span class="line"><span class="cl"><span class="s">  No file is moved nor copied anywhere.
</span></span></span><span class="line"><span class="cl"><span class="s">  This is intended to be used with org-redisplay-inline-images.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>                           <span class="c1">; if we are in dired-mode</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">marked-files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">))</span>         <span class="c1">; get marked file list</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">number-marked-files</span>                            <span class="c1">; store number of marked files</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">string-to-number</span>                              <span class="c1">; as a number</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">dired-number-of-marked-files</span><span class="p">))))</span>             <span class="c1">; for later reference</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">number-marked-files</span> <span class="mi">0</span><span class="p">)</span>                      <span class="c1">; if none marked then</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">dired-toggle-marks</span><span class="p">)</span>                               <span class="c1">; mark all files</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">marked-files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">)))</span>      <span class="c1">; get marked file list</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Files marked for copy&#34;</span><span class="p">)</span>                    <span class="c1">; info message</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">dired-number-of-marked-files</span><span class="p">)</span>                       <span class="c1">; marked files info</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">kill-new</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>                                      <span class="c1">; start with a newline</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">marked-file</span> <span class="nv">marked-files</span><span class="p">)</span>                   <span class="c1">; walk the marked files list</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-file-image-p</span> <span class="nv">marked-file</span><span class="p">)</span>               <span class="c1">; only on image files</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">kill-append</span>                                     <span class="c1">; append image to kill-ring</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;#+CAPTION: &#34;</span>                           <span class="c1">; as caption,</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">file-name-base</span> <span class="nv">marked-file</span><span class="p">)</span>            <span class="c1">; use file-name-base</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;\n#+ATTR_ORG: :width 800&#34;</span>              <span class="c1">; img width</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;\n[[file:&#34;</span> <span class="nv">marked-file</span> <span class="s">&#34;]]\n\n&#34;</span><span class="p">)</span> <span class="no">nil</span><span class="p">)))</span><span class="c1">; link to marked-file</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">number-marked-files</span> <span class="mi">0</span><span class="p">)</span>                      <span class="c1">; if none were marked then</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">dired-toggle-marks</span><span class="p">)))</span>                             <span class="c1">; unmark all</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Error: Does not work outside dired-mode&#34;</span><span class="p">)</span>      <span class="c1">; can&#39;t work not in dired-mode</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">ding</span><span class="p">)))</span>                                                 <span class="c1">; error sound</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save the corresponding buffers</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gtd-save-org-buffers</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save </span><span class="ss">`org-agenda-files&#39;</span><span class="s"> buffers without user confirmation.
</span></span></span><span class="line"><span class="cl"><span class="s">See also </span><span class="ss">`org-save-all-org-buffers&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Saving org-agenda-files buffers...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">save-some-buffers</span> <span class="no">t</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)</span> <span class="nv">org-agenda-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Saving org-agenda-files buffers... done&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Add it after refile</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-refile</span> <span class="nb">:after</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nv">gtd-save-org-buffers</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">log-todo-next-creation-date</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">ignore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Log NEXT creation time in the property drawer under the key &#39;ACTIVATED&#39;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">org-get-todo-state</span><span class="p">)</span> <span class="s">&#34;NEXT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">&#34;ACTIVATED&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-entry-put</span> <span class="no">nil</span> <span class="s">&#34;ACTIVATED&#34;</span> <span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;[%Y-%m-%d]&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-after-todo-state-change-hook</span> <span class="nf">#&#39;</span><span class="nv">log-todo-next-creation-date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Put the text property afterwards with an advice</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-override-header</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Change the face of the overriden header string if needed.
</span></span></span><span class="line"><span class="cl"><span class="s">The propertized header text is taken from </span><span class="ss">`org-agenda-overriding-header&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">The face is only changed if the overriding header is propertized with a face.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">pt</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">header</span> <span class="nv">org-agenda-overriding-header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Only replace if there is an overriding header and not an empty string.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; And only if the header text has a face property.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">header</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">header</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">get-text-property</span> <span class="mi">0</span> <span class="ss">&#39;face</span> <span class="nv">header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">pt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; Search for the header text.</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">search-forward</span> <span class="nv">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">unwind-protect</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="c1">;; Replace it with the propertized text.</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">replace-match</span> <span class="nv">header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">1</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-override-header-add-advices</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add advices to make changing work in all agenda commands.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">fun</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-list</span> <span class="nv">org-todo-list</span> <span class="nv">org-search-view</span> <span class="nv">org-tags-view</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">advice-add</span> <span class="nv">fun</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">my-org-agenda-override-header</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">my-org-agenda-override-header-add-advices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 只显示 outline 下第一个 TODO</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-skip-all-siblings-but-first</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Skip all but the first non-done entry.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">should-skip-entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">org-current-is-todo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">should-skip-entry</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">should-skip-entry</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-goto-sibling</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-current-is-todo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">should-skip-entry</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="nv">should-skip-entry</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">outline-next-heading</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-current-is-todo</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;TODO&#34;</span> <span class="p">(</span><span class="nv">org-get-todo-state</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-org</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-org.el ends here</span>
</span></span></code></pre></div><h4 id="org-babel">Org-babel<a hidden class="anchor" aria-hidden="true" href="#org-babel">¶</a></h4>
<p>输出 <code>:results</code> 有不同的选项，其中 <code>silent</code> 是指：Do not insert results in the Org mode buffer, but echo them in the minibuffer. Usage example: ‘:results output silent’.</p>
<p>Rust 运行代码块，需要安装 <a href="https://github.com/brotzeit/rustic">GitHub - brotzeit/rustic: Rust development environment for Emacs</a>，具体执行的时候会提示需要安装 <code>lsp-mode</code>​，确定即可。</p>
<h4 id="plantuml">PlantUML<a hidden class="anchor" aria-hidden="true" href="#plantuml">¶</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install graphviz
</span></span></code></pre></div><table>
<thead>
<tr>
<th>Type</th>
<th>Symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zero or One</td>
<td>o|&ndash;</td>
</tr>
<tr>
<td>Exactly One</td>
<td>||&ndash;</td>
</tr>
<tr>
<td>Zero or Many</td>
<td>}o&ndash;</td>
</tr>
<tr>
<td>One or Many</td>
<td>}|&ndash;</td>
</tr>
</tbody>
</table>
<pre tabindex="0"><code class="language-nil" data-lang="nil">@startumlg
scale 2
Entity01 }|..|| Entity02
Entity03 }o..o| Entity04
Entity05 ||--o{ Entity06
Entity07 |o--|| Entity08
@enduml
</code></pre><p>PlantUML 默认的样式比较古老，可以用更加现代一些的样式：<a href="https://github.com/xuanye/plantuml-style-c4">GitHub - xuanye/plantuml-style-c4: 自定义的plantuml 样式</a>。</p>
<figure>
    <img loading="lazy" src="/ox-hugo/ERD-example.jpg"/> 
</figure>

<h3 id="init-sis-dot-el">init-sis.el<a hidden class="anchor" aria-hidden="true" href="#init-sis-dot-el">¶</a></h3>
<p>根据 meow 的 <code>insert mode</code> 切换，同时根据上下文来判断切换输入法；另外在特定 <code>mode</code> 下也切换输入法，使用更加顺滑。</p>
<p>需要安装 <code>macism</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew tap laishulu/macism
</span></span><span class="line"><span class="cl">brew install macism
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-sis.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;sis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; meow insert mode switch</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">meow-leaving-insert-mode-hook</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Hook to run when leaving meow insert mode.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">meow-entering-insert-mode-hook</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Hook to run when entering meow insert mode.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;meow-insert-mode-hook</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="nv">meow-insert-mode</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">run-hooks</span> <span class="ss">&#39;meow-entering-insert-mode-hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">run-hooks</span> <span class="ss">&#39;meow-leaving-insert-mode-hook</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">sis</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-english-source</span> <span class="s">&#34;com.apple.keylayout.ABC&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-ism-lazyman-config</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;com.apple.keylayout.ABC&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;im.rime.inputmethod.Squirrel.Rime&#34;</span> <span class="ss">&#39;macism</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /cursor color/ mode</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-cursor-color-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /respect/ mode</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-respect-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /context/ mode for all buffers</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-context-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /inline english/ mode for all buffers</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (sis-global-inline-mode t)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; not delete the head spaces</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-inline-tighten-head-rule</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-default-cursor-color</span> <span class="s">&#34;brown3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-other-cursor-color</span> <span class="s">&#34;orange&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-prefix-override-keys</span> <span class="p">(</span><span class="nf">list</span> <span class="s">&#34;C-c&#34;</span> <span class="s">&#34;C-x&#34;</span> <span class="s">&#34;C-h&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;meow-leaving-insert-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">sis-set-english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;sis-context-hooks</span> <span class="ss">&#39;meow-entering-insert-mode-hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; org title 处切换 Rime，telega 聊天时切换 Rime。</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;sis-context-detectors</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;org-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-at-heading-p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;telega-chat-mode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="ss">&#39;other</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-agenda-todo</span> <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">sis-set-english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;hydra-org-agenda-menu/body</span> <span class="nb">:after</span> <span class="nf">#&#39;</span><span class="nv">sis-set-english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-sis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-sis.el ends here</span>
</span></span></code></pre></div><p>注：从其他 App 切回 Emacs 后进入 <code>insert mode</code> 之后切换到中文后立刻切换到英文，解决办法如下。（问题 <code>emacs -Q</code> 记录视频 <a href="https://imgur.com/a/TKaD3So">Imgur: The magic of the Internet</a>）</p>
<blockquote>
<p>是这样的，
你是从其它应用切回 emacs 后，
立刻就 i 进入 insert mode？</p>
<p>如果稍微延迟一下再 i 进入 insert mode，
是不是就没这个问题了？</p>
<p>emacs 处理窗口焦点的切换（focus in事件）是有一个延迟的，
这样操作就导致：</p>
<p>focus in 之后恢复当前 buffer 的 input source（因为离开前为 normal 状态，所以为 english）
你进入 insert mode 切换 input source（为 rime）
这二者抢占了。</p>
<p>比较 dirty 但是直接的办法是，
你把下面这个函数在自己的配置文件中重新定义一下，让 sis 不要切换。</p>
<p><a href="https://github.com/laishulu/emacs-smart-input-source/blob/02777a46a4b7c18c2cd588e6e2f11e83ba2378e4/sis.el#L811">emacs-smart-input-source/sis.el at 02777a46a4b7c18c2cd588e6e2f11e83ba2378e4 ·&hellip;</a></p>
<p>但是这块也不算是 sis 的 bug，
sis 对于焦点切换也只能做到这一步。
包治百病的用法就是切回emacs稍微等一下。</p>
<p>不过我又想到一点，
macos 可以系统配置“自动切换到文稿的输入法”，
你如果配置了这个，
在使用 GUI Emacs 时，应该是不需要 sis 自己去恢复当前 buffer 的输入法的。
那就可以用空函数去覆盖上面那个函数了。
但是！！！
macos 也会帮你主动地切输入法，就是不知道会不会也有延迟，导致同样的问题</p>
<p>不过 sis 针对的是一般情况：非 MacOS 系统，或没系统设置“自动切换到文稿的输入法”，或用的是 Terminal Emacs 等等。</p>
</blockquote>
<h3 id="init-font-dot-el">init-font.el<a hidden class="anchor" aria-hidden="true" href="#init-font-dot-el">¶</a></h3>
<p>使用的是 <code>Iosevka</code> 和 <code>LXGW WenKai</code> 分别作为英文和中文字体，按照 1:1 缩放，偶数字号就可以做到等高等宽。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-font.el --- Dired customisations -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; base on https://gist.github.com/coldnew/7398835</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">qiang-font-existsp</span> <span class="p">(</span><span class="nv">font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">null</span> <span class="p">(</span><span class="nf">x-list-fonts</span> <span class="nv">font</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="no">nil</span>
</span></span><span class="line"><span class="cl">    <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; LXGW WenKai Mono 配合 Iosevka 按照 1:1 偶数字号就可以做到等高等宽。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">zh-font-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;LXGW WenKai Mono&#34;</span> <span class="s">&#34;HanaMinB&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">en-font-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Iosevka&#34;</span> <span class="s">&#34;Fira Code&#34;</span> <span class="s">&#34;IBM Plex Mono&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">qiang-make-font-string</span> <span class="p">(</span><span class="nv">font-name</span> <span class="nv">font-size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">stringp</span> <span class="nv">font-size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;:&#34;</span> <span class="p">(</span><span class="nf">string</span> <span class="p">(</span><span class="nf">elt</span> <span class="nv">font-size</span> <span class="mi">0</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s%s&#34;</span> <span class="nv">font-name</span> <span class="nv">font-size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s %s&#34;</span> <span class="nv">font-name</span> <span class="nv">font-size</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">qiang-set-font</span> <span class="p">(</span><span class="nv">english-fonts</span>
</span></span><span class="line"><span class="cl">                       <span class="nv">english-font-size</span>
</span></span><span class="line"><span class="cl">                       <span class="nv">chinese-fonts</span>
</span></span><span class="line"><span class="cl">                       <span class="kp">&amp;optional</span> <span class="nv">chinese-font-scale</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">chinese-font-scale</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">chinese-font-scale</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">face-font-rescale-alist</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">cl-loop</span> <span class="nv">for</span> <span class="nv">x</span> <span class="nv">in</span> <span class="nv">zh-font-list</span>
</span></span><span class="line"><span class="cl">              <span class="nv">collect</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">x</span> <span class="nv">chinese-font-scale</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="s">&#34;english-font-size could be set to \&#34;:pixelsize=18\&#34; or a integer.
</span></span></span><span class="line"><span class="cl"><span class="s">If set/leave chinese-font-scale to nil, it will follow english-font-size&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">en-font</span> <span class="p">(</span><span class="nv">qiang-make-font-string</span>
</span></span><span class="line"><span class="cl">                  <span class="p">(</span><span class="nv">cl-find-if</span> <span class="nf">#&#39;</span><span class="nv">qiang-font-existsp</span> <span class="nv">english-fonts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="nv">english-font-size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">zh-font</span> <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="p">(</span><span class="nv">cl-find-if</span> <span class="nf">#&#39;</span><span class="nv">qiang-font-existsp</span> <span class="nv">chinese-fonts</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">;; Set the default English font</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Set English Font to %s&#34;</span> <span class="nv">en-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;default</span> <span class="no">nil</span> <span class="nb">:font</span> <span class="nv">en-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">;; Set Chinese font</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Do not use &#39;unicode charset, it will cause the English font setting invalid</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Set Chinese Font to %s&#34;</span> <span class="nv">zh-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">charset</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">kana</span> <span class="nv">han</span> <span class="nv">symbol</span> <span class="nv">cjk-misc</span> <span class="nv">bopomofo</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">set-fontset-font</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">charset</span> <span class="nv">zh-font</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">qiang-set-font</span> <span class="nv">en-font-list</span> <span class="mi">14</span> <span class="nv">zh-font-list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-font.el ends here</span>
</span></span></code></pre></div><h3 id="init-ebib-dot-el">init-ebib.el<a hidden class="anchor" aria-hidden="true" href="#init-ebib-dot-el">¶</a></h3>
<p>管理 Bibtex 可以方便在文章中引用，以及新增读书笔记，结合 agenda 更好的管理读书条目以及进度。（这部份配置需要精简，目前用的比较简单。）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-ebib.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">bibtex</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">bibtex-file-path</span> <span class="s">&#34;~/Dropbox/org/bib/&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-files</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;bibtex.bib&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-notes-path</span> <span class="s">&#34;~/Dropbox/org/references/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-align-at-equal-sign</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-titleword-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-year-title-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-name-year-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-dialect</span> <span class="ss">&#39;biblatex</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ebib</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:straight</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:commands</span> <span class="nv">ebib-zotero-protocol-handler</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-protocol</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">push</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;ebib-zotero&#34;</span> <span class="nb">:protocol</span> <span class="s">&#34;ebib-zotero&#34;</span> <span class="nb">:function</span> <span class="nv">ebib-zotero-protocol-handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nv">org-protocol-protocol-alist</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ebib-default-directory</span> <span class="nv">bibtex-file-path</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-bib-search-dirs</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">bibtex-file-path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-file-search-dirs</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="nv">bibtex-file-path</span> <span class="s">&#34;files/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-directory</span> <span class="nv">bibtex-notes-path</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-reading-list-file</span> <span class="s">&#34;~/Dropbox/org/agenda/books.org&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-bibtex-dialect</span> <span class="nv">bibtex-dialect</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-file-associations</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;pdf&#34;</span> <span class="o">.</span> <span class="s">&#34;open&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-index-default-sort</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;timestamp&#34;</span> <span class="o">.</span> <span class="nv">descend</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-template</span> <span class="s">&#34;:PROPERTIES:
</span></span></span><span class="line"><span class="cl"><span class="s">                             :ID:       %i
</span></span></span><span class="line"><span class="cl"><span class="s">                             :ROAM_REFS: @%k
</span></span></span><span class="line"><span class="cl"><span class="s">                             :END:
</span></span></span><span class="line"><span class="cl"><span class="s">                             #+title: %t
</span></span></span><span class="line"><span class="cl"><span class="s">                             #+description: %d
</span></span></span><span class="line"><span class="cl"><span class="s">                             #+date: %s
</span></span></span><span class="line"><span class="cl"><span class="s">                             %%?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-template-specifiers</span> <span class="o">&#39;</span><span class="p">((</span><span class="sc">?k</span> <span class="o">.</span> <span class="nv">ebib-create-key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?i</span> <span class="o">.</span> <span class="nv">ebib-create-id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?t</span> <span class="o">.</span> <span class="nv">ebib-create-org-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?d</span> <span class="o">.</span> <span class="nv">ebib-create-org-description</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?l</span> <span class="o">.</span> <span class="nv">ebib-create-org-link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?s</span> <span class="o">.</span> <span class="nv">ebib-create-org-time-stamp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-preload-bib-files</span> <span class="nv">bibtex-files</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-use-timestamp</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-key</span> <span class="p">(</span><span class="nv">key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return the KEY in DB for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s&#34;</span> <span class="nv">key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-id</span> <span class="p">(</span><span class="nv">_key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Create an ID for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-id-new</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-org-time-stamp</span> <span class="p">(</span><span class="nv">_key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Create timestamp for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s&#34;</span> <span class="p">(</span><span class="nb">with-temp-buffer</span> <span class="p">(</span><span class="nv">org-insert-time-stamp</span> <span class="no">nil</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; ebib-zotero</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defcustom</span> <span class="nv">ebib-zotero-translation-server</span> <span class="s">&#34;https://translate.manubot.org&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;The address of Zotero translation server.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:group</span> <span class="ss">&#39;ebib</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:type</span> <span class="ss">&#39;string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-translate</span> <span class="p">(</span><span class="nv">item</span> <span class="nv">server-path</span> <span class="kp">&amp;optional</span> <span class="nv">export-format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Convert item to EXPORT-FORMAT entry through </span><span class="ss">`ebib-zotero-translation-server&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">export-format</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">export-format</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">downcase</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">intern-soft</span> <span class="nv">bibtex-dialect</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">shell-command-to-string</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;curl -s -d &#39;%s&#39; -H &#39;Content-Type: text/plain&#39; &#39;%s/%s&#39; | curl -s -d @- -H &#39;Content-Type: application/json&#39; &#39;%s/export?format=%s&#39;&#34;</span> <span class="nv">item</span> <span class="nv">ebib-zotero-translation-server</span> <span class="nv">server-path</span> <span class="nv">ebib-zotero-translation-server</span> <span class="nv">export-format</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-import-url</span> <span class="p">(</span><span class="nv">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Fetch a entry from zotero translation server via a URL.
</span></span></span><span class="line"><span class="cl"><span class="s">The entry is stored in the current database.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;MURL: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">ebib-zotero-translate</span> <span class="nv">url</span> <span class="s">&#34;web&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">entry-keys</span> <span class="p">(</span><span class="nv">ebib-import-entries</span> <span class="nv">ebib--cur-db</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">ebib--goto-entry-in-index</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">entry-keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">ebib--update-entry-buffer</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-import-identifier</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Fetch a entry from zotero translation server via an IDENTIFIER.
</span></span></span><span class="line"><span class="cl"><span class="s">The entry is stored in the current database,
</span></span></span><span class="line"><span class="cl"><span class="s">and the identifier can be DOI, ISBN, PMID, or arXiv ID.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;MIDENTIFIER: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">ebib-zotero-translate</span> <span class="nv">identifier</span> <span class="s">&#34;search&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">entry-keys</span> <span class="p">(</span><span class="nv">ebib-import-entries</span> <span class="nv">ebib--cur-db</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">ebib--goto-entry-in-index</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">entry-keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">ebib--update-entry-buffer</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-protocol-handler</span> <span class="p">(</span><span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Process an org-protocol://ebib-zotero?href= style url with INFO.
</span></span></span><span class="line"><span class="cl"><span class="s">Calls </span><span class="ss">`ebib-zotero-import-url&#39;</span><span class="s"> with the provided URI to add a
</span></span></span><span class="line"><span class="cl"><span class="s">new BibTeX entry to the current database.
</span></span></span><span class="line"><span class="cl"><span class="s">Add the following as a browser bookmark to use:
</span></span></span><span class="line"><span class="cl"><span class="s">    javascript:location.href = \\=&#39;org-protocol://ebib-zotero?href=\\=&#39;+ \\
</span></span></span><span class="line"><span class="cl"><span class="s">            encodeURIComponent(location.href)&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:href</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">user-error</span> <span class="s">&#34;No URI provided&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">ebib</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">ebib-zotero-import-url</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:href</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-ebib</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-ebib.el ends here</span>
</span></span></code></pre></div><h3 id="init-meow-dot-el">init-meow.el<a hidden class="anchor" aria-hidden="true" href="#init-meow-dot-el">¶</a></h3>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>M-S-&lt;</code></td>
<td>移动光标到顶部</td>
<td><code>cmd-shift-&lt;</code></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-meow.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;meow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;meow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">meow-setup</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">meow-cheatsheet-layout</span> <span class="nv">meow-cheatsheet-layout-qwerty</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">meow-motion-overwrite-define-key</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="o">.</span> <span class="nv">meow-next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="o">.</span> <span class="nv">meow-prev</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&lt;escape&gt;&#34;</span> <span class="o">.</span> <span class="nv">ignore</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">meow-leader-define-key</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; SPC j/k will run the original command in MOTION state.</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="o">.</span> <span class="s">&#34;H-j&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="o">.</span> <span class="s">&#34;H-k&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; Use SPC (0-9) for digit arguments.</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;1&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;2&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;3&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;4&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;5&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;6&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;7&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;8&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;9&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;0&#34;</span> <span class="o">.</span> <span class="nv">meow-digit-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;/&#34;</span> <span class="o">.</span> <span class="nv">meow-keypad-describe-key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;?&#34;</span> <span class="o">.</span> <span class="nv">meow-cheatsheet</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">meow-normal-define-key</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;0&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;9&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;8&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;7&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;6&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;5&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;4&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;3&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;2&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;1&#34;</span> <span class="o">.</span> <span class="nv">meow-expand-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;-&#34;</span> <span class="o">.</span> <span class="nv">negative-argument</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;;&#34;</span> <span class="o">.</span> <span class="nv">meow-reverse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;,&#34;</span> <span class="o">.</span> <span class="nv">meow-inner-of-thing</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="o">.</span> <span class="nv">meow-bounds-of-thing</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;[&#34;</span> <span class="o">.</span> <span class="nv">meow-beginning-of-thing</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;]&#34;</span> <span class="o">.</span> <span class="nv">meow-end-of-thing</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="o">.</span> <span class="nv">meow-append</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="o">.</span> <span class="nv">meow-open-below</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="o">.</span> <span class="nv">meow-back-word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;B&#34;</span> <span class="o">.</span> <span class="nv">meow-back-symbol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;c&#34;</span> <span class="o">.</span> <span class="nv">meow-change</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="o">.</span> <span class="nv">meow-delete</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;D&#34;</span> <span class="o">.</span> <span class="nv">meow-backward-delete</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="o">.</span> <span class="nv">meow-next-word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;E&#34;</span> <span class="o">.</span> <span class="nv">meow-next-symbol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="o">.</span> <span class="nv">meow-find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="o">.</span> <span class="nv">meow-cancel-selection</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;G&#34;</span> <span class="o">.</span> <span class="nv">meow-grab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;h&#34;</span> <span class="o">.</span> <span class="nv">meow-left</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;H&#34;</span> <span class="o">.</span> <span class="nv">meow-left-expand</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;i&#34;</span> <span class="o">.</span> <span class="nv">meow-insert</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;I&#34;</span> <span class="o">.</span> <span class="nv">meow-open-above</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="o">.</span> <span class="nv">meow-next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;J&#34;</span> <span class="o">.</span> <span class="nv">meow-next-expand</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="o">.</span> <span class="nv">meow-prev</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;K&#34;</span> <span class="o">.</span> <span class="nv">meow-prev-expand</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="o">.</span> <span class="nv">meow-right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;L&#34;</span> <span class="o">.</span> <span class="nv">meow-right-expand</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="o">.</span> <span class="nv">meow-join</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="o">.</span> <span class="nv">meow-search</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;o&#34;</span> <span class="o">.</span> <span class="nv">meow-block</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;O&#34;</span> <span class="o">.</span> <span class="nv">meow-to-block</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="o">.</span> <span class="nv">meow-yank</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="o">.</span> <span class="nv">meow-quit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Q&#34;</span> <span class="o">.</span> <span class="nv">meow-goto-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="o">.</span> <span class="nv">meow-replace</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;R&#34;</span> <span class="o">.</span> <span class="nv">meow-swap-grab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="o">.</span> <span class="nv">meow-kill</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="o">.</span> <span class="nv">meow-till</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="o">.</span> <span class="nv">meow-undo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;U&#34;</span> <span class="o">.</span> <span class="nv">meow-undo-in-selection</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;v&#34;</span> <span class="o">.</span> <span class="nv">meow-visit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;w&#34;</span> <span class="o">.</span> <span class="nv">meow-mark-word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;W&#34;</span> <span class="o">.</span> <span class="nv">meow-mark-symbol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;x&#34;</span> <span class="o">.</span> <span class="nv">meow-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;X&#34;</span> <span class="o">.</span> <span class="nv">meow-goto-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;y&#34;</span> <span class="o">.</span> <span class="nv">meow-save</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Y&#34;</span> <span class="o">.</span> <span class="nv">meow-sync-grab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;z&#34;</span> <span class="o">.</span> <span class="nv">meow-pop-selection</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&#39;&#34;</span> <span class="o">.</span> <span class="nv">repeat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&lt;escape&gt;&#34;</span> <span class="o">.</span> <span class="nv">ignore</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">meow-setup</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">meow-global-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-meow</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-meow.el ends here</span>
</span></span></code></pre></div><h3 id="beancount-dot-el">beancount.el<a hidden class="anchor" aria-hidden="true" href="#beancount-dot-el">¶</a></h3>
<p><a href="https://github.com/beancount/beancount-mode">GitHub - beancount/beancount-mode: Emacs major-mode to work with Beancount le&hellip;</a>，这里是将其中的 <code>beancount.el</code> 下载到 <code>.emacs.d/lisp/</code> 目录下，加上下列代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;auto-mode-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\.beancount\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">beancount-mode</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="init-epla-dot-el">init-epla.el<a hidden class="anchor" aria-hidden="true" href="#init-epla-dot-el">¶</a></h3>
<p>增加 <code>use-package</code> 和 <code>straight</code> 的支持</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;; Bootstrap `use-package&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">&#39;use-package</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">eval-and-compile</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-ensure</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-defer</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-demand</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-expand-minimally</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-enable-imenu-support</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">eval-when-compile</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;use-package</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Install straight.el</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">bootstrap-version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">bootstrap-file</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;straight/repos/straight.el/bootstrap.el&#34;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">bootstrap-version</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">bootstrap-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-current-buffer</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">url-retrieve-synchronously</span>
</span></span><span class="line"><span class="cl">         <span class="s">&#34;https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="ss">&#39;silent</span> <span class="ss">&#39;inhibit-cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">eval-print-last-sexp</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">load</span> <span class="nv">bootstrap-file</span> <span class="no">nil</span> <span class="ss">&#39;nomessage</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="init-local-dot-el">init-local.el<a hidden class="anchor" aria-hidden="true" href="#init-local-dot-el">¶</a></h3>
<p>在 <code>init.el</code> 中有如下代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;; Allow users to provide an optional &#34;init-local&#34; containing personal settings</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;init-local</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>默认没有 <code>init-local.org</code> 这个文件，创建一个，就可以往里面塞自己的配置了。</p>
<h4 id="consult">Consult<a hidden class="anchor" aria-hidden="true" href="#consult">¶</a></h4>
<p>Purcell 中已经包含了这个 package，也有 <code>consult-ripgrep</code> 这个方法。需要安装 <code>ripgrep</code>​。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install ripgrep
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">bms/org-roam-rg-search</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Search org-roam directory using consult-ripgrep. With live-preview.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">consult-ripgrep-command</span> <span class="s">&#34;rg --null --ignore-case --type org --line-buffered --color=always --max-columns=500 --no-heading --line-number . -e ARG OPTS&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">consult-ripgrep</span> <span class="nv">org-roam-directory</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c rr&#34;</span><span class="p">)</span> <span class="ss">&#39;bms/org-roam-rg-search</span><span class="p">)</span>
</span></span></code></pre></div><p>搜索 <code>org-roam-directory</code> 下的内容。</p>
<h4 id="deft">Deft<a hidden class="anchor" aria-hidden="true" href="#deft">¶</a></h4>
<p>用作一些不想放在 <code>org-roam</code> 中的一些笔记的操作。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;deft</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-extensions</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;md&#34;</span> <span class="s">&#34;tex&#34;</span> <span class="s">&#34;org&#34;</span> <span class="s">&#34;mw&#34;</span> <span class="s">&#34;conf&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-directory</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-recursive</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;deft-parse-title</span> <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">cm/deft-parse-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-strip-summary-regexp</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\(&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;[\n\t]&#34;</span> <span class="c1">;; blank</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^#\\+[[:alpha:]_]+:.*$&#34;</span> <span class="c1">;; org-mode metadata</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^#\s[-]*$&#34;</span> <span class="c1">;; org-mode metadata</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^:PROPERTIES:\n\\(.+\n\\)+:END:\n&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\)&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">f7</span><span class="p">]</span> <span class="ss">&#39;deft</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-x C-g&#34;</span><span class="p">)</span> <span class="ss">&#39;deft-find-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; deft parse title</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">cm/deft-parse-title</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Parse the given FILE and CONTENTS and determine the title.
</span></span></span><span class="line"><span class="cl"><span class="s">If </span><span class="ss">`deft-use-filename-as-title&#39;</span><span class="s"> is nil, the title is taken to
</span></span></span><span class="line"><span class="cl"><span class="s">be the first non-empty line of the FILE.  Else the base name of the FILE is
</span></span></span><span class="line"><span class="cl"><span class="s">used as title.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">begin</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;^#\\+[tT][iI][tT][lL][eE]: .*$&#34;</span> <span class="nv">contents</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">begin</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">string-trim</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">contents</span> <span class="nv">begin</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">))</span> <span class="s">&#34;#\\+[tT][iI][tT][lL][eE]: *&#34;</span> <span class="s">&#34;[\n\t ]+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">deft-base-filename</span> <span class="nv">file</span><span class="p">))))</span>
</span></span></code></pre></div><h4 id="ox-hugo">Ox-hugo<a hidden class="anchor" aria-hidden="true" href="#ox-hugo">¶</a></h4>
<p>导出到 Hugo，方便与他人分享内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;ox-hugo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;ox</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ox-hugo</span><span class="p">))</span>
</span></span></code></pre></div><p>导出到 Hugo 还需要在文件头部添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+HUGO_BASE_DIR</span><span class="c">: ~/Dropbox/hugo/</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_SECTION</span><span class="c">: posts/main</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_WEIGHT</span><span class="c">: auto</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_AUTO_SET_LASTMOD</span><span class="c">: t</span>
</span></span></code></pre></div><p>需要到处为 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+header</span><span class="c">: :trim-pre nil :trim-post nil</span>
</span></span><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><h4 id="latex--auctex-plus-cdlatex">Latex(auctex + cdlatex)<a hidden class="anchor" aria-hidden="true" href="#latex--auctex-plus-cdlatex">¶</a></h4>
<p>离线分享的时候最大程度的保持原貌的方法就是 PDF。</p>
<p>需要安装 <code>texlive</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install texlive
</span></span></code></pre></div><p>Latex 语法可以参考：<a href="/posts/main/20220616162256-latex/">Latex</a></p>
<p>导出含有中文时是需要配置 CJK，<a href="https://github.com/ElegantLaTeX/ElegantPaper/blob/master/elegantpaper.cls">ElegantPaper</a> 可以跨过这一步设置，只需要将 <code>elegantpaper.cls</code> 放到需要导出 PDF 的目录下，同时安装依赖。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install pygments
</span></span></code></pre></div><p>在导出文件头部增加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+LATEX_COMPILER</span><span class="c">: xelatex</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+LATEX_CLASS</span><span class="c">: elegantpaper</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+OPTIONS</span><span class="c">: prop:t</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;auctex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;cdlatex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span> <span class="ss">&#39;turn-on-cdlatex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;ox-latex</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; http://orgmode.org/worg/org-faq.html#using-xelatex-for-pdf-export</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; latexmk runs pdflatex/xelatex (whatever is specified) multiple times</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; automatically to resolve the cross-references.</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-pdf-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;latexmk -xelatex -quiet -shell-escape -f %f&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
</span></span><span class="line"><span class="cl">               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;elegantpaper&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;\\documentclass[lang=cn]{elegantpaper}
</span></span></span><span class="line"><span class="cl"><span class="s">                 [NO-DEFAULT-PACKAGES]
</span></span></span><span class="line"><span class="cl"><span class="s">                 [PACKAGES]
</span></span></span><span class="line"><span class="cl"><span class="s">                 [EXTRA]&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\paragraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\paragraph*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subparagraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subparagraph*{%s}&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-listings</span> <span class="ss">&#39;minted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-packages-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="s">&#34;minted&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><h3 id="init-corfu-dot-el">init-corfu.el<a hidden class="anchor" aria-hidden="true" href="#init-corfu-dot-el">¶</a></h3>
<p>增加了 <code>kind-icon</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-corfu.el --- Interactive completion in buffers -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; WAITING: haskell-mode sets tags-table-list globally, breaks tags-completion-at-point-function</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO Default sort order should place [a-z] before punctuation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">tab-always-indent</span> <span class="ss">&#39;complete</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;orderless</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;vertico</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;orderless</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-styles</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">orderless</span> <span class="nv">basic</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-category-defaults</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">completion-category-overrides</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-cycle-threshold</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;corfu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">corfu-auto</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;eshell</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;eshell-mode-hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">setq-local</span> <span class="nv">corfu-auto</span> <span class="no">nil</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">corfu-quit-no-match</span> <span class="ss">&#39;separator</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="ss">&#39;global-corfu-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;corfu-doc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;corfu</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;corfu-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">corfu-doc-mode</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; TODO: https://github.com/jdtsmith/kind-icon</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;kind-icon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;corfu</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;corfu-margin-formatters</span> <span class="nf">#&#39;</span><span class="nv">kind-icon-margin-formatter</span><span class="p">)</span> <span class="c1">; Enable `kind-icon&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-corfu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-corfu.el ends here</span>
</span></span></code></pre></div><h3 id="init-themes-dot-el">init-themes.el<a hidden class="anchor" aria-hidden="true" href="#init-themes-dot-el">¶</a></h3>
<p>用的 <a href="https://protesilaos.com/emacs/ef-themes-pictures">Screen shots of the Ef themes for GNU Emacs | Protesilaos Stavrou</a>，​<code>ef-spring</code> 作为非编码时的主题，​<code>ef-night</code> 作为编码时的主题。另外设置背景透明以及光标所在代码块按照括号高亮的函数也在放在这里。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-themes.el --- Defaults for themes -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;ef-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Don&#39;t prompt to confirm theme safety. This avoids problems with</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; first-time startup on Emacs &gt; 26.3.</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">custom-safe-themes</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; If you don&#39;t customize it, this is the theme you get.</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">custom-enabled-themes</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ef-spring</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Ensure that themes will be applied even if they have not been customized</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">reapply-themes</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Forcibly load the themes listed in </span><span class="ss">`custom-enabled-themes&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">theme</span> <span class="nv">custom-enabled-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">custom-theme-p</span> <span class="nv">theme</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">load-theme</span> <span class="nv">theme</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">custom-set-variables</span> <span class="o">`</span><span class="p">(</span><span class="nv">custom-enabled-themes</span> <span class="p">(</span><span class="nb">quote</span> <span class="o">,</span><span class="nv">custom-enabled-themes</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="ss">&#39;reapply-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Toggle between light and dark</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">light</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Activate a light color theme.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">custom-enabled-themes</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ef-spring</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">reapply-themes</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">dark</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Activate a dark color theme.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">custom-enabled-themes</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">ef-night</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">reapply-themes</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;dimmer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">dimmer-fraction</span> <span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="ss">&#39;dimmer-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;dimmer</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; TODO: file upstream as a PR</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;frame-set-background-mode</span> <span class="nb">:after</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span> <span class="p">(</span><span class="nv">dimmer-process-all</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;dimmer</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Don&#39;t dim in terminal windows. Even with 256 colours it can</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; lead to poor contrast.  Better would be to vary dimmer-fraction</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; according to frame type.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/display-non-graphic-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;dimmer-exclusion-predicates</span> <span class="ss">&#39;sanityinc/display-non-graphic-p</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; fake transparency</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (defun user/change-background-opacity (alpha)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (interactive &#34;nOpacity: &#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (if (and (&gt;= alpha 0) (&lt;= alpha 100))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;       (user/set-background-opacity alpha)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;     (format-message &#34;Opacity has to be between 0 and 100 but is %d.&#34; alpha)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; (defun user/set-background-opacity (alpha)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (set-frame-parameter (selected-frame) &#39;alpha alpha)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (add-to-list &#39;default-frame-alist (cons &#39;alpha alpha)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; (user/set-background-opacity 90)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; true transparency</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">kb/toggle-window-transparency</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Toggle transparency.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">alpha-transparency</span> <span class="mi">50</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">pcase</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;alpha-background</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">alpha-transparency</span> <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;alpha-background</span> <span class="mi">100</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;alpha-background</span> <span class="nv">alpha-transparency</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">kb/toggle-window-transparency</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 高亮光标所在的括号内容，提高阅读效率。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">&#39;highlight-blocks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">&#39;highlight-blocks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;highlight-blocks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">highlight-blocks--get-bounds</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get the bounds of the nested blocks the point is in.
</span></span></span><span class="line"><span class="cl"><span class="s">The returned value is a list of conses, where car is the start of a
</span></span></span><span class="line"><span class="cl"><span class="s">block and cdr is the end of a block, starting from the outermost
</span></span></span><span class="line"><span class="cl"><span class="s">block.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">result</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">parse-sexp-ignore-comments</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">condition-case</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">parse-state</span> <span class="p">(</span><span class="nv">syntax-ppss</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">starting-pos</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">3</span> <span class="nv">parse-state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                     <span class="p">(</span><span class="nf">nth</span> <span class="mi">4</span> <span class="nv">parse-state</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nf">nth</span> <span class="mi">8</span> <span class="nv">parse-state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                               <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">begins</span> <span class="p">(</span><span class="nf">nreverse</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">9</span> <span class="nv">parse-state</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">end</span> <span class="nv">starting-pos</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">highlight-blocks-max-innermost-block-count</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">i</span> <span class="nv">highlight-blocks-max-innermost-block-count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">end</span> <span class="p">(</span><span class="nf">scan-lists</span> <span class="nv">end</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">begins</span><span class="p">)</span> <span class="nv">end</span><span class="p">)</span> <span class="nv">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">i</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">scan-error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 修改下这个函数函数的返回值，可以只高亮当前所在的块</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">last</span> <span class="nv">result</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Put the mode hooks where you want it, for example</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span>       <span class="ss">&#39;highlight-blocks--get-bounds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (add-hook &#39;lisp-interaction-mode-hook &#39;highlight-blocks-mode)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (add-hook &#39;lisp-mode-hook             &#39;highlight-blocks-mode)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-themes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-themes.el ends here</span>
</span></span></code></pre></div><h3 id="init-elfeed-dot-el">init-elfeed.el<a hidden class="anchor" aria-hidden="true" href="#init-elfeed-dot-el">¶</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-elfeed.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;elfeed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-x w&#34;</span><span class="p">)</span> <span class="ss">&#39;elfeed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">elfeed-org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">elfeed-org</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">rmh-elfeed-org-files</span> <span class="p">(</span><span class="nf">list</span> <span class="s">&#34;~/Dropbox/org/elfeed.org&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">concatenate-authors</span> <span class="p">(</span><span class="nv">authors-list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Given AUTHORS-LIST, list of plists; return string of all authors
</span></span></span><span class="line"><span class="cl"><span class="s">concatenated.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">mapconcat</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">author</span><span class="p">)</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">author</span> <span class="nb">:name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="nv">authors-list</span> <span class="s">&#34;, &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-search-print-fn</span> <span class="p">(</span><span class="nv">entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Print ENTRY to the buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">date</span> <span class="p">(</span><span class="nv">elfeed-search-format-date</span> <span class="p">(</span><span class="nv">elfeed-entry-date</span> <span class="nv">entry</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">title</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">elfeed-meta</span> <span class="nv">entry</span> <span class="nb">:title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nv">elfeed-entry-title</span> <span class="nv">entry</span><span class="p">)</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">title-faces</span> <span class="p">(</span><span class="nv">elfeed-search--faces</span> <span class="p">(</span><span class="nv">elfeed-entry-tags</span> <span class="nv">entry</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">feed</span> <span class="p">(</span><span class="nv">elfeed-entry-feed</span> <span class="nv">entry</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">feed-title</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">when</span> <span class="nv">feed</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">elfeed-meta</span> <span class="nv">feed</span> <span class="nb">:title</span><span class="p">)</span> <span class="p">(</span><span class="nv">elfeed-feed-title</span> <span class="nv">feed</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">entry-authors</span> <span class="p">(</span><span class="nv">concatenate-authors</span>
</span></span><span class="line"><span class="cl">                         <span class="p">(</span><span class="nv">elfeed-meta</span> <span class="nv">entry</span> <span class="nb">:authors</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="nf">#&#39;symbol-name</span> <span class="p">(</span><span class="nv">elfeed-entry-tags</span> <span class="nv">entry</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags-str</span> <span class="p">(</span><span class="nf">mapconcat</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">s</span> <span class="ss">&#39;face</span>
</span></span><span class="line"><span class="cl">                                            <span class="ss">&#39;elfeed-search-tag-face</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">tags</span> <span class="s">&#34;,&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">title-width</span> <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nv">window-width</span><span class="p">)</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">                         <span class="nv">elfeed-search-trailing-width</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">title-column</span> <span class="p">(</span><span class="nv">elfeed-format-column</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">title</span> <span class="p">(</span><span class="nv">elfeed-clamp</span>
</span></span><span class="line"><span class="cl">                               <span class="nv">elfeed-search-title-min-width</span>
</span></span><span class="line"><span class="cl">                               <span class="nv">title-width</span>
</span></span><span class="line"><span class="cl">                               <span class="nv">elfeed-search-title-max-width</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">:left</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">authors-width</span> <span class="mi">135</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">authors-column</span> <span class="p">(</span><span class="nv">elfeed-format-column</span>
</span></span><span class="line"><span class="cl">                        <span class="nv">entry-authors</span> <span class="p">(</span><span class="nv">elfeed-clamp</span>
</span></span><span class="line"><span class="cl">                               <span class="nv">elfeed-search-title-min-width</span>
</span></span><span class="line"><span class="cl">                               <span class="nv">authors-width</span>
</span></span><span class="line"><span class="cl">                               <span class="mi">131</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">:left</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">date</span> <span class="ss">&#39;face</span> <span class="ss">&#39;elfeed-search-date-face</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">title-column</span>
</span></span><span class="line"><span class="cl">                        <span class="ss">&#39;face</span> <span class="nv">title-faces</span> <span class="ss">&#39;kbd-help</span> <span class="nv">title</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">authors-column</span>
</span></span><span class="line"><span class="cl">                        <span class="ss">&#39;face</span> <span class="ss">&#39;elfeed-search-date-face</span>
</span></span><span class="line"><span class="cl">                        <span class="ss">&#39;kbd-help</span> <span class="nv">entry-authors</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">;; (when feed-title</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;;   (insert (propertize entry-authors</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; &#39;face &#39;elfeed-search-feed-face) &#34; &#34;))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="nv">entry-authors</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">feed-title</span>
</span></span><span class="line"><span class="cl">                          <span class="ss">&#39;face</span> <span class="ss">&#39;elfeed-search-feed-face</span><span class="p">)</span> <span class="s">&#34; &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">;; (when tags</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;;   (insert &#34;(&#34; tags-str &#34;)&#34;))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">elfeed-search-print-entry-function</span> <span class="nf">#&#39;</span><span class="nv">my-search-print-fn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-elfeed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-elfeed.el ends here</span>
</span></span></code></pre></div><h3 id="init-telega-dot-el">init-telega.el<a hidden class="anchor" aria-hidden="true" href="#init-telega-dot-el">¶</a></h3>
<p><code>brew install tdlib</code> 的版本过低，需要自行编译，参考 <a href="https://tdlib.github.io/td/build.html?language=Swift">TDLib build instructions</a> 。这个之后需要 <code>M-x telega-server-build</code> 重新加载 telega-server。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">xcode-select --install
</span></span><span class="line"><span class="cl">/bin/bash -c <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">brew install gperf cmake openssl
</span></span><span class="line"><span class="cl">git clone https://github.com/tdlib/td.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> td
</span></span><span class="line"><span class="cl">rm -rf build
</span></span><span class="line"><span class="cl">mkdir build
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release -DOPENSSL_ROOT_DIR<span class="o">=</span>/usr/local/opt/openssl/ -DCMAKE_INSTALL_PREFIX:PATH<span class="o">=</span>/usr/local ..
</span></span><span class="line"><span class="cl">cmake --build . --target install
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">ls -l /usr/local
</span></span></code></pre></div><p>其中 tblib 的版本当前需要 1.8.4，可以切换到 1.8.4 的版本。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout b447c32fe94c3d62d74c6b9608649c791641c3e5
</span></span></code></pre></div><table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>C-c C-v</code></td>
<td>发送图片</td>
<td><code>brew install pngpaste</code></td>
</tr>
<tr>
<td><code>!</code></td>
<td>点赞</td>
<td></td>
</tr>
<tr>
<td><code>C-c C-a</code></td>
<td>Attachment type</td>
<td>其中 markup 可以发送 md 等格式</td>
</tr>
</tbody>
</table>
<p><strong>头像裂开的问题</strong>​：是由于字体高度问题导致的，安装 <code>init-font.el</code> 中的设置，​<code>Iosevka</code> 和 <code>LXGW WenKai</code> 配合，并设置 <code>(add-to-list 'face-font-rescale-alist '(&quot;Apple Color Emoji&quot; . 0.8))</code> 可以实现头像不裂开。但由于 Emoji 以及各种昵称中的特殊字符，比如 Noto Sans Egyptian Hieroglyphs 这种古埃及象形文字，以及 Noto Sans Kannada 和 STIXGeneral 等字体，出现在昵称以及 Reply 行中，都会导致头像裂开。</p>
<p>有几种解决的方案。</p>
<ol>
<li>使用更纱黑体（字体太丑且并不能兼容那些使用第三点当中提到的特殊字体的情况）。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">telega-buffer-face-mode-variable</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">make-face</span> <span class="ss">&#39;my-telega-face</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (set-face-attribute &#39;my-telega-face nil :font &#34;M+ 1m&#34;)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;my-telega-face</span> <span class="no">nil</span> <span class="nb">:font</span> <span class="s">&#34;Sarasa Mono SC Nerd 13&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">buffer-face-mode-face</span> <span class="ss">&#39;my-telega-face</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">buffer-face-mode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;telega-root-mode-hook</span> <span class="ss">&#39;telega-buffer-face-mode-variable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;telega-webpage-mode-hook</span> <span class="ss">&#39;telega-buffer-face-mode-variable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;telega-chat-mode-hook</span> <span class="ss">&#39;telega-buffer-face-mode-variable</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>使用 <code>(setf (alist-get 2 telega-avatar-factors-alist) '(0.5 . 0.1))</code> 来使得本来两行显示的头像缩小至一行显示（头像显示几乎废了）。</li>
<li>在基础字号的基础上（这里是 14）调整特殊字符/字体的缩放就可以完美解决头像裂开的问题了，完整代码如下。</li>
</ol>
<!--listend-->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-telega.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;telega</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c t&#34;</span><span class="p">)</span> <span class="nv">telega-prefix-map</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 去除昵称、回复行的背景高亮</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-telega-chat-mode</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; telega-msg-inline-reply   ⊆ telega-msg-heading</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; telega-msg-inline-forward ⊆ telega-msg-heading</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-msg-heading</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:underline</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:style</span> <span class="nv">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:inherit</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:background</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-msg-inline-reply</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:foreground</span> <span class="s">&#34;#7BA23F&#34;</span><span class="p">)</span> <span class="c1">;; 萌黄 MOEGI</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-msg-inline-forward</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:foreground</span> <span class="s">&#34;#7BA23F&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-msg-self-title</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:foreground</span> <span class="s">&#34;#FFB11B&#34;</span><span class="p">)</span> <span class="c1">;; 山吹 YAMABUKI</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-msg-user-title</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:weight</span> <span class="ss">&#39;bold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;telega-entity-type-mention</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:underline</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:style</span> <span class="nv">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                      <span class="nb">:weight</span> <span class="ss">&#39;bold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 缩小 emoji 及特殊字符/字体显示，防止头像裂开。</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;face-font-rescale-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Apple Color Emoji&#34;</span> <span class="o">.</span> <span class="mf">0.8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;face-font-rescale-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Noto Sans Egyptian Hieroglyphs&#34;</span> <span class="o">.</span> <span class="mf">0.675</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;face-font-rescale-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;STIXGeneral&#34;</span> <span class="o">.</span> <span class="mf">0.675</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;face-font-rescale-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Apple Symbols&#34;</span> <span class="o">.</span> <span class="mf">0.675</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;face-font-rescale-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;Noto Sans Kannada&#34;</span> <span class="o">.</span> <span class="mf">0.675</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;telega-chat-mode-hook</span> <span class="ss">&#39;my-telega-chat-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-telega</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-telega.el ends here</span>
</span></span></code></pre></div><h3 id="init-org-modern-dot-el">init-org-modern.el<a hidden class="anchor" aria-hidden="true" href="#init-org-modern-dot-el">¶</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-org-modern.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-modern</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-modern</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">org-modern-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-modern-block</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-radio-target</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-internal-target</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-list</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-star nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-timestamp</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-checkbox nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-todo</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-footnote nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-block-name</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-priority</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-progress</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-keyword</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-table</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-tag</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-statistics</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-horizontal-rule</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-ellipsis</span> <span class="s">&#34;[+]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-faces</span>
</span></span><span class="line"><span class="cl"> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-ellipsis</span> <span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="nb">:foreground</span> <span class="s">&#34;#90B44B&#34;</span><span class="p">)))))</span> <span class="c1">;; 鶸萌黄</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-org-modern</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-org-modern.el ends here</span>
</span></span></code></pre></div><h3 id="init-quick-menus-dot-el">init-quick-menus.el<a hidden class="anchor" aria-hidden="true" href="#init-quick-menus-dot-el">¶</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-quick-menus.el  --- Custom configuration</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; org-starter</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-starter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-outline-path</span> <span class="ss">&#39;file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-starter</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (add-hook! &#39;after-init-hook &#39;org-starter-load-all-files-in-path)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-starter-def</span> <span class="s">&#34;~/Dropbox/org&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:files</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/inbox.org&#34;</span>                <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;i&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/work.org&#34;</span>                 <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;w&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/technical-debt.org&#34;</span>       <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;t&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/personal.org&#34;</span>             <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;p&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/books.org&#34;</span>                <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;b&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/someday.org&#34;</span>              <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;s&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/agenda.org&#34;</span>               <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;a&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/note.org&#34;</span>                 <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;n&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;daily/journal.org&#34;</span>               <span class="nb">:agenda</span> <span class="no">t</span>   <span class="nb">:key</span> <span class="s">&#34;j&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/2022.beancount&#34;</span>        <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;c&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/account.beancount&#34;</span>     <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;m&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/credit.beancount&#34;</span>      <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;e&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/insurance.beancount&#34;</span>   <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;u&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/salary.beancount&#34;</span>      <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;l&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;beancount/house.beancount&#34;</span>       <span class="nb">:agenda</span> <span class="no">nil</span> <span class="nb">:key</span> <span class="s">&#34;h&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; hydra</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;hydra</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-org-agenda-menu</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  Org-agenda-menu
</span></span></span><span class="line"><span class="cl"><span class="s">  ^^^^------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="s">  _i_: inbox     _w_: work      _b_: books     _t_: technical-debt
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">  _a_: agenda    _p_: personal  _n_: note      _s_: someday   _j_: journal
</span></span></span><span class="line"><span class="cl"><span class="s">  Beancount-menu
</span></span></span><span class="line"><span class="cl"><span class="s">  ^^^^------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="s">  _c_: 2022      _m_: account   _e_: credit    _u_: insurance
</span></span></span><span class="line"><span class="cl"><span class="s">  _l_: salary    _h_: house
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;i&#34;</span> <span class="nv">org-starter-find-file:inbox</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;w&#34;</span> <span class="nv">org-starter-find-file:work</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="nv">org-starter-find-file:technical-debt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="nv">org-starter-find-file:personal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="nv">org-starter-find-file:books</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="nv">org-starter-find-file:note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="nv">org-starter-find-file:someday</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="nv">org-starter-find-file:agenda</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="nv">org-starter-find-file:journal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;c&#34;</span> <span class="nv">org-starter-find-file:2022</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="nv">org-starter-find-file:account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="nv">org-starter-find-file:credit</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="nv">org-starter-find-file:insurance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="nv">org-starter-find-file:salary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;h&#34;</span> <span class="nv">org-starter-find-file:house</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="nb">:bind</span><span class="p">(</span><span class="s">&#34;C-c e&#34;</span> <span class="o">.</span> <span class="nv">hydra-org-agenda-menu/body</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-quick-menus</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-quick-menus.el ends here</span>
</span></span></code></pre></div><h3 id="init-tree-sitter-dot-el">init-tree-sitter.el<a hidden class="anchor" aria-hidden="true" href="#init-tree-sitter-dot-el">¶</a></h3>
<p>其中 <code>elisp</code> 官方还未支持，需要自己编译后放入 <code>tree-sitter-langs</code> 下面。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/Wilfred/tree-sitter-elisp
</span></span><span class="line"><span class="cl">gcc ./src/parser.c -fPIC -I./ --shared -o elisp.so
</span></span><span class="line"><span class="cl">cp ./elisp.so ~/.tree-sitter-langs/bin
</span></span></code></pre></div><p>这里第二步的时候报错了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./src/parser.c:1:10: error: <span class="s1">&#39;tree_sitter/parser.h&#39;</span> file not found with &lt;angled&gt; include<span class="p">;</span> use <span class="s2">&#34;quotes&#34;</span> instead
</span></span><span class="line"><span class="cl"><span class="c1">#include &lt;tree_sitter/parser.h&gt;</span>
</span></span><span class="line"><span class="cl">         ^~~~~~~~~~~~~~~~~~~~~~
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;tree_sitter/parser.h&#34;</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> error generated.
</span></span></code></pre></div><p>这里需要将 <code>src/parser.c</code> 头部按照提示修改一下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gd">- #include &lt;tree_sitter/parser.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+ #include &#34;tree_sitter/parser.h&#34;
</span></span></span></code></pre></div><p>第三步，由于我是通过 MELPA 安装，路径为 <code>.emacs.d/elpa-29.0/tree-sitter-langs-version/bin</code>​，其中 <code>version</code> 为具体的版本号。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-tree-sitter.el --- Configure for tree sitter</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;tree-sitter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;tree-sitter-langs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;tree-sitter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;tree-sitter-langs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-tree-sitter-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;tree-sitter-after-on-hook</span> <span class="nf">#&#39;</span><span class="nv">tree-sitter-hl-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Load the language definition for Rust, if it hasn&#39;t been loaded.</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Return the language object.</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">tree-sitter-require</span> <span class="ss">&#39;rust</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">tree-sitter-require</span> <span class="ss">&#39;python</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">tree-sitter-require</span> <span class="ss">&#39;javascript</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Add Emacs-Lisp for tree-sitter:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 1. git clone https://github.com/Wilfred/tree-sitter-elisp</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 2. gcc ./src/parser.c -fPIC -I./ --shared -o elisp.so</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 3. cp ./elisp.so ~/.tree-sitter-langs/bin (~/.tree-sitter-langs/bin is path of your tree-sitter-langs repo)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">tree-sitter-load</span> <span class="ss">&#39;elisp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;tree-sitter-major-mode-language-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">emacs-lisp-mode</span> <span class="o">.</span> <span class="nv">elisp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;tree-sitter-major-mode-language-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">inferior-emacs-lisp-mode</span> <span class="o">.</span> <span class="nv">elisp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-tree-sitter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-tree-sitter.el ends here</span>
</span></span></code></pre></div><h3 id="init-org-enhance-dot-el">init-org-enhance.el<a hidden class="anchor" aria-hidden="true" href="#init-org-enhance-dot-el">¶</a></h3>
<p>一些增强 org 功能的函数，可以方便使用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-org.el --- Org-mode config -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ==============  Org-roam-backlinks-search  ==================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; https://github.com/Vidianos-Giannitsis/Dotfiles/blob/master/emacs/.emacs.d/libs/zettelkasten.org#org-roam-backlinks-search</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defcustom</span> <span class="nv">org-roam-backlinks-choices</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;View Backlinks&#34;</span> <span class="s">&#34;Go to Node&#34;</span> <span class="s">&#34;Quit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;List of choices for </span><span class="ss">`org-roam-backlinks-node-read&#39;</span><span class="s">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-query*</span> <span class="p">(</span><span class="nv">NODE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Gets the backlinks of NODE with </span><span class="ss">`org-roam-db-query&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">org-roam-db-query</span>
</span></span><span class="line"><span class="cl">          <span class="p">[</span><span class="nb">:select</span> <span class="p">[</span><span class="nv">source</span> <span class="nv">dest</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:from</span> <span class="nv">links</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:where</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">dest</span> <span class="nv">$s1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:and</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">type</span> <span class="s">&#34;id&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-roam-node-id</span> <span class="nv">NODE</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-p</span> <span class="p">(</span><span class="nv">SOURCE</span> <span class="nv">NODE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Predicate function that checks if NODE is a backlink of SOURCE.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">source-id</span> <span class="p">(</span><span class="nv">org-roam-node-id</span> <span class="nv">SOURCE</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">backlinks</span> <span class="p">(</span><span class="nv">org-roam-backlinks-query*</span> <span class="nv">SOURCE</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">id</span> <span class="p">(</span><span class="nv">org-roam-node-id</span> <span class="nv">NODE</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">id-list</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">id</span> <span class="nv">source-id</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">member</span> <span class="nv">id-list</span> <span class="nv">backlinks</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-poi-or-moc-p</span> <span class="p">(</span><span class="nv">NODE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Check if NODE has the tag POI or the tag MOC.  Return t if it does.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">string-equal</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-roam-node-tags</span> <span class="nv">NODE</span><span class="p">))</span> <span class="s">&#34;POI&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">string-equal</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-roam-node-tags</span> <span class="nv">NODE</span><span class="p">))</span> <span class="s">&#34;MOC&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks--read-node-backlinks</span> <span class="p">(</span><span class="nv">source</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Runs </span><span class="ss">`org-roam-node-read&#39;</span><span class="s"> on the backlinks of SOURCE.
</span></span></span><span class="line"><span class="cl"><span class="s"> The predicate used as </span><span class="ss">`org-roam-node-read&#39;</span><span class="s">&#39;s filter-fn is
</span></span></span><span class="line"><span class="cl"><span class="s"> </span><span class="ss">`org-roam-backlinks-p&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">org-roam-node-read</span> <span class="no">nil</span> <span class="p">(</span><span class="nv">apply-partially</span> <span class="nf">#&#39;</span><span class="nv">org-roam-backlinks-p</span> <span class="nv">source</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-node-read</span> <span class="p">(</span><span class="nv">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Read a NODE and run </span><span class="ss">`org-roam-backlinks--read-node-backlinks&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s"> Upon selecting a backlink, prompt the user for what to do with
</span></span></span><span class="line"><span class="cl"><span class="s"> the backlink. The prompt is created with </span><span class="ss">`completing-read&#39;</span><span class="s"> with
</span></span></span><span class="line"><span class="cl"><span class="s"> valid options being everything in the list
</span></span></span><span class="line"><span class="cl"><span class="s"> </span><span class="ss">`org-roam-backlinks-choices&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> If the user decides to view the selected node&#39;s backlinks, the
</span></span></span><span class="line"><span class="cl"><span class="s"> function recursively runs itself with the selection as its
</span></span></span><span class="line"><span class="cl"><span class="s"> argument. If they decide they want to go to the selected node,
</span></span></span><span class="line"><span class="cl"><span class="s"> the function runs </span><span class="ss">`find-file&#39;</span><span class="s"> and the file associated to that
</span></span></span><span class="line"><span class="cl"><span class="s"> node. Lastly, if they choose to quit, the function exits
</span></span></span><span class="line"><span class="cl"><span class="s"> silently.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">backlink</span> <span class="p">(</span><span class="nv">org-roam-backlinks--read-node-backlinks</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">choice</span> <span class="p">(</span><span class="nf">completing-read</span> <span class="s">&#34;What to do with NODE: &#34;</span>
</span></span><span class="line"><span class="cl">                                    <span class="nv">org-roam-backlinks-choices</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">cond</span>
</span></span><span class="line"><span class="cl">      <span class="p">((</span><span class="nf">string-equal</span>
</span></span><span class="line"><span class="cl">         <span class="nv">choice</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">car</span> <span class="nv">org-roam-backlinks-choices</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-backlinks-node-read</span> <span class="nv">backlink</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">((</span><span class="nf">string-equal</span>
</span></span><span class="line"><span class="cl">         <span class="nv">choice</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">cadr</span> <span class="nv">org-roam-backlinks-choices</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">find-file</span> <span class="p">(</span><span class="nv">org-roam-node-file</span> <span class="nv">backlink</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">((</span><span class="nf">string-equal</span>
</span></span><span class="line"><span class="cl">         <span class="nv">choice</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">caddr</span> <span class="nv">org-roam-backlinks-choices</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-search</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;Select an </span><span class="ss">`org-roam-node&#39;</span><span class="s"> and recursively search its backlinks.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> This function is a starter function for
</span></span></span><span class="line"><span class="cl"><span class="s"> </span><span class="ss">`org-roam-backlinks-node-read&#39;</span><span class="s"> which gets the initial node
</span></span></span><span class="line"><span class="cl"><span class="s"> selection from </span><span class="ss">`org-roam-node-list&#39;</span><span class="s">. For more information about
</span></span></span><span class="line"><span class="cl"><span class="s"> this function, check </span><span class="ss">`org-roam-backlinks-node-read&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">node</span> <span class="p">(</span><span class="nv">org-roam-node-read</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-roam-backlinks-node-read</span> <span class="nv">node</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-backlinks-search-from-moc-or-poi</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;</span><span class="ss">`org-roam-backlinks-search&#39;</span><span class="s"> with an initial selection filter.
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"> Since nodes tagged as \&#34;MOC\&#34; or \&#34;POI\&#34; are the entry points to
</span></span></span><span class="line"><span class="cl"><span class="s"> my personal zettelkasten, I have this helper function which is
</span></span></span><span class="line"><span class="cl"><span class="s"> identical to </span><span class="ss">`org-roam-backlinks-search&#39;</span><span class="s"> but filters initial
</span></span></span><span class="line"><span class="cl"><span class="s"> selection to only those notes. That way, they initial selection
</span></span></span><span class="line"><span class="cl"><span class="s"> has a point as it will be on a node that has a decent amount of
</span></span></span><span class="line"><span class="cl"><span class="s"> backlinks.&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">node</span> <span class="p">(</span><span class="nv">org-roam-node-read</span> <span class="no">nil</span> <span class="nf">#&#39;</span><span class="nv">org-roam-backlinks-poi-or-moc-p</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">org-roam-backlinks-node-read</span> <span class="nv">node</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ===========  Dynamic org-agenda with org-roam  ==============</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; https://gist.github.com/d12frosted/a60e8ccb9aceba031af243dff0d19b2e</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return non-nil if current buffer has any todo entry.
</span></span></span><span class="line"><span class="cl"><span class="s">TODO entries marked as done are ignored, meaning the this
</span></span></span><span class="line"><span class="cl"><span class="s">function returns nil if current buffer contains only completed
</span></span></span><span class="line"><span class="cl"><span class="s">tasks.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">seq-find</span>                                 <span class="c1">; (3)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">eq</span> <span class="nv">type</span> <span class="ss">&#39;todo</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">org-element-map</span>                         <span class="c1">; (2)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">org-element-parse-buffer</span> <span class="ss">&#39;headline</span><span class="p">)</span> <span class="c1">; (1)</span>
</span></span><span class="line"><span class="cl">       <span class="ss">&#39;headline</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:todo-type</span> <span class="nv">h</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-update-tag</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Update dynamic tag in the current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">active-minibuffer-window</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">vulpea-buffer-p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">vulpea-dynamic-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nf">cons</span> <span class="s">&#34;dynamic&#34;</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nv">remove</span> <span class="s">&#34;dynamic&#34;</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">;; cleanup duplicates</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nv">seq-uniq</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">;; update tags if changed</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">tags</span> <span class="nv">original-tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return non-nil if the currently visited buffer is a note.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">and</span> <span class="nf">buffer-file-name</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">string-prefix-p</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">file-name-as-directory</span> <span class="nv">org-roam-directory</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nf">buffer-file-name</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-files</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return a list of note files containing &#39;dynamic&#39; tag.&#34;</span> <span class="c1">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">seq-uniq</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">seq-map</span>
</span></span><span class="line"><span class="cl">      <span class="nf">#&#39;car</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-roam-db-query</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="nb">:select</span> <span class="p">[</span><span class="nv">nodes:file</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:from</span> <span class="nv">tags</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:left-join</span> <span class="nv">nodes</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:on</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">tags:node-id</span> <span class="nv">nodes:id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:where</span> <span class="p">(</span><span class="nv">like</span> <span class="nv">tag</span> <span class="p">(</span><span class="nb">quote</span> <span class="s">&#34;%\&#34;dynamic\&#34;%&#34;</span><span class="p">))]))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-agenda-files-update</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Update the value of </span><span class="ss">`org-agenda-files&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (setq org-agenda-files (vulpea-dynamic-files)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span> <span class="p">(</span><span class="nv">seq-uniq</span>
</span></span><span class="line"><span class="cl">                          <span class="p">(</span><span class="nf">append</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">vulpea-dynamic-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">file-expand-wildcards</span> <span class="s">&#34;~/Dropbox/org/agenda/*.org&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;find-file-hook</span> <span class="nf">#&#39;</span><span class="nv">vulpea-dynamic-update-tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="nf">#&#39;</span><span class="nv">vulpea-dynamic-update-tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-agenda</span> <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">vulpea-agenda-files-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-todo-list</span> <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">vulpea-agenda-files-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; functions borrowed from `vulpea&#39; library</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; https://github.com/d12frosted/vulpea/blob/6a735c34f1f64e1f70da77989e9ce8da7864e5ff/vulpea-buffer.el</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-get</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return filetags value in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">vulpea-buffer-prop-get-list</span> <span class="s">&#34;filetags&#34;</span> <span class="s">&#34;[ :]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-set</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set TAGS in current buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">If filetags value is already set, replace it.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="nv">tags</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">vulpea-buffer-prop-set</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;filetags&#34;</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;:&#34;</span> <span class="p">(</span><span class="nv">string-join</span> <span class="nv">tags</span> <span class="s">&#34;:&#34;</span><span class="p">)</span> <span class="s">&#34;:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">vulpea-buffer-prop-remove</span> <span class="s">&#34;filetags&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-add</span> <span class="p">(</span><span class="nv">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add a TAG to filetags in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags</span> <span class="p">(</span><span class="nf">append</span> <span class="nv">tags</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">tag</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-remove</span> <span class="p">(</span><span class="nv">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove a TAG from filetags in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags</span> <span class="p">(</span><span class="nf">delete</span> <span class="nv">tag</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-set</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set a file property called NAME to VALUE in buffer file.
</span></span></span><span class="line"><span class="cl"><span class="s">If the property is already set, replace its value.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">name</span> <span class="p">(</span><span class="nf">downcase</span> <span class="nv">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;:\\(.*\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">replace-match</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;#+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: &#34;</span> <span class="nv">value</span><span class="p">)</span> <span class="ss">&#39;fixedcase</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;^[#:]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">save-excursion</span> <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">forward-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;#+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: &#34;</span> <span class="nv">value</span> <span class="s">&#34;\n&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-set-list</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">values</span> <span class="kp">&amp;optional</span> <span class="nv">separators</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set a file property called NAME to VALUES in current buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">VALUES are quoted and combined into single string using
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="ss">`combine-and-quote-strings&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">If SEPARATORS is non-nil, it should be a regular expression
</span></span></span><span class="line"><span class="cl"><span class="s">matching text that separates, but is not part of, the substrings.
</span></span></span><span class="line"><span class="cl"><span class="s">If nil it defaults to </span><span class="ss">`split-string-default-separators&#39;</span><span class="s">, normally
</span></span></span><span class="line"><span class="cl"><span class="s">\&#34;[ \f\t\n\r\v]+\&#34;, and OMIT-NULLS is forced to t.
</span></span></span><span class="line"><span class="cl"><span class="s">If the property is already set, replace its value.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">vulpea-buffer-prop-set</span>
</span></span><span class="line"><span class="cl">   <span class="nv">name</span> <span class="p">(</span><span class="nv">combine-and-quote-strings</span> <span class="nv">values</span> <span class="nv">separators</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-get</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get a buffer property called NAME as a string.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: \\(.*\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">match-end</span> <span class="mi">1</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-get-list</span> <span class="p">(</span><span class="nv">name</span> <span class="kp">&amp;optional</span> <span class="nv">separators</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get a buffer property NAME as a list using SEPARATORS.
</span></span></span><span class="line"><span class="cl"><span class="s">If SEPARATORS is non-nil, it should be a regular expression
</span></span></span><span class="line"><span class="cl"><span class="s">matching text that separates, but is not part of, the substrings.
</span></span></span><span class="line"><span class="cl"><span class="s">If nil it defaults to </span><span class="ss">`split-string-default-separators&#39;</span><span class="s">, normally
</span></span></span><span class="line"><span class="cl"><span class="s">\&#34;[ \f\t\n\r\v]+\&#34;, and OMIT-NULLS is forced to t.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">value</span> <span class="p">(</span><span class="nv">vulpea-buffer-prop-get</span> <span class="nv">name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">value</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string-empty-p</span> <span class="nv">value</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">split-string-and-unquote</span> <span class="nv">value</span> <span class="nv">separators</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-remove</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove a buffer property called NAME.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\(^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;:.*\n?\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">replace-match</span> <span class="s">&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ======================  Archiving  ==========================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq org-archive-mark-done nil)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq org-archive-location &#34;%s_archive::* Archive&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; https://gist.github.com/kepi/2f4acc3cc93403c75fbba5684c5d852d</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; org-archive-subtree-hierarchical.el</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; version 0.2</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; modified from https://lists.gnu.org/archive/html/emacs-orgmode/2014-08/msg00109.html</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; modified from https://stackoverflow.com/a/35475878/259187</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; In orgmode</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; * A</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** AAA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AB</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** ABA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Archiving AA will remove the subtree from the original file and create</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; it like that in archive target:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; * AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AAA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; And this give you</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; * A</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** AAA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Install file to your include path and include in your init file with:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (require &#39;org-archive-subtree-hierarchical)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (setq org-archive-default-command &#39;org-archive-subtree-hierarchical)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-default-command</span> <span class="ss">&#39;org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-archive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Returns the content of the current line as a string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--org-child-list</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function returns all children of a heading as a list. &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; this only works with org-version &gt; 8.0, since in previous</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; org-mode versions the function (org-outline-level) returns</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; gargabe when the point is not on a heading.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nv">org-outline-level</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">outline-next-visible-heading</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-goto-first-child</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">child-list</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">org-goto-sibling</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">child-list</span> <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span><span class="p">)</span> <span class="nv">child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--org-struct-subtree</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function returns the tree structure in which a subtree
</span></span></span><span class="line"><span class="cl"><span class="s">belongs as a list.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">archive-tree</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">org-up-heading-safe</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">heading</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">archive-tree</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">archive-tree</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">heading</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">archive-tree</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">heading</span> <span class="nv">archive-tree</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">archive-tree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function archives a subtree hierarchical&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-tree</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--org-struct-subtree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">this-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">buffer-base-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;No file associated to buffer&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">location</span> <span class="nv">org-archive-location</span>
</span></span><span class="line"><span class="cl">            <span class="nv">afile</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-archive--compute-location</span>
</span></span><span class="line"><span class="cl">                                   <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">&#34;ARCHIVE&#34;</span> <span class="ss">&#39;inherit</span><span class="p">)</span> <span class="nv">location</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; heading (org-extract-archive-heading location)</span>
</span></span><span class="line"><span class="cl">            <span class="nv">infile-p</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">file</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">afile</span> <span class="s">&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="nv">afile</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Invalid </span><span class="ss">`org-archive-location&#39;</span><span class="s">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">afile</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">newfile-p</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">afile</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nv">visiting</span> <span class="p">(</span><span class="nv">find-buffer-visiting</span> <span class="nv">afile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nv">buffer</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">visiting</span> <span class="p">(</span><span class="nv">find-file-noselect</span> <span class="nv">afile</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="nv">buffer</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Cannot access file \&#34;%s\&#34;&#34;</span> <span class="nv">afile</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-cut-subtree</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">set-buffer</span> <span class="nv">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-tree</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">child-list</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--org-child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-tree</span><span class="p">)</span> <span class="nv">child-list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">search-forward</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-tree</span><span class="p">)</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-tree</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">org-tree</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">org-insert-struct</span> <span class="nv">org-tree</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-tree</span> <span class="no">nil</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-yank</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">this-buffer</span> <span class="nv">buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">save-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Subtree archived %s&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;in file: &#34;</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="nv">afile</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-insert-struct</span> <span class="p">(</span><span class="nv">struct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;TODO&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="nv">struct</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">struct</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-insert-struct</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">struct</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ==============  Hierachy for title nodes  ===================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; =============================================================</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Codes blow are used to general a hierachy for title nodes that under a file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-doom-filetitle</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return the value of \&#34;#+title:\&#34; (if any) from file that NODE resides in.
</span></span></span><span class="line"><span class="cl"><span class="s">If there&#39;s no file-level title in the file, return empty string.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nv">org-roam-node-level</span> <span class="nv">node</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-roam-node-title</span> <span class="nv">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-get-keyword</span> <span class="s">&#34;TITLE&#34;</span> <span class="p">(</span><span class="nv">org-roam-node-file</span> <span class="nv">node</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-doom-hierarchy</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return hierarchy for NODE, constructed of its file title, OLP and direct title.
</span></span></span><span class="line"><span class="cl"><span class="s">  If some elements are missing, they will be stripped out.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">title</span>     <span class="p">(</span><span class="nv">org-roam-node-title</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">olp</span>       <span class="p">(</span><span class="nv">org-roam-node-olp</span>   <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">level</span>     <span class="p">(</span><span class="nv">org-roam-node-level</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">filetitle</span> <span class="p">(</span><span class="nv">org-roam-node-doom-filetitle</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">separator</span> <span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34; &gt; &#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;shadow</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cl-case</span> <span class="nv">level</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a top-level file</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="mi">0</span> <span class="nv">filetitle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a level 1 heading</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">filetitle</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="nv">title</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a heading with an arbitrary outline path</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">filetitle</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="p">(</span><span class="nf">propertize</span> <span class="p">(</span><span class="nv">string-join</span> <span class="nv">olp</span> <span class="s">&#34; &gt; &#34;</span><span class="p">)</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="nv">title</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-node-display-template</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;${type:15} ${doom-hierarchy:80} &#34;</span> <span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;${tags:*}&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;org-tag</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-org-enhance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-org-enhance.el ends here</span>
</span></span></code></pre></div><h2 id="export">Export<a hidden class="anchor" aria-hidden="true" href="#export">¶</a></h2>
<p>对于只需要导出某个 header 下的内容的需求，只需要在 header 上加上 <code>:export:</code> 即可。</p>
<h3 id="markdown-file">Markdown file<a hidden class="anchor" aria-hidden="true" href="#markdown-file">¶</a></h3>
<p>这里用的是 <a href="https://github.com/kawabata/ox-pandoc">ox-pandoc</a>， ~M-x org-pandoc-export-as-gfm~算是我找到最符合 MarkDown 语法的转换了，Emacs 自己的转换会将 Table 转换成 HTML 标签的格式。</p>
<h3 id="hugo">Hugo<a hidden class="anchor" aria-hidden="true" href="#hugo">¶</a></h3>
<p>在文件头部添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#+HUGO_BASE_DIR: ~/Dropbox/hugo/
</span></span><span class="line"><span class="cl">#+HUGO_SECTION: posts/main
</span></span><span class="line"><span class="cl">#+HUGO_WEIGHT: auto
</span></span><span class="line"><span class="cl">#+HUGO_AUTO_SET_LASTMOD: t
</span></span></code></pre></div><p>需要导出为 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时<sup id="fnref1:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><p>需要导出为块级 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时，也就是前后的空格不进行 trim。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+header</span><span class="c">: :trim-pre nil :trim-post nil</span>
</span></span><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><h3 id="latex">Latex<a hidden class="anchor" aria-hidden="true" href="#latex">¶</a></h3>
<h4 id="dependency">Dependency<a hidden class="anchor" aria-hidden="true" href="#dependency">¶</a></h4>
<p>需要安装 texlive</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install texlive
</span></span></code></pre></div><h4 id="latex-语法">Latex 语法<a hidden class="anchor" aria-hidden="true" href="#latex-语法">¶</a></h4>
<p><a href="/posts/main/20220616162256-latex/">Latex 语法</a></p>
<h4 id="pdf-导出报错">PDF 导出报错<a hidden class="anchor" aria-hidden="true" href="#pdf-导出报错">¶</a></h4>
<ul>
<li><code>Unicode character 考 (U+8003) not set up for use with LaTeX.</code> 是因为 Latex 本身不支持中文。</li>
</ul>
<h4 id="中文-pdf-导出设置">中文 PDF 导出设置<a hidden class="anchor" aria-hidden="true" href="#中文-pdf-导出设置">¶</a></h4>
<ol>
<li>使用 <a href="https://github.com/ElegantLaTeX/ElegantPaper">ElegantPaper</a>，需要将 elegantpaper.cls 文件放在 org 目录下。</li>
<li>安装依赖</li>
</ol>
<p>代码块需要用到 <code>minted</code>​，需要用到 <code>pygments</code> 作为依赖。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew install pygments
</span></span></code></pre></div><ol>
<li>导出文件头部增加</li>
</ol>
<!--listend-->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+LATEX_COMPILER</span><span class="c">: xelatex</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+LATEX_CLASS</span><span class="c">: elegantpaper</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+OPTIONS</span><span class="c">: prop:t</span>
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://orgmode.org/manual/Tracking-your-habits.html">Tracking your habits</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://gist.github.com/kepi/2f4acc3cc93403c75fbba5684c5d852d">Hierarchical archiving for Org-mode</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://ox-hugo.scripter.co/doc/org-special-blocks/">Org Special Blocks</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


    


   

   

   

   

   

   

   
	  
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

<hr>

  <div class="bl-section">
	<h4 style="color: var(--secondary);">Links to this note</h4>
	<div class="backlinks">
	  <ul>
	   
		  <li><a href="/posts/main/20220508195206-personal_knowledge_wiki/">Personal Knowledge Wiki</a></li>
	   
	 </ul>
	</div>
  </div>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="next" href="https://sheerwill.live/posts/main/20220503160055-git-skills/">
    <span class="title">Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg>
    </span>
    <br>
    <span>Git Skills</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2022 <a href="https://sheerwill.live/">Lucius | Braindump</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
</body>

</html>
