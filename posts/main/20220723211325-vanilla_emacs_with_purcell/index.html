<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Vanilla Emacs with Purcell | Lucius | Braindump</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融">
<meta name="author" content="Lucius Chen">
<link rel="canonical" href="https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.313144f1e57fe0987f52290b73829ffa589b3a9f2fda7bb48ff681c8bc23cb4f.css" integrity="sha256-MTFE8eV/4Jh/UikLc4Kf&#43;libOp8v2nu0j/aByLwjy08=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://sheerwill.live/favicon.ico">
<link rel="apple-touch-icon" href="https://sheerwill.live/apple-touch-icon.png">
<script async defer data-website-id="f4e3ad0a-7fc1-4f18-b08c-9be77b60cdd5" src="https://oishii.reorx.com/oishii.js"></script>

<meta name="twitter:title" content="Vanilla Emacs with Purcell | Lucius | Braindump" />
<meta name="twitter:description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融" />
<meta name="twitter:site" content="@novoreorx" />
<meta name="twitter:creator" content="@novoreorx" />
<meta property="og:title" content="Vanilla Emacs with Purcell | Lucius | Braindump" />
<meta property="og:description" content="Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/" />
<meta property="article:section" content="posts" />
  
  <meta property="article:modified_time" content="2022-09-05T00:39:31&#43;08:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://sheerwill.live/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Vanilla Emacs with Purcell",
      "item": "https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Vanilla Emacs with Purcell | Lucius | Braindump",
  "name": "Vanilla Emacs with Purcell",
  "description": "Introduction Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish. – Neal Stephenson, In the Beginning was the Command Line (1998) Install Emacs-plus With Homebrew brew tap d12frosted/emacs-plus brew install emacs-plus --with-native-comp --with-modern-vscode-icon ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications Workflow Figure 1: workflow 如上图所示，融",
  "keywords": [
    
  ],
  "wordCount" : "7950",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "2022-09-05T00:39:31+08:00",
  "author":[{
    "@type": "Person",
    "name": "Lucius Chen"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sheerwill.live/posts/main/20220723211325-vanilla_emacs_with_purcell/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lucius | Braindump",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sheerwill.live/favicon.ico"
    }
  }
}
</script><style>
  #icons {
    display: flex;
    flex-wrap: wrap;
    margin-top: 2em;
  }
  #icons .item {
    width: 80px;
    height: 50px;
    margin: 10px;
  }
  #icons .item .name {
    font-size: 12px;
    user-select: all;
    text-align: center;
  }
  #icons .item .icon {
    display: flex;
    justify-content: center;
  }
  #icons .item svg {
    width: 30px;
    height: 30px;
  }
</style>


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class="" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://sheerwill.live/" accesskey="h" title="Lucius | Braindump (Alt + H)">Lucius | Braindump</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        
        <ul id="menu">
            <li>
                <a href="https://sheerwill.live/tags/" title="Tags"
                >Tags
                </a>
            </li>
            <li>
                <a href="https://sheerwill.live/archives/" title="Archive"
                >Archive
                </a>
            </li>
            <li>
                <a href="https://sheerwill.live/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >Search
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">
<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Vanilla Emacs with Purcell
    </h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>September 5, 2022</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path><polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline><line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line><line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line><polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline></svg>
  <span>7950 words</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>16 min</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#install-emacs-plus-with-homebrew" aria-label="Install Emacs-plus With Homebrew">Install Emacs-plus With Homebrew</a></li>
                <li>
                    <a href="#workflow" aria-label="Workflow">Workflow</a><ul>
                        
                <li>
                    <a href="#gtd" aria-label="GTD">GTD</a><ul>
                        
                <li>
                    <a href="#capture" aria-label="Capture">Capture</a></li>
                <li>
                    <a href="#clarify" aria-label="Clarify">Clarify</a></li>
                <li>
                    <a href="#organize" aria-label="Organize">Organize</a></li>
                <li>
                    <a href="#reflect" aria-label="Reflect">Reflect</a></li>
                <li>
                    <a href="#engage" aria-label="Engage">Engage</a></li></ul>
                </li>
                <li>
                    <a href="#note-taking" aria-label="Note taking">Note taking</a><ul>
                        
                <li>
                    <a href="#book" aria-label="Book">Book</a></li>
                <li>
                    <a href="#daily-log" aria-label="Daily log">Daily log</a></li>
                <li>
                    <a href="#articles-work" aria-label="Articles/Work">Articles/Work</a></li>
                <li>
                    <a href="#export" aria-label="Export">Export</a></li>
                <li>
                    <a href="#org-roam-ui" aria-label="org-roam-ui">org-roam-ui</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#personal-settings" aria-label="Personal Settings">Personal Settings</a><ul>
                        
                <li>
                    <a href="#init-epla-dot-el" aria-label="init-epla.el">init-epla.el</a></li>
                <li>
                    <a href="#init-local-dot-el" aria-label="init-local.el">init-local.el</a><ul>
                        
                <li>
                    <a href="#consult" aria-label="consult">consult</a></li>
                <li>
                    <a href="#deft" aria-label="deft">deft</a></li>
                <li>
                    <a href="#vterm" aria-label="vterm">vterm</a></li>
                <li>
                    <a href="#ox-hugo" aria-label="ox-hugo">ox-hugo</a></li>
                <li>
                    <a href="#latex--auctex-plus-cdlatex" aria-label="Latex(auctex &#43; cdlatex)">Latex(auctex + cdlatex)</a></li>
                <li>
                    <a href="#bibtex--ebib-plus-citar" aria-label="Bibtex(ebib &#43; citar)">Bibtex(ebib + citar)</a></li>
                <li>
                    <a href="#org-roam-ui" aria-label="Org-roam-ui">Org-roam-ui</a></li>
                <li>
                    <a href="#org-modern" aria-label="org-modern">org-modern</a></li>
                <li>
                    <a href="#sis" aria-label="sis">sis</a></li>
                <li>
                    <a href="#elfeed" aria-label="elfeed">elfeed</a></li>
                <li>
                    <a href="#telega" aria-label="telega">telega</a></li></ul>
                </li>
                <li>
                    <a href="#init-org-dot-el" aria-label="init-org.el">init-org.el</a><ul>
                        
                <li>
                    <a href="#org-babel" aria-label="Org-babel">Org-babel</a></li>
                <li>
                    <a href="#plantuml" aria-label="PlantUML">PlantUML</a></li></ul>
                </li>
                <li>
                    <a href="#init-font-dot-el" aria-label="init-font.el">init-font.el</a></li>
                <li>
                    <a href="#init-corfu-dot-el" aria-label="init-corfu.el">init-corfu.el</a></li></ul>
                </li>
                <li>
                    <a href="#export" aria-label="Export">Export</a><ul>
                        
                <li>
                    <a href="#markdown-file" aria-label="Markdown file">Markdown file</a></li>
                <li>
                    <a href="#hugo" aria-label="Hugo">Hugo</a></li>
                <li>
                    <a href="#latex" aria-label="Latex">Latex</a><ul>
                        
                <li>
                    <a href="#dependency" aria-label="Dependency">Dependency</a></li>
                <li>
                    <a href="#latex-%e8%af%ad%e6%b3%95" aria-label="Latex 语法">Latex 语法</a></li>
                <li>
                    <a href="#pdf-%e5%af%bc%e5%87%ba%e6%8a%a5%e9%94%99" aria-label="PDF 导出报错">PDF 导出报错</a></li>
                <li>
                    <a href="#%e4%b8%ad%e6%96%87-pdf-%e5%af%bc%e5%87%ba%e8%ae%be%e7%bd%ae" aria-label="中文 PDF 导出设置">中文 PDF 导出设置</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">¶</a></h2>
<blockquote>
<p>Emacs outshines all other editing software in approximately the same way that the noonday sun does the stars. It is not just bigger and brighter; it simply makes everything else vanish.</p>
<p>– Neal Stephenson, In the Beginning was the Command Line (1998)</p>
</blockquote>
<h2 id="install-emacs-plus-with-homebrew">Install Emacs-plus With Homebrew<a hidden class="anchor" aria-hidden="true" href="#install-emacs-plus-with-homebrew">¶</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew tap d12frosted/emacs-plus
</span></span><span class="line"><span class="cl">brew install emacs-plus --with-native-comp --with-modern-vscode-icon
</span></span><span class="line"><span class="cl">ln -s /usr/local/opt/emacs-plus@29/Emacs.app /Applications
</span></span></code></pre></div><h2 id="workflow">Workflow<a hidden class="anchor" aria-hidden="true" href="#workflow">¶</a></h2>
<figure>
    <img loading="lazy" src="/ox-hugo/workflow.png"
         alt="Figure 1: workflow"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>workflow</p>
        </figcaption>
</figure>

<p>如上图所示，融合了笔记和 GTD 管理。</p>
<h3 id="gtd">GTD<a hidden class="anchor" aria-hidden="true" href="#gtd">¶</a></h3>
<h4 id="capture">Capture<a hidden class="anchor" aria-hidden="true" href="#capture">¶</a></h4>
<p>To-Dos 分为的来源分为六种：</p>
<ul>
<li>Habit Track: 即对于重复事件的循环，有利于习惯的养成。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></li>
<li>Cyclic Tasks: 需要循环的任务。
<ul>
<li>生日提醒</li>
<li>周报</li>
<li>每日回顾</li>
<li>稍后读</li>
<li>etc.</li>
</ul>
</li>
<li>Inbox: 用来收集各种 To-Dos，设置的快捷键为 <code>C-c c</code>​。每日回顾的时候分发到各自的分类，并行进行 Scheduled。
<ul>
<li>personal: 个人事宜</li>
<li>someday: 存放一些不知道什么时候会做的 To-Dos，有时间回顾的时候再次分类。</li>
<li>technical: 存放个人需要偿还的技术债</li>
<li>work: 工作相关</li>
</ul>
</li>
<li>books: 阅读的书籍，通过 ebib 的 <code>ebib-add-reading-list-item</code> 添加。</li>
<li>Dynamic: 只要是 org 文件中的有 To-Dos，就会在保存文件时，自动给文件添加 <code>:dynamic:</code> 标签，纳入到 Agenda 文件中。</li>
<li>note: 对一些地方的备注或者 To-Dos，后者和 Dynamic To-Dos 场景重复。</li>
</ul>
<h4 id="clarify">Clarify<a hidden class="anchor" aria-hidden="true" href="#clarify">¶</a></h4>
<p>对 Inbox 当中的 To-Dos 进行分发，并用关键字标记 To-Dos 的属性，比如 <code>PROJECT</code>, <code>DELEGRTED</code> 等。对于 <code>PROJECT</code> 这类还要继续分解。</p>
<h4 id="organize">Organize<a hidden class="anchor" aria-hidden="true" href="#organize">¶</a></h4>
<p>对明天需要做的或知道明确日期的 To-Dos 进行 Scheduled，对于 <code>DONE</code> 或 <code>CANCELLED</code> 的 To-Dos 会自动复制到今日的 Daily log 当中，这样呈现的结果，其实和 Logseq 中在 Journals 里面管理 To-Dos 是一致的。</p>
<p>不过实现的过程，或者说内在逻辑是不一样的。在 Logseq 的 Journals 中管理 To-Dos 即便是通过查询汇聚展示 To-Dos 也没有 agenda 中这么灵活，另外前几天定下的需要后面完成的 To-Dos 有两种管理方式：1. 将 To-Dos 链接到需要做的某天，自动展示。这样的操作确实方便，但使得各种关联杂乱。2. 将 To-Dos 移动到对应需要做的某天。</p>
<p>上面说的呈现结果一致，就是指的第二种，回顾起来也非常清晰。在 org-roam 配合 agenda 使用中，To-Dos 有了单独的收集仓库，整理分发。也可以通过自定义的函数在 agenda 和 org-roam 之间联动，比如对于 <code>DONE</code> 或 <code>CANCELLED</code> 的 To-Dos 会自动复制到今日的 Daily log 当中，比如 org-roam 中的 To-Dos 也会呈现在 agenda view 中，完成后也会自动复制到 Daily log 中。</p>
<p>整体上来讲，内在逻辑 agenda 和 org-roam 配合起来更加清晰，灵活。</p>
<h4 id="reflect">Reflect<a hidden class="anchor" aria-hidden="true" href="#reflect">¶</a></h4>
<p>回顾所有的 To-Dos，选取明天或者近期需要完成。对已完成或取消的 To-Dos 归档，是按照结构<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>归档到同级别 <code>*.org</code> 文件的 <code>archive</code> 文件夹下的同名文件中。</p>
<p>同时，要回顾一下 Notes 当中的对某处的笔记或设定的 To-Dos。</p>
<h4 id="engage">Engage<a hidden class="anchor" aria-hidden="true" href="#engage">¶</a></h4>
<p>按照重要，简单等因素顺序执行需要做的 To-Dos</p>
<h3 id="note-taking">Note taking<a hidden class="anchor" aria-hidden="true" href="#note-taking">¶</a></h3>
<p>输入源分为工作、书籍和文章（来自于 RSS、Newsletter、Twitter 等平台）。</p>
<h4 id="book">Book<a hidden class="anchor" aria-hidden="true" href="#book">¶</a></h4>
<p>PDF 以及 Epub 格式的书籍或者论文通过 Ebib 管理 Bibtex，Ebib 的 <code>ebib-reading-list-file</code> 设置为 Agenda 中的 <code>books.org</code>​，这样就可以很方便在 Agenda View 中看到自己当前在阅读的书籍/论文，并查看进度。</p>
<p>书籍/论文对应的笔记则是在 <code>references</code> 文件夹下，可以方便笔记中进行引用。</p>
<h4 id="daily-log">Daily log<a hidden class="anchor" aria-hidden="true" href="#daily-log">¶</a></h4>
<p>每个 Daily log 文件头部都有 <code>#+ARCHIVE: journal.org::</code> 来控制归档的位置，每天回顾完当天的 log 就归档到 <code>journal.org</code> 文件中，如果后续这个文件太大，还可以按照年份来继续归档。</p>
<p>而且在 <code>journal.org</code> 中通过 <code>C-c \</code> 可以查看所有的 tags，选择对应的 tag 就可以过滤出想要的内容，其他内容全部收缩。</p>
<h4 id="articles-work">Articles/Work<a hidden class="anchor" aria-hidden="true" href="#articles-work">¶</a></h4>
<p>文章的阅读笔记是放在 Daily log 当中的，在 What I read? 的标题下，打上对应的 tags。后期回顾的时候，或者积累一定数量的同类型、同话题文章，可能会 refile 到 org-roam 内进行总结，形成知识点。</p>
<p>工作中的事情都是记在 Daily log 中，每条 log 有明确的时间。</p>
<p>对于问题的解决，有详细的原因和解决方案，后续遇到同样的问题可以参考之前的思路；对于与他人沟通的内容，有详细的操作记录、数据记录以及邮件聊天等记录链接或截图，有背锅风险时可以轻松应对。</p>
<p>同样的，工作中某个类型的知识点的笔记积累多了，会在 org-roam 中进行总结，形成知识点。</p>
<h4 id="export">Export<a hidden class="anchor" aria-hidden="true" href="#export">¶</a></h4>
<p>输出是 org 的强项，Hugo 方便与人在线分享，PDF/Markdown 离线分享。</p>
<h4 id="org-roam-ui">org-roam-ui<a hidden class="anchor" aria-hidden="true" href="#org-roam-ui">¶</a></h4>
<p>方便的查看笔记之间的关系，进行系统性回顾。</p>
<h2 id="personal-settings">Personal Settings<a hidden class="anchor" aria-hidden="true" href="#personal-settings">¶</a></h2>
<p>目前在 <a href="https://github.com/purcell/emacs.d">purcell</a> 中就增加或修改了这些文件。</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">.
├── lisp
    ├── init-elpa.el
    ├── init-local.el
    ├── init-org.el
    ├── init-font.el
    ├── init-corfu.el
</code></pre><h3 id="init-epla-dot-el">init-epla.el<a hidden class="anchor" aria-hidden="true" href="#init-epla-dot-el">¶</a></h3>
<p>增加 <code>use-package</code> 和 <code>straight</code> 的支持</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;; Bootstrap `use-package&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">&#39;use-package</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">eval-and-compile</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-ensure</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-defer</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-demand</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-expand-minimally</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-enable-imenu-support</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">eval-when-compile</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;use-package</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Install straight.el</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">bootstrap-version</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">bootstrap-file</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;straight/repos/straight.el/bootstrap.el&#34;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">bootstrap-version</span> <span class="mi">5</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">bootstrap-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-current-buffer</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">url-retrieve-synchronously</span>
</span></span><span class="line"><span class="cl">         <span class="s">&#34;https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="ss">&#39;silent</span> <span class="ss">&#39;inhibit-cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">eval-print-last-sexp</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">load</span> <span class="nv">bootstrap-file</span> <span class="no">nil</span> <span class="ss">&#39;nomessage</span><span class="p">))</span>
</span></span></code></pre></div><h3 id="init-local-dot-el">init-local.el<a hidden class="anchor" aria-hidden="true" href="#init-local-dot-el">¶</a></h3>
<p>在 <code>init.el</code> 中有如下代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;; Allow users to provide an optional &#34;init-local&#34; containing personal settings</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;init-local</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span></code></pre></div><p>默认没有 <code>init-local.org</code> 这个文件，创建一个，就可以往里面塞自己的配置了。</p>
<h4 id="consult">consult<a hidden class="anchor" aria-hidden="true" href="#consult">¶</a></h4>
<p>Purcell 中已经包含了这个 package，也有 <code>consult-ripgrep</code> 这个方法。需要安装 <code>ripgrep</code>​。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install ripgrep
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">bms/org-roam-rg-search</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Search org-roam directory using consult-ripgrep. With live-preview.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">consult-ripgrep-command</span> <span class="s">&#34;rg --null --ignore-case --type org --line-buffered --color=always --max-columns=500 --no-heading --line-number . -e ARG OPTS&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">consult-ripgrep</span> <span class="nv">org-roam-directory</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c rr&#34;</span><span class="p">)</span> <span class="ss">&#39;bms/org-roam-rg-search</span><span class="p">)</span>
</span></span></code></pre></div><p>搜索 <code>org-roam-directory</code> 下的内容。</p>
<h4 id="deft">deft<a hidden class="anchor" aria-hidden="true" href="#deft">¶</a></h4>
<p>用作一些不想放在 <code>org-roam</code> 中的一些笔记的操作。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;deft</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-extensions</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;md&#34;</span> <span class="s">&#34;tex&#34;</span> <span class="s">&#34;org&#34;</span> <span class="s">&#34;mw&#34;</span> <span class="s">&#34;conf&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-directory</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-recursive</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;deft-parse-title</span> <span class="nb">:override</span> <span class="nf">#&#39;</span><span class="nv">cm/deft-parse-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">deft-strip-summary-regexp</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\(&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;[\n\t]&#34;</span> <span class="c1">;; blank</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^#\\+[[:alpha:]_]+:.*$&#34;</span> <span class="c1">;; org-mode metadata</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^#\s[-]*$&#34;</span> <span class="c1">;; org-mode metadata</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\|^:PROPERTIES:\n\\(.+\n\\)+:END:\n&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;\\)&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">f7</span><span class="p">]</span> <span class="ss">&#39;deft</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-x C-g&#34;</span><span class="p">)</span> <span class="ss">&#39;deft-find-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; deft parse title</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">cm/deft-parse-title</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">contents</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Parse the given FILE and CONTENTS and determine the title.
</span></span></span><span class="line"><span class="cl"><span class="s">If </span><span class="ss">`deft-use-filename-as-title&#39;</span><span class="s"> is nil, the title is taken to
</span></span></span><span class="line"><span class="cl"><span class="s">be the first non-empty line of the FILE.  Else the base name of the FILE is
</span></span></span><span class="line"><span class="cl"><span class="s">used as title.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">begin</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;^#\\+[tT][iI][tT][lL][eE]: .*$&#34;</span> <span class="nv">contents</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="nv">begin</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">string-trim</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">contents</span> <span class="nv">begin</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">))</span> <span class="s">&#34;#\\+[tT][iI][tT][lL][eE]: *&#34;</span> <span class="s">&#34;[\n\t ]+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">deft-base-filename</span> <span class="nv">file</span><span class="p">))))</span>
</span></span></code></pre></div><h4 id="vterm">vterm<a hidden class="anchor" aria-hidden="true" href="#vterm">¶</a></h4>
<p>在 Emacs 中使用终端，首先要在 <code>/.zshrc</code> 中添加如下代码。（编译时需要 CMake）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="s2">&#34;</span><span class="nv">$INSIDE_EMACS</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s1">&#39;vterm&#39;</span> <span class="o">]]</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="o">[[</span> -n <span class="si">${</span><span class="nv">EMACS_VTERM_PATH</span><span class="si">}</span> <span class="o">]]</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="o">[[</span> -f <span class="si">${</span><span class="nv">EMACS_VTERM_PATH</span><span class="si">}</span>/etc/emacs-vterm-zsh.sh <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="nb">source</span> <span class="si">${</span><span class="nv">EMACS_VTERM_PATH</span><span class="si">}</span>/etc/emacs-vterm-zsh.sh
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></div><p>这里为了方便使用需要引入 vterm-toggle</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;vterm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;vterm-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">vterm-toggle</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:when</span> <span class="p">(</span><span class="nf">memq</span> <span class="nf">window-system</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">mac</span> <span class="nv">ns</span> <span class="nv">x</span> <span class="nv">pgtk</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">(([</span><span class="nv">f8</span><span class="p">]</span> <span class="o">.</span> <span class="nv">vterm-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">([</span><span class="nv">f9</span><span class="p">]</span> <span class="o">.</span> <span class="nv">vterm-compile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nb">:map</span> <span class="nv">vterm-mode-map</span>
</span></span><span class="line"><span class="cl">         <span class="p">([</span><span class="nv">f8</span><span class="p">]</span> <span class="o">.</span> <span class="nv">vterm-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">([(</span><span class="nv">control</span> <span class="nb">return</span><span class="p">)]</span> <span class="o">.</span> <span class="nv">vterm-toggle-insert-cd</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">vterm-toggle-cd-auto-create-buffer</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">vterm-compile-buffer</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">vterm-compile</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Compile the program including the current buffer in </span><span class="ss">`vterm&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">compile-command</span> <span class="p">(</span><span class="nv">compilation-read-command</span> <span class="nv">compile-command</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">vterm-toggle-use-dedicated-buffer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">vterm-toggle--vterm-dedicated-buffer</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">vterm-toggle--get-window</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                    <span class="p">(</span><span class="nv">vterm-toggle-hide</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="nv">vterm-compile-buffer</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="p">(</span><span class="nv">vterm-toggle-cd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">vterm-compile-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">rename-buffer</span> <span class="s">&#34;*vterm compilation*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">compilation-shell-minor-mode</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">vterm-send-M-w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">vterm-send-string</span> <span class="nv">compile-command</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">vterm-send-return</span><span class="p">)))))</span>
</span></span></code></pre></div><h4 id="ox-hugo">ox-hugo<a hidden class="anchor" aria-hidden="true" href="#ox-hugo">¶</a></h4>
<p>导出到 Hugo，方便与他人分享内容。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;ox-hugo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;ox</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ox-hugo</span><span class="p">))</span>
</span></span></code></pre></div><p>导出到 Hugo 还需要在文件头部添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+HUGO_BASE_DIR</span><span class="c">: ~/Dropbox/hugo/</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_SECTION</span><span class="c">: posts/main</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_WEIGHT</span><span class="c">: auto</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+HUGO_AUTO_SET_LASTMOD</span><span class="c">: t</span>
</span></span></code></pre></div><p>需要到处为 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+header</span><span class="c">: :trim-pre nil :trim-post nil</span>
</span></span><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><h4 id="latex--auctex-plus-cdlatex">Latex(auctex + cdlatex)<a hidden class="anchor" aria-hidden="true" href="#latex--auctex-plus-cdlatex">¶</a></h4>
<p>离线分享的时候最大程度的保持原貌的方法就是 PDF。</p>
<p>需要安装 <code>texlive</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install texlive
</span></span></code></pre></div><p>Latex 语法可以参考：<a href="/posts/main/20220616162256-latex/">Latex</a></p>
<p>导出含有中文时是需要配置 CJK，<a href="https://github.com/ElegantLaTeX/ElegantPaper/blob/master/elegantpaper.cls">ElegantPaper</a> 可以跨过这一步设置，只需要将 <code>elegantpaper.cls</code> 放到需要导出 PDF 的目录下，同时安装依赖。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install pygments
</span></span></code></pre></div><p>在导出文件头部增加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+LATEX_COMPILER</span><span class="c">: xelatex</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+LATEX_CLASS</span><span class="c">: elegantpaper</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+OPTIONS</span><span class="c">: prop:t</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;auctex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;cdlatex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;LaTeX-mode-hook</span> <span class="ss">&#39;turn-on-cdlatex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;ox-latex</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; http://orgmode.org/worg/org-faq.html#using-xelatex-for-pdf-export</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; latexmk runs pdflatex/xelatex (whatever is specified) multiple times</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; automatically to resolve the cross-references.</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-pdf-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;latexmk -xelatex -quiet -shell-escape -f %f&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
</span></span><span class="line"><span class="cl">               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;elegantpaper&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="s">&#34;\\documentclass[lang=cn]{elegantpaper}
</span></span></span><span class="line"><span class="cl"><span class="s">                 [NO-DEFAULT-PACKAGES]
</span></span></span><span class="line"><span class="cl"><span class="s">                 [PACKAGES]
</span></span></span><span class="line"><span class="cl"><span class="s">                 [EXTRA]&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubsection*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\paragraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\paragraph*{%s}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="s">&#34;\\subparagraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subparagraph*{%s}&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-listings</span> <span class="ss">&#39;minted</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-packages-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;&#34;</span> <span class="s">&#34;minted&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><h4 id="bibtex--ebib-plus-citar">Bibtex(ebib + citar)<a hidden class="anchor" aria-hidden="true" href="#bibtex--ebib-plus-citar">¶</a></h4>
<p>管理 Bibtex 可以方便在文章中引用，以及新增读书笔记，结合 agenda 更好的管理读书条目以及进度。（这部份配置需要精简，目前用的比较简单。）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">bibtex</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:defer</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">bibtex-file-path</span> <span class="s">&#34;~/Dropbox/org/bib/&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-files</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;bibtex.bib&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-notes-path</span> <span class="s">&#34;~/Dropbox/org/references/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-align-at-equal-sign</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-titleword-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-year-title-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-autokey-name-year-separator</span> <span class="s">&#34;-&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">bibtex-dialect</span> <span class="ss">&#39;biblatex</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;citar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">citar</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:straight</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">((</span><span class="nv">org-mode</span> <span class="nv">latex-mode</span><span class="p">)</span> <span class="o">.</span> <span class="nv">citar-setup-capf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-cite-insert-processor</span> <span class="ss">&#39;citar</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-cite-follow-processor</span> <span class="ss">&#39;citar</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-cite-activate-processor</span> <span class="ss">&#39;citar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c b&#34;</span> <span class="o">.</span> <span class="nv">citar-insert-citation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="nb">:map</span> <span class="nv">minibuffer-local-map</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="s">&#34;M-b&#34;</span> <span class="o">.</span> <span class="nv">citar-insert-preset</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">citar-at-point-function</span> <span class="ss">&#39;embark-act</span>
</span></span><span class="line"><span class="cl">        <span class="nv">citar-bibliography</span> <span class="p">(</span><span class="nf">mapcar</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">bibtex-file-path</span> <span class="nv">file</span><span class="p">))</span> <span class="nv">bibtex-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">citar-library-paths</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="nv">bibtex-file-path</span> <span class="s">&#34;files/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">citar-notes-paths</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">bibtex-notes-path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">citar-file-open-function</span> <span class="ss">&#39;citar-file-open-external</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">citar-setup-capf</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;add </span><span class="ss">`citar-capf&#39;</span><span class="s"> to </span><span class="ss">`completion-at-point-functions&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;completion-at-point-functions</span> <span class="nf">#&#39;</span><span class="nv">citar-capf</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ebib</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:straight</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:commands</span> <span class="nv">ebib-zotero-protocol-handler</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-protocol</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">push</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;ebib-zotero&#34;</span> <span class="nb">:protocol</span> <span class="s">&#34;ebib-zotero&#34;</span> <span class="nb">:function</span> <span class="nv">ebib-zotero-protocol-handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nv">org-protocol-protocol-alist</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ebib-default-directory</span> <span class="nv">bibtex-file-path</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-bib-search-dirs</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">bibtex-file-path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-file-search-dirs</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="nv">bibtex-file-path</span> <span class="s">&#34;files/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-directory</span> <span class="nv">bibtex-notes-path</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-reading-list-file</span> <span class="s">&#34;~/Dropbox/org/agenda/books.org&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-bibtex-dialect</span> <span class="nv">bibtex-dialect</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-file-associations</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;pdf&#34;</span> <span class="o">.</span> <span class="s">&#34;open&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-index-default-sort</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;timestamp&#34;</span> <span class="o">.</span> <span class="nv">descend</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-template</span> <span class="s">&#34;:PROPERTIES:
</span></span></span><span class="line"><span class="cl"><span class="s">:ID:       %i
</span></span></span><span class="line"><span class="cl"><span class="s">:ROAM_REFS: @%k
</span></span></span><span class="line"><span class="cl"><span class="s">:END:
</span></span></span><span class="line"><span class="cl"><span class="s">#+title: %t
</span></span></span><span class="line"><span class="cl"><span class="s">#+description: %d
</span></span></span><span class="line"><span class="cl"><span class="s">#+date: %s
</span></span></span><span class="line"><span class="cl"><span class="s">%%?&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-notes-template-specifiers</span> <span class="o">&#39;</span><span class="p">((</span><span class="sc">?k</span> <span class="o">.</span> <span class="nv">ebib-create-key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?i</span> <span class="o">.</span> <span class="nv">ebib-create-id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?t</span> <span class="o">.</span> <span class="nv">ebib-create-org-title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?d</span> <span class="o">.</span> <span class="nv">ebib-create-org-description</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?l</span> <span class="o">.</span> <span class="nv">ebib-create-org-link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                         <span class="p">(</span><span class="sc">?s</span> <span class="o">.</span> <span class="nv">ebib-create-org-time-stamp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-preload-bib-files</span> <span class="nv">bibtex-files</span>
</span></span><span class="line"><span class="cl">        <span class="nv">ebib-use-timestamp</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-key</span> <span class="p">(</span><span class="nv">key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return the KEY in DB for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s&#34;</span> <span class="nv">key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-id</span> <span class="p">(</span><span class="nv">_key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Create an ID for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-id-new</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-create-org-time-stamp</span> <span class="p">(</span><span class="nv">_key</span> <span class="nv">_db</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Create timestamp for the Org mode note.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s&#34;</span> <span class="p">(</span><span class="nb">with-temp-buffer</span> <span class="p">(</span><span class="nv">org-insert-time-stamp</span> <span class="no">nil</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; ebib-zotero</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defcustom</span> <span class="nv">ebib-zotero-translation-server</span> <span class="s">&#34;https://translate.manubot.org&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;The address of Zotero translation server.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:group</span> <span class="ss">&#39;ebib</span>
</span></span><span class="line"><span class="cl">    <span class="nb">:type</span> <span class="ss">&#39;string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-translate</span> <span class="p">(</span><span class="nv">item</span> <span class="nv">server-path</span> <span class="kp">&amp;optional</span> <span class="nv">export-format</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Convert item to EXPORT-FORMAT entry through </span><span class="ss">`ebib-zotero-translation-server&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">export-format</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">export-format</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">downcase</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">intern-soft</span> <span class="nv">bibtex-dialect</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">shell-command-to-string</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;curl -s -d &#39;%s&#39; -H &#39;Content-Type: text/plain&#39; &#39;%s/%s&#39; | curl -s -d @- -H &#39;Content-Type: application/json&#39; &#39;%s/export?format=%s&#39;&#34;</span> <span class="nv">item</span> <span class="nv">ebib-zotero-translation-server</span> <span class="nv">server-path</span> <span class="nv">ebib-zotero-translation-server</span> <span class="nv">export-format</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-import-url</span> <span class="p">(</span><span class="nv">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Fetch a entry from zotero translation server via a URL.
</span></span></span><span class="line"><span class="cl"><span class="s">The entry is stored in the current database.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;MURL: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">ebib-zotero-translate</span> <span class="nv">url</span> <span class="s">&#34;web&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">entry-keys</span> <span class="p">(</span><span class="nv">ebib-import-entries</span> <span class="nv">ebib--cur-db</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">ebib--goto-entry-in-index</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">entry-keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">ebib--update-entry-buffer</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-import-identifier</span> <span class="p">(</span><span class="nv">identifier</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Fetch a entry from zotero translation server via an IDENTIFIER.
</span></span></span><span class="line"><span class="cl"><span class="s">The entry is stored in the current database,
</span></span></span><span class="line"><span class="cl"><span class="s">and the identifier can be DOI, ISBN, PMID, or arXiv ID.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;MIDENTIFIER: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-temp-buffer</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">ebib-zotero-translate</span> <span class="nv">identifier</span> <span class="s">&#34;search&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">when-let</span> <span class="p">((</span><span class="nv">entry-keys</span> <span class="p">(</span><span class="nv">ebib-import-entries</span> <span class="nv">ebib--cur-db</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">ebib--goto-entry-in-index</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">entry-keys</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">ebib--update-entry-buffer</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">ebib-zotero-protocol-handler</span> <span class="p">(</span><span class="nv">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Process an org-protocol://ebib-zotero?href= style url with INFO.
</span></span></span><span class="line"><span class="cl"><span class="s">Calls </span><span class="ss">`ebib-zotero-import-url&#39;</span><span class="s"> with the provided URI to add a
</span></span></span><span class="line"><span class="cl"><span class="s">new BibTeX entry to the current database.
</span></span></span><span class="line"><span class="cl"><span class="s">Add the following as a browser bookmark to use:
</span></span></span><span class="line"><span class="cl"><span class="s">    javascript:location.href = \\=&#39;org-protocol://ebib-zotero?href=\\=&#39;+ \\
</span></span></span><span class="line"><span class="cl"><span class="s">            encodeURIComponent(location.href)&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:href</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">user-error</span> <span class="s">&#34;No URI provided&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">ebib</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">ebib-zotero-import-url</span> <span class="p">(</span><span class="nf">plist-get</span> <span class="nv">info</span> <span class="nb">:href</span><span class="p">))))</span>
</span></span></code></pre></div><h4 id="org-roam-ui">Org-roam-ui<a hidden class="anchor" aria-hidden="true" href="#org-roam-ui">¶</a></h4>
<p>可以方便的查看笔记之间的关系</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-roam-ui</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:straight</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">:host</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&#34;org-roam/org-roam-ui&#34;</span> <span class="nb">:branch</span> <span class="s">&#34;main&#34;</span> <span class="nb">:files</span> <span class="p">(</span><span class="s">&#34;*.el&#34;</span> <span class="s">&#34;out&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;         normally we&#39;d recommend hooking orui after org-roam, but since org-roam does not have</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;         a hookable mode anymore, you&#39;re advised to pick something yourself</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;         if you don&#39;t care about startup time, use</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;  :hook (after-init . org-roam-ui-mode)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-ui-sync-theme</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-roam-ui-follow</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-roam-ui-update-on-save</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-roam-ui-open-on-start</span> <span class="no">t</span><span class="p">))</span>
</span></span></code></pre></div><h4 id="org-modern">org-modern<a hidden class="anchor" aria-hidden="true" href="#org-modern">¶</a></h4>
<p>美化部分样式，另外设置背景透明以及光标所在代码块按照括号高亮的函数也在放在这里。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-modern</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-modern</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:after</span> <span class="nv">org</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">org-modern-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-modern-block</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-radio-target</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-internal-target</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-list</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-star nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-timestamp</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-checkbox nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-todo</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; org-modern-footnote nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-block-name</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-priority</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-progress</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-keyword</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-table</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-tag</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-statistics</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-modern-horizontal-rule</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-ellipsis</span> <span class="s">&#34;➘&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">custom-set-faces</span>
</span></span><span class="line"><span class="cl"> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-ellipsis</span> <span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="nb">:foreground</span> <span class="s">&#34;yellow green&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 设置背景透明度</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">user/change-background-opacity</span> <span class="p">(</span><span class="nv">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;nOpacity: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="nv">alpha</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">&lt;=</span> <span class="nv">alpha</span> <span class="mi">100</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">user/set-background-opacity</span> <span class="nv">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">format-message</span> <span class="s">&#34;Opacity has to be between 0 and 100 but is %d.&#34;</span> <span class="nv">alpha</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">user/set-background-opacity</span> <span class="p">(</span><span class="nv">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-frame-parameter</span> <span class="p">(</span><span class="nf">selected-frame</span><span class="p">)</span> <span class="ss">&#39;alpha</span> <span class="nv">alpha</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;default-frame-alist</span> <span class="p">(</span><span class="nf">cons</span> <span class="ss">&#39;alpha</span> <span class="nv">alpha</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">user/set-background-opacity</span> <span class="mi">90</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 高亮光标所在的括号内容，提高阅读效率。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">&#39;highlight-blocks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">package-install</span> <span class="ss">&#39;highlight-blocks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;highlight-blocks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">highlight-blocks--get-bounds</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get the bounds of the nested blocks the point is in.
</span></span></span><span class="line"><span class="cl"><span class="s">The returned value is a list of conses, where car is the start of a
</span></span></span><span class="line"><span class="cl"><span class="s">block and cdr is the end of a block, starting from the outermost
</span></span></span><span class="line"><span class="cl"><span class="s">block.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">result</span> <span class="o">&#39;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">parse-sexp-ignore-comments</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">condition-case</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">parse-state</span> <span class="p">(</span><span class="nv">syntax-ppss</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">starting-pos</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">3</span> <span class="nv">parse-state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                     <span class="p">(</span><span class="nf">nth</span> <span class="mi">4</span> <span class="nv">parse-state</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                 <span class="p">(</span><span class="nf">nth</span> <span class="mi">8</span> <span class="nv">parse-state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                               <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">begins</span> <span class="p">(</span><span class="nf">nreverse</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">9</span> <span class="nv">parse-state</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">end</span> <span class="nv">starting-pos</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">highlight-blocks-max-innermost-block-count</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">i</span> <span class="nv">highlight-blocks-max-innermost-block-count</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">end</span> <span class="p">(</span><span class="nf">scan-lists</span> <span class="nv">end</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">begins</span><span class="p">)</span> <span class="nv">end</span><span class="p">)</span> <span class="nv">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">i</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">scan-error</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 修改下这个函数函数的返回值，可以只高亮当前所在的块</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">last</span> <span class="nv">result</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Put the mode hooks where you want it, for example</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span>       <span class="ss">&#39;highlight-blocks--get-bounds</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (add-hook &#39;lisp-interaction-mode-hook &#39;highlight-blocks-mode)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (add-hook &#39;lisp-mode-hook             &#39;highlight-blocks-mode)</span>
</span></span></code></pre></div><h4 id="sis">sis<a hidden class="anchor" aria-hidden="true" href="#sis">¶</a></h4>
<p>需要安装 <code>macism</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew tap laishulu/macism
</span></span><span class="line"><span class="cl">brew install macism
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;sis</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">sis</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-english-source</span> <span class="s">&#34;com.apple.keylayout.ABC&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-ism-lazyman-config</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;com.apple.keylayout.ABC&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="s">&#34;im.rime.inputmethod.Squirrel.Rime&#34;</span> <span class="ss">&#39;macism</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /cursor color/ mode</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-cursor-color-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /respect/ mode</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-respect-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /context/ mode for all buffers</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">sis-global-context-mode</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; enable the /inline english/ mode for all buffers</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (sis-global-inline-mode t)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; not delete the head spaces</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-inline-tighten-head-rule</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-default-cursor-color</span> <span class="s">&#34;brown3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-other-cursor-color</span> <span class="s">&#34;orange&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">sis-prefix-override-keys</span> <span class="p">(</span><span class="nf">list</span> <span class="s">&#34;C-c&#34;</span> <span class="s">&#34;C-x&#34;</span> <span class="s">&#34;C-h&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-capture-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">sis-set-other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">sis-set-other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;rust-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">sis-set-english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; hydra 时切换到英文</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;hydra-org-agenda-menu/body</span> <span class="nb">:after</span> <span class="nf">#&#39;</span><span class="nv">sis-set-english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="elfeed">elfeed<a hidden class="anchor" aria-hidden="true" href="#elfeed">¶</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>require-package <span class="s1">&#39;elfeed)
</span></span></span><span class="line"><span class="cl"><span class="s1">(global-set-key (kbd &#34;C-x w&#34;) &#39;</span>elfeed<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>use-package elfeed-org
</span></span><span class="line"><span class="cl">  :ensure t
</span></span><span class="line"><span class="cl">  :config
</span></span><span class="line"><span class="cl">  <span class="o">(</span>elfeed-org<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>setq rmh-elfeed-org-files <span class="o">(</span>list <span class="s2">&#34;~/Dropbox/org/elfeed.org&#34;</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>defun concatenate-authors <span class="o">(</span>authors-list<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Given AUTHORS-LIST, list of plists; return string of all authors
</span></span></span><span class="line"><span class="cl"><span class="s2">concatenated.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>mapconcat
</span></span><span class="line"><span class="cl">   <span class="o">(</span>lambda <span class="o">(</span>author<span class="o">)</span> <span class="o">(</span>plist-get author :name<span class="o">))</span>
</span></span><span class="line"><span class="cl">   authors-list <span class="s2">&#34;, &#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>defun my-search-print-fn <span class="o">(</span>entry<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Print ENTRY to the buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>let* <span class="o">((</span>date <span class="o">(</span>elfeed-search-format-date <span class="o">(</span>elfeed-entry-date entry<span class="o">)))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>title <span class="o">(</span>or <span class="o">(</span>elfeed-meta entry :title<span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span>elfeed-entry-title entry<span class="o">)</span> <span class="s2">&#34;&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>title-faces <span class="o">(</span>elfeed-search--faces <span class="o">(</span>elfeed-entry-tags entry<span class="o">)))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>feed <span class="o">(</span>elfeed-entry-feed entry<span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>feed-title
</span></span><span class="line"><span class="cl">          <span class="o">(</span>when feed
</span></span><span class="line"><span class="cl">            <span class="o">(</span>or <span class="o">(</span>elfeed-meta feed :title<span class="o">)</span> <span class="o">(</span>elfeed-feed-title feed<span class="o">))))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>entry-authors <span class="o">(</span>concatenate-authors
</span></span><span class="line"><span class="cl">                         <span class="o">(</span>elfeed-meta entry :authors<span class="o">)))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>tags <span class="o">(</span>mapcar <span class="c1">#&#39;symbol-name (elfeed-entry-tags entry)))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>tags-str <span class="o">(</span>mapconcat
</span></span><span class="line"><span class="cl">                    <span class="o">(</span>lambda <span class="o">(</span>s<span class="o">)</span> <span class="o">(</span>propertize s <span class="s1">&#39;face
</span></span></span><span class="line"><span class="cl"><span class="s1">                                            &#39;</span>elfeed-search-tag-face<span class="o">))</span>
</span></span><span class="line"><span class="cl">                    tags <span class="s2">&#34;,&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>title-width <span class="o">(</span>- <span class="o">(</span>window-width<span class="o">)</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl">                         elfeed-search-trailing-width<span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>title-column <span class="o">(</span>elfeed-format-column
</span></span><span class="line"><span class="cl">                        title <span class="o">(</span>elfeed-clamp
</span></span><span class="line"><span class="cl">                               elfeed-search-title-min-width
</span></span><span class="line"><span class="cl">                               title-width
</span></span><span class="line"><span class="cl">                               elfeed-search-title-max-width<span class="o">)</span>
</span></span><span class="line"><span class="cl">                        :left<span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>authors-width 135<span class="o">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">(</span>authors-column <span class="o">(</span>elfeed-format-column
</span></span><span class="line"><span class="cl">                        entry-authors <span class="o">(</span>elfeed-clamp
</span></span><span class="line"><span class="cl">                               elfeed-search-title-min-width
</span></span><span class="line"><span class="cl">                               authors-width
</span></span><span class="line"><span class="cl">                               131<span class="o">)</span>
</span></span><span class="line"><span class="cl">                        :left<span class="o">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">(</span>insert <span class="o">(</span>propertize date <span class="s1">&#39;face &#39;</span>elfeed-search-date-face<span class="o">)</span> <span class="s2">&#34; &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">(</span>insert <span class="o">(</span>propertize title-column
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;face title-faces &#39;</span>kbd-help title<span class="o">)</span> <span class="s2">&#34; &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">(</span>insert <span class="o">(</span>propertize authors-column
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;face &#39;</span>elfeed-search-date-face
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;kbd-help entry-authors) &#34; &#34;)
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    ;; (when feed-title
</span></span></span><span class="line"><span class="cl"><span class="s1">    ;;   (insert (propertize entry-authors
</span></span></span><span class="line"><span class="cl"><span class="s1">    ;; &#39;</span>face <span class="s1">&#39;elfeed-search-feed-face) &#34; &#34;))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    (when entry-authors
</span></span></span><span class="line"><span class="cl"><span class="s1">      (insert (propertize feed-title
</span></span></span><span class="line"><span class="cl"><span class="s1">                          &#39;</span>face <span class="s1">&#39;elfeed-search-feed-face) &#34; &#34;))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    ;; (when tags
</span></span></span><span class="line"><span class="cl"><span class="s1">    ;;   (insert &#34;(&#34; tags-str &#34;)&#34;))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    )
</span></span></span><span class="line"><span class="cl"><span class="s1">  )
</span></span></span><span class="line"><span class="cl"><span class="s1">(setq elfeed-search-print-entry-function #&#39;</span>my-search-print-fn<span class="o">)</span>
</span></span></code></pre></div><h4 id="telega">telega<a hidden class="anchor" aria-hidden="true" href="#telega">¶</a></h4>
<p><code>brew install tdlib</code> 的版本过低，需要自行编译，参考 <a href="https://tdlib.github.io/td/build.html?language=Swift">TDLib build instructions</a>。这个之后需要 <code>M-x telega-server-build</code> 重新加载 telega-server。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">xcode-select --install
</span></span><span class="line"><span class="cl">/bin/bash -c <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">brew install gperf cmake openssl
</span></span><span class="line"><span class="cl">git clone https://github.com/tdlib/td.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> td
</span></span><span class="line"><span class="cl">rm -rf build
</span></span><span class="line"><span class="cl">mkdir build
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>Release -DOPENSSL_ROOT_DIR<span class="o">=</span>/usr/local/opt/openssl/ -DCMAKE_INSTALL_PREFIX:PATH<span class="o">=</span>/usr/local ..
</span></span><span class="line"><span class="cl">cmake --build . --target install
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">ls -l /usr/local
</span></span></code></pre></div><p>其中 tblib 的版本当前需要 1.8.4，可以切换到 1.8.4 的版本。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout b447c32fe94c3d62d74c6b9608649c791641c3e5
</span></span></code></pre></div><h3 id="init-org-dot-el">init-org.el<a hidden class="anchor" aria-hidden="true" href="#init-org-dot-el">¶</a></h3>
<p>org-roam 和 Emacs 自带的 agenda 可以很方便的将笔记和 GTD 结合起来。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-org.el --- Org-mode config -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Among settings for many aspects of `org-mode&#39;, this code includes</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; an opinionated setup for the Getting Things Done (GTD) system based</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; around the Org Agenda.  I have an &#34;inbox.org&#34; file with a header</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; including</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;     #+CATEGORY: Inbox</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;     #+FILETAGS: INBOX</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; and then set this file as `org-default-notes-file&#39;.  Captured org</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; items will then go into this file with the file-level tag, and can</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; be refiled to other locations as necessary.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Those other locations are generally other org files, which should</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; be added to `org-agenda-files-list&#39; (along with &#34;inbox.org&#34; org).</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; With that done, there&#39;s then an agenda view, accessible via the</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; `org-agenda&#39; command, which gives a convenient overview.</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; `org-todo-keywords&#39; is customised here to provide corresponding</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO states, which should make sense to GTD adherents.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 都是方便插入超链接的</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="vg">*is-a-mac*</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;grab-mac-link</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;org-cliplink</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 图片宽度</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-image-actual-width</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c l&#34;</span><span class="p">)</span> <span class="ss">&#39;org-store-link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c a&#34;</span><span class="p">)</span> <span class="ss">&#39;org-agenda</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A keymap for handy global access to org helpers, particularly clocking.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;j&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-goto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;l&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-in-last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;i&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-in</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">sanityinc/org-global-prefix-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;o&#34;</span><span class="p">)</span> <span class="ss">&#39;org-clock-out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">global-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c o&#34;</span><span class="p">)</span> <span class="nv">sanityinc/org-global-prefix-map</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Various preferences</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-log-done</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-edit-timestamp-down-means-later</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-hide-emphasis-markers</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-catch-invisible-edits</span> <span class="ss">&#39;show</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-export-coding-system</span> <span class="ss">&#39;utf-8</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-fast-tag-selection-single-key</span> <span class="ss">&#39;expert</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-html-validation-link</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-export-kill-product-buffer-when-displayed</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-tags-column</span> <span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Lots of stuff from http://doc.norang.ca/org-mode.html</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Re-align tags when window shape changes</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-agenda-mode-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;window-configuration-change-hook</span> <span class="ss">&#39;org-agenda-align-tags</span> <span class="no">nil</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Capturing</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-directory</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c c&#34;</span><span class="p">)</span> <span class="ss">&#39;org-capture</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-capture-templates</span>
</span></span><span class="line"><span class="cl">      <span class="o">`</span><span class="p">((</span><span class="s">&#34;i&#34;</span> <span class="s">&#34;inbox&#34;</span> <span class="nv">entry</span>  <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;agenda/inbox.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="o">,</span><span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;* TODO %?\n%U&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;note&#34;</span> <span class="nv">entry</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;agenda/note.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="s">&#34;* %? :NOTE:\n%U\n%a\n&#34;</span> <span class="nb">:clock-resume</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Refiling</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-cache</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Targets include this file and any file contributing to the agenda - up to 5 levels deep</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-targets</span> <span class="o">&#39;</span><span class="p">((</span><span class="no">nil</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-agenda-files</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">5</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-agenda-after-show-hook</span> <span class="ss">&#39;org-show-entry</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-refile</span> <span class="nb">:after</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-save-all-org-buffers</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Exclude DONE state tasks from refile targets</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/verify-refile-target</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Exclude todo keywords with a done state from refile targets.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">2</span> <span class="p">(</span><span class="nv">org-heading-components</span><span class="p">))</span> <span class="nv">org-done-keywords</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-target-verify-function</span> <span class="ss">&#39;sanityinc/verify-refile-target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/org-refile-anywhere</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">goto</span> <span class="nv">default-buffer</span> <span class="nv">rfloc</span> <span class="nv">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A version of </span><span class="ss">`org-refile&#39;</span><span class="s"> which allows refiling to any subtree.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-target-verify-function</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-refile</span> <span class="nv">goto</span> <span class="nv">default-buffer</span> <span class="nv">rfloc</span> <span class="nv">msg</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/org-agenda-refile-anywhere</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">goto</span> <span class="nv">rfloc</span> <span class="nv">no-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;A version of </span><span class="ss">`org-agenda-refile&#39;</span><span class="s"> which allows refiling to any subtree.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-target-verify-function</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-agenda-refile</span> <span class="nv">goto</span> <span class="nv">rfloc</span> <span class="nv">no-update</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Targets start with the file name - allows creating level 1 tasks</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;(setq org-refile-use-outline-path (quote file))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-outline-path</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-outline-path-complete-in-steps</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Allow refile to create parent tasks with confirmation</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-allow-creating-parent-nodes</span> <span class="ss">&#39;confirm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; To-do settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keywords</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">quote</span> <span class="p">((</span><span class="nv">sequence</span> <span class="s">&#34;TODO(t)&#34;</span> <span class="s">&#34;NEXT(n)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d!/!)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">sequence</span> <span class="s">&#34;PROJECT(p)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d!/!)&#34;</span> <span class="s">&#34;CANCELLED(c@/!)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">sequence</span> <span class="s">&#34;WAITING(w@/!)&#34;</span> <span class="s">&#34;DELEGATED(e!)&#34;</span> <span class="s">&#34;HOLD(h)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;CANCELLED(c@/!)&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">org-todo-repeat-to-state</span> <span class="s">&#34;NEXT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keyword-faces</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">quote</span> <span class="p">((</span><span class="s">&#34;NEXT&#34;</span> <span class="nb">:inherit</span> <span class="nv">warning</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="s">&#34;PROJECT&#34;</span> <span class="nb">:inherit</span> <span class="nv">font-lock-string-face</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Agenda views</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 将没有时间标记的任务，放在上方显示。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-sort-notime-is-late</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 时间显示为两位数(9:30 -&gt; 09:30)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-time-leading-zero</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 过滤掉部分 tags</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-hide-tags-regexp</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;dynamic&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span> <span class="p">(</span><span class="nv">file-expand-wildcards</span> <span class="s">&#34;~/Dropbox/org/agenda/*.org&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">org-agenda-clockreport-parameter-plist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:link</span> <span class="no">t</span> <span class="nb">:maxlevel</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">active-project-match</span> <span class="s">&#34;-INBOX/PROJECT&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-stuck-projects</span>
</span></span><span class="line"><span class="cl">        <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">active-project-match</span> <span class="p">(</span><span class="s">&#34;NEXT&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-compact-blocks</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-sticky</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-start-on-weekday</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-span</span> <span class="ss">&#39;day</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-include-diary</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">        <span class="o">&#39;</span><span class="p">((</span><span class="nv">agenda</span> <span class="nv">habit-down</span> <span class="nv">time-up</span> <span class="nv">user-defined-up</span> <span class="nv">effort-up</span> <span class="nv">category-keep</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">todo</span> <span class="nv">category-up</span> <span class="nv">effort-up</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">tags</span> <span class="nv">category-up</span> <span class="nv">effort-up</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">search</span> <span class="nv">category-up</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-window-setup</span> <span class="ss">&#39;current-window</span>
</span></span><span class="line"><span class="cl">        <span class="nv">org-agenda-custom-commands</span>
</span></span><span class="line"><span class="cl">        <span class="o">`</span><span class="p">((</span><span class="s">&#34;N&#34;</span> <span class="s">&#34;Notes&#34;</span> <span class="nv">tags</span> <span class="s">&#34;NOTE&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Notes&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="s">&#34;GTD&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="p">((</span><span class="nv">agenda</span> <span class="s">&#34;&#34;</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags</span> <span class="s">&#34;inbox&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Inbox&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">nil</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; (stuck &#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;        ((org-agenda-overriding-header &#34;Stuck Projects&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-agenda-tags-todo-honor-ignore-options t)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-tags-match-list-sublevels t)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;         (org-agenda-todo-ignore-scheduled &#39;future)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Next Actions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;HOLD&#34;</span> <span class="s">&#34;WAITING&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-entry-if</span> <span class="ss">&#39;nottodo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;NEXT&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">todo-state-down</span> <span class="nv">effort-up</span> <span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="o">,</span><span class="nv">active-project-match</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Projects&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;/WAITING&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Waiting&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;/DELEGATED&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Delegated&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;On Hold&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;WAITING&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-entry-if</span> <span class="ss">&#39;nottodo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;HOLD&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">tags-todo</span> <span class="s">&#34;-INBOX/-NEXT&#34;</span>
</span></span><span class="line"><span class="cl">                       <span class="p">((</span><span class="nv">org-agenda-overriding-header</span> <span class="s">&#34;Orphaned Tasks&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-tags-todo-honor-ignore-options</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-todo-ignore-scheduled</span> <span class="ss">&#39;future</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-skip-function</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;todo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;PROJECT&#34;</span> <span class="s">&#34;HOLD&#34;</span> <span class="s">&#34;WAITING&#34;</span> <span class="s">&#34;DELEGATED&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nv">org-agenda-skip-subtree-if</span> <span class="ss">&#39;nottododo</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;TODO&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-tags-match-list-sublevels</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="nv">org-agenda-sorting-strategy</span>
</span></span><span class="line"><span class="cl">                         <span class="o">&#39;</span><span class="p">(</span><span class="nv">category-keep</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; (tags-todo &#34;-NEXT&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;            ((org-agenda-overriding-header &#34;All other TODOs&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;;             (org-match-list-sublevels t)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-agenda-mode-hook</span> <span class="ss">&#39;hl-line-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Org clock</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save the running clock and all clock history when exiting Emacs, load it on startup</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-clock-persistence-insinuate</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-persist</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-in-resume</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save clock data and notes in the LOGBOOK drawer</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-into-drawer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Save state changes in the LOGBOOK drawer</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-log-into-drawer</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Removes clocked tasks with 0:00 duration</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-clock-out-remove-zero-time-clocks</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Show clock sums as hours and minutes, not &#34;n days&#34; etc.</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-time-clocksum-format</span>
</span></span><span class="line"><span class="cl">      <span class="o">&#39;</span><span class="p">(</span><span class="nb">:hours</span> <span class="s">&#34;%d&#34;</span> <span class="nb">:require-hours</span> <span class="no">t</span> <span class="nb">:minutes</span> <span class="s">&#34;:%02d&#34;</span> <span class="nb">:require-minutes</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Show the clocked-in task - if any - in the header line</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/show-org-clock-in-header-line</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">header-line-format</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34; &#34;</span> <span class="nv">org-mode-line-string</span> <span class="s">&#34; &#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">sanityinc/hide-org-clock-from-header-line</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">header-line-format</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-in-hook</span> <span class="ss">&#39;sanityinc/show-org-clock-in-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-out-hook</span> <span class="ss">&#39;sanityinc/hide-org-clock-from-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-cancel-hook</span> <span class="ss">&#39;sanityinc/hide-org-clock-from-header-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-clock</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-clock-mode-line-map</span> <span class="p">[</span><span class="nv">header-line</span> <span class="nv">mouse-2</span><span class="p">]</span> <span class="ss">&#39;org-clock-goto</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-clock-mode-line-map</span> <span class="p">[</span><span class="nv">header-line</span> <span class="nv">mouse-1</span><span class="p">]</span> <span class="ss">&#39;org-clock-menu</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="vg">*is-a-mac*</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="s">&#34;/Applications/org-clock-statusbar.app&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-in-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">call-process</span> <span class="s">&#34;/usr/bin/osascript&#34;</span> <span class="no">nil</span> <span class="mi">0</span> <span class="no">nil</span> <span class="s">&#34;-e&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;tell application \&#34;org-clock-statusbar\&#34; to clock in \&#34;&#34;</span> <span class="nv">org-clock-current-task</span> <span class="s">&#34;\&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-clock-out-hook</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nf">call-process</span> <span class="s">&#34;/usr/bin/osascript&#34;</span> <span class="no">nil</span> <span class="mi">0</span> <span class="no">nil</span> <span class="s">&#34;-e&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="s">&#34;tell application \&#34;org-clock-statusbar\&#34; to clock out&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO: warn about inconsistent items, e.g. TODO inside non-PROJECT</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO: nested projects!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Archiving</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-mark-done</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-location</span> <span class="s">&#34;%s_archive::* Archive&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-pomodoro</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-pomodoro-keep-killed-pomodoro-time</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org-agenda</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-agenda-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;P&#34;</span><span class="p">)</span> <span class="ss">&#39;org-pomodoro</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; ;; Show iCal calendars in the org agenda</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (when (and *is-a-mac* (require &#39;org-mac-iCal nil t))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;   (setq org-agenda-include-diary t</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;         org-agenda-custom-commands</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;         &#39;((&#34;I&#34; &#34;Import diary from iCal&#34; agenda &#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;            ((org-agenda-mode-hook #&#39;org-mac-iCal)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;   (add-hook &#39;org-agenda-cleanup-fancy-diary-hook</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;             (lambda ()</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (goto-char (point-min))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (save-excursion</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (while (re-search-forward &#34;^[a-z]&#34; nil t)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (goto-char (match-beginning 0))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (insert &#34;0:00-24:00 &#34;)))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;               (while (re-search-forward &#34;^ [a-z]&#34; nil t)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (goto-char (match-beginning 0))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (save-excursion</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                   (re-search-backward &#34;^[0-9]+:[0-9]+-[0-9]+:[0-9]+ &#34; nil t))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;                 (insert (match-string 0))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-&lt;up&gt;&#34;</span><span class="p">)</span> <span class="ss">&#39;org-up-element</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="vg">*is-a-mac*</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;M-h&#34;</span><span class="p">)</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c g&#34;</span><span class="p">)</span> <span class="ss">&#39;grab-mac-link</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;org</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="ss">&#39;org-babel-load-languages</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">seq-filter</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">pair</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">featurep</span> <span class="p">(</span><span class="nf">intern</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;ob-&#34;</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">pair</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">    <span class="o">&#39;</span><span class="p">((</span><span class="nv">R</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ditaa</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">rust</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">dot</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">emacs-lisp</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">gnuplot</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">haskell</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">latex</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ledger</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ocaml</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">octave</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">plantuml</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">python</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">ruby</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">screen</span> <span class="o">.</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sh</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; obsolete</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">shell</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sql</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">sqlite</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; org-starter</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;org-starter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-use-outline-path</span> <span class="ss">&#39;file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-starter</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (add-hook! &#39;after-init-hook &#39;org-starter-load-all-files-in-path)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-starter-def</span> <span class="s">&#34;~/Dropbox/org&#34;</span>
</span></span><span class="line"><span class="cl">                   <span class="nb">:files</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/inbox.org&#34;</span>          <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;i&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/work.org&#34;</span>           <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;w&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/technical-debt.org&#34;</span> <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;t&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/personal.org&#34;</span>       <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;p&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/books.org&#34;</span>          <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;b&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/someday.org&#34;</span>        <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;s&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/agenda.org&#34;</span>         <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;a&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;agenda/note.org&#34;</span>           <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;n&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="s">&#34;daily/journal.org&#34;</span>         <span class="nb">:agenda</span> <span class="no">t</span> <span class="nb">:key</span> <span class="s">&#34;j&#34;</span> <span class="nb">:refile</span> <span class="p">(</span><span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; hydra</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;hydra</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-org-agenda-menu</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">  Org-agenda-menu
</span></span></span><span class="line"><span class="cl"><span class="s">  ^^^^------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="s">  _i_: inbox.org     _w_: work.org      _t_: technical-debt.org
</span></span></span><span class="line"><span class="cl"><span class="s">  _b_: books.org     _a_: agenda.org    _p_: personal.org
</span></span></span><span class="line"><span class="cl"><span class="s">  _n_: note.org      _s_: someday.org   _j_: journal.org
</span></span></span><span class="line"><span class="cl"><span class="s">  &#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;i&#34;</span> <span class="nv">org-starter-find-file:inbox</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;w&#34;</span> <span class="nv">org-starter-find-file:work</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="nv">org-starter-find-file:technical-debt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="nv">org-starter-find-file:personal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="nv">org-starter-find-file:books</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="nv">org-starter-find-file:note</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="nv">org-starter-find-file:someday</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="nv">org-starter-find-file:agenda</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="nv">org-starter-find-file:journal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="nb">:bind</span><span class="p">(</span><span class="s">&#34;C-c e&#34;</span> <span class="o">.</span> <span class="nv">hydra-org-agenda-menu/body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Dynamic org-agenda with org-roam</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; https://gist.github.com/d12frosted/a60e8ccb9aceba031af243dff0d19b2e</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return non-nil if current buffer has any todo entry.
</span></span></span><span class="line"><span class="cl"><span class="s">TODO entries marked as done are ignored, meaning the this
</span></span></span><span class="line"><span class="cl"><span class="s">function returns nil if current buffer contains only completed
</span></span></span><span class="line"><span class="cl"><span class="s">tasks.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">seq-find</span>                                 <span class="c1">; (3)</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">eq</span> <span class="nv">type</span> <span class="ss">&#39;todo</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="nv">org-element-map</span>                         <span class="c1">; (2)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">org-element-parse-buffer</span> <span class="ss">&#39;headline</span><span class="p">)</span> <span class="c1">; (1)</span>
</span></span><span class="line"><span class="cl">       <span class="ss">&#39;headline</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:todo-type</span> <span class="nv">h</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-update-tag</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Update dynamic tag in the current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">active-minibuffer-window</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">vulpea-buffer-p</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">vulpea-dynamic-p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nf">cons</span> <span class="s">&#34;dynamic&#34;</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nv">remove</span> <span class="s">&#34;dynamic&#34;</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">;; cleanup duplicates</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">tags</span> <span class="p">(</span><span class="nv">seq-uniq</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="c1">;; update tags if changed</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">tags</span> <span class="nv">original-tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nv">seq-difference</span> <span class="nv">original-tags</span> <span class="nv">tags</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-p</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return non-nil if the currently visited buffer is a note.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">and</span> <span class="nf">buffer-file-name</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nv">string-prefix-p</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">file-name-as-directory</span> <span class="nv">org-roam-directory</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">file-name-directory</span> <span class="nf">buffer-file-name</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-dynamic-files</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return a list of note files containing &#39;dynamic&#39; tag.&#34;</span> <span class="c1">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">seq-uniq</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nv">seq-map</span>
</span></span><span class="line"><span class="cl">      <span class="nf">#&#39;car</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-roam-db-query</span>
</span></span><span class="line"><span class="cl">       <span class="p">[</span><span class="nb">:select</span> <span class="p">[</span><span class="nv">nodes:file</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:from</span> <span class="nv">tags</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:left-join</span> <span class="nv">nodes</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:on</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">tags:node-id</span> <span class="nv">nodes:id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">:where</span> <span class="p">(</span><span class="nv">like</span> <span class="nv">tag</span> <span class="p">(</span><span class="nb">quote</span> <span class="s">&#34;%\&#34;dynamic\&#34;%&#34;</span><span class="p">))]))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-agenda-files-update</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Update the value of </span><span class="ss">`org-agenda-files&#39;</span><span class="s">.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; (setq org-agenda-files (vulpea-dynamic-files)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-agenda-files</span> <span class="p">(</span><span class="nv">seq-uniq</span>
</span></span><span class="line"><span class="cl">                          <span class="p">(</span><span class="nf">append</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">vulpea-dynamic-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                           <span class="p">(</span><span class="nv">file-expand-wildcards</span> <span class="s">&#34;~/Dropbox/org/agenda/*.org&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;find-file-hook</span> <span class="nf">#&#39;</span><span class="nv">vulpea-dynamic-update-tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="nf">#&#39;</span><span class="nv">vulpea-dynamic-update-tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-agenda</span> <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">vulpea-agenda-files-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-todo-list</span> <span class="nb">:before</span> <span class="nf">#&#39;</span><span class="nv">vulpea-agenda-files-update</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; functions borrowed from `vulpea&#39; library</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; https://github.com/d12frosted/vulpea/blob/6a735c34f1f64e1f70da77989e9ce8da7864e5ff/vulpea-buffer.el</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-get</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return filetags value in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">vulpea-buffer-prop-get-list</span> <span class="s">&#34;filetags&#34;</span> <span class="s">&#34;[ :]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-set</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">tags</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set TAGS in current buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">If filetags value is already set, replace it.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="nv">tags</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">vulpea-buffer-prop-set</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;filetags&#34;</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;:&#34;</span> <span class="p">(</span><span class="nv">string-join</span> <span class="nv">tags</span> <span class="s">&#34;:&#34;</span><span class="p">)</span> <span class="s">&#34;:&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">vulpea-buffer-prop-remove</span> <span class="s">&#34;filetags&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-add</span> <span class="p">(</span><span class="nv">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add a TAG to filetags in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags</span> <span class="p">(</span><span class="nf">append</span> <span class="nv">tags</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">tag</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-tags-remove</span> <span class="p">(</span><span class="nv">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove a TAG from filetags in current buffer.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">tags</span> <span class="p">(</span><span class="nv">vulpea-buffer-tags-get</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nv">tags</span> <span class="p">(</span><span class="nf">delete</span> <span class="nv">tag</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">vulpea-buffer-tags-set</span> <span class="nv">tags</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-set</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set a file property called NAME to VALUE in buffer file.
</span></span></span><span class="line"><span class="cl"><span class="s">If the property is already set, replace its value.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">name</span> <span class="p">(</span><span class="nf">downcase</span> <span class="nv">name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;:\\(.*\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">replace-match</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;#+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: &#34;</span> <span class="nv">value</span><span class="p">)</span> <span class="ss">&#39;fixedcase</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;^[#:]&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">save-excursion</span> <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\n&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">forward-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;#+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: &#34;</span> <span class="nv">value</span> <span class="s">&#34;\n&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-set-list</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">values</span> <span class="kp">&amp;optional</span> <span class="nv">separators</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Set a file property called NAME to VALUES in current buffer.
</span></span></span><span class="line"><span class="cl"><span class="s">VALUES are quoted and combined into single string using
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="ss">`combine-and-quote-strings&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">If SEPARATORS is non-nil, it should be a regular expression
</span></span></span><span class="line"><span class="cl"><span class="s">matching text that separates, but is not part of, the substrings.
</span></span></span><span class="line"><span class="cl"><span class="s">If nil it defaults to </span><span class="ss">`split-string-default-separators&#39;</span><span class="s">, normally
</span></span></span><span class="line"><span class="cl"><span class="s">\&#34;[ \f\t\n\r\v]+\&#34;, and OMIT-NULLS is forced to t.
</span></span></span><span class="line"><span class="cl"><span class="s">If the property is already set, replace its value.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">vulpea-buffer-prop-set</span>
</span></span><span class="line"><span class="cl">   <span class="nv">name</span> <span class="p">(</span><span class="nv">combine-and-quote-strings</span> <span class="nv">values</span> <span class="nv">separators</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-get</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get a buffer property called NAME as a string.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;: \\(.*\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="p">(</span><span class="nf">match-end</span> <span class="mi">1</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-get-list</span> <span class="p">(</span><span class="nv">name</span> <span class="kp">&amp;optional</span> <span class="nv">separators</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Get a buffer property NAME as a list using SEPARATORS.
</span></span></span><span class="line"><span class="cl"><span class="s">If SEPARATORS is non-nil, it should be a regular expression
</span></span></span><span class="line"><span class="cl"><span class="s">matching text that separates, but is not part of, the substrings.
</span></span></span><span class="line"><span class="cl"><span class="s">If nil it defaults to </span><span class="ss">`split-string-default-separators&#39;</span><span class="s">, normally
</span></span></span><span class="line"><span class="cl"><span class="s">\&#34;[ \f\t\n\r\v]+\&#34;, and OMIT-NULLS is forced to t.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">value</span> <span class="p">(</span><span class="nv">vulpea-buffer-prop-get</span> <span class="nv">name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">value</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string-empty-p</span> <span class="nv">value</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">split-string-and-unquote</span> <span class="nv">value</span> <span class="nv">separators</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">vulpea-buffer-prop-remove</span> <span class="p">(</span><span class="nv">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Remove a buffer property called NAME.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-with-point-at</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;\\(^#\\+&#34;</span> <span class="nv">name</span> <span class="s">&#34;:.*\n?\\)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                             <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">replace-match</span> <span class="s">&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;;; Archiving</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq org-archive-mark-done nil)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; (setq org-archive-location &#34;%s_archive::* Archive&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; https://gist.github.com/kepi/2f4acc3cc93403c75fbba5684c5d852d</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; org-archive-subtree-hierarchical.el</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; version 0.2</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; modified from https://lists.gnu.org/archive/html/emacs-orgmode/2014-08/msg00109.html</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; modified from https://stackoverflow.com/a/35475878/259187</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; In orgmode</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; * A</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** AAA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AB</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** ABA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Archiving AA will remove the subtree from the original file and create</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; it like that in archive target:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; * AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AAA</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; And this give you</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; * A</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; ** AA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; *** AAA</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Install file to your include path and include in your init file with:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (require &#39;org-archive-subtree-hierarchical)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;  (setq org-archive-default-command &#39;org-archive-subtree-hierarchical)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-archive-default-command</span> <span class="ss">&#39;org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-archive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Returns the content of the current line as a string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--org-child-list</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function returns all children of a heading as a list. &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; this only works with org-version &gt; 8.0, since in previous</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; org-mode versions the function (org-outline-level) returns</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; gargabe when the point is not on a heading.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nv">org-outline-level</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">outline-next-visible-heading</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-goto-first-child</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">child-list</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">org-goto-sibling</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">child-list</span> <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--line-content-as-string</span><span class="p">)</span> <span class="nv">child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="nv">child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical--org-struct-subtree</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function returns the tree structure in which a subtree
</span></span></span><span class="line"><span class="cl"><span class="s">belongs as a list.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">archive-tree</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">org-up-heading-safe</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">heading</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">archive-tree</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">archive-tree</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">heading</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">setq</span> <span class="nv">archive-tree</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">heading</span> <span class="nv">archive-tree</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">    <span class="nv">archive-tree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree-hierarchical</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This function archives a subtree hierarchical&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-tree</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--org-struct-subtree</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">this-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">file</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="p">(</span><span class="nf">buffer-base-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;No file associated to buffer&#34;</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">location</span> <span class="nv">org-archive-location</span>
</span></span><span class="line"><span class="cl">            <span class="nv">afile</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-archive--compute-location</span>
</span></span><span class="line"><span class="cl">                                   <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">&#34;ARCHIVE&#34;</span> <span class="ss">&#39;inherit</span><span class="p">)</span> <span class="nv">location</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="c1">;; heading (org-extract-archive-heading location)</span>
</span></span><span class="line"><span class="cl">            <span class="nv">infile-p</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">file</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">afile</span> <span class="s">&#34;&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="nv">afile</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Invalid </span><span class="ss">`org-archive-location&#39;</span><span class="s">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">afile</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">newfile-p</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">afile</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nv">visiting</span> <span class="p">(</span><span class="nv">find-buffer-visiting</span> <span class="nv">afile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nv">buffer</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">visiting</span> <span class="p">(</span><span class="nv">find-file-noselect</span> <span class="nv">afile</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="nv">buffer</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Cannot access file \&#34;%s\&#34;&#34;</span> <span class="nv">afile</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-cut-subtree</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">set-buffer</span> <span class="nv">buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-tree</span> <span class="no">nil</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">child-list</span> <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical--org-child-list</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-tree</span><span class="p">)</span> <span class="nv">child-list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nf">search-forward</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-tree</span><span class="p">)</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-tree</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">org-tree</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">org-insert-struct</span> <span class="nv">org-tree</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-tree</span> <span class="no">nil</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">org-yank</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">this-buffer</span> <span class="nv">buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">save-buffer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Subtree archived %s&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;in file: &#34;</span> <span class="p">(</span><span class="nv">abbreviate-file-name</span> <span class="nv">afile</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-insert-struct</span> <span class="p">(</span><span class="nv">struct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;TODO&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="nv">struct</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">struct</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-insert-struct</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">struct</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-archive-subtree</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-archive-subtree-hierarchical</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">require-package</span> <span class="ss">&#39;emacsql-sqlite-builtin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-roam</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:ensure</span> <span class="no">t</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:demand</span> <span class="no">t</span> <span class="c1">;; ensure org-roam is loaded by default</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:init</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:custom</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-directory</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="s">&#34;~/Dropbox/org/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; 需要 emacs-plus@29 版本</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-database-connector</span> <span class="ss">&#39;sqlite-builtin</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-location</span> <span class="s">&#34;~/Dropbox/org/org.db&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-gc-threshold</span> <span class="nv">most-positive-fixnum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-completion-everywhere</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-capture-templates</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;; #+OPTIONS: toc:nil 为了导出 .md 的格式更加符合使用</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="s">&#34;default&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/default.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;main/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="s">&#34;article&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/article.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;article/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="s">&#34;book notes&#34;</span> <span class="nv">plain</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;~/Dropbox/org/templates/book-notes.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file</span> <span class="s">&#34;book/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:unnarrowed</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;  (&#34;p&#34; &#34;project&#34; plain &#34;* Goals\n\n%?\n\n* Tasks\n\n** TODO Add initial tasks\n\n* Dates\n\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :if-new (file+head &#34;%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34; &#34;#+title: ${title}\n#+category: ${title}\n#+filetags: Project&#34;)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :unnarrowed t)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;  (&#34;l&#34; &#34;programming language&#34; plain</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   &#34;* Reference:\n\n&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :if-new (file+head &#34;programming language/%&lt;%Y%m%d%H%M%S&gt;-${slug}.org&#34; &#34;#+title: ${title}\n#+OPTIONS: toc:nil\n&#34;)</span>
</span></span><span class="line"><span class="cl">     <span class="c1">;;   :unnarrowed t)</span>
</span></span><span class="line"><span class="cl">     <span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-dailies-capture-templates</span>
</span></span><span class="line"><span class="cl">   <span class="c1">;; %&lt;%H:%M&gt; 为24小时制，%&lt;%I:%M %p&gt; 为12小时制</span>
</span></span><span class="line"><span class="cl">   <span class="o">&#39;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="s">&#34;default&#34;</span> <span class="nv">entry</span> <span class="s">&#34;** %&lt;%H:%M&gt; %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="s">&#34;read&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;What I read? :read:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="s">&#34;tasks&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;Tasks :task:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;notes&#34;</span> <span class="nv">entry</span> <span class="s">&#34;*** %?&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span> <span class="s">&#34;Notes :note:&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">(</span><span class="s">&#34;o&#34;</span> <span class="s">&#34;online&#34;</span> <span class="nv">entry</span> <span class="s">&#34;** %&lt;%H:%M&gt; %? :online:&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">:if-new</span> <span class="p">(</span><span class="nv">file+head+olp</span> <span class="s">&#34;%&lt;%Y-%m-%d&gt;.org&#34;</span> <span class="s">&#34;#+title: %&lt;%Y-%m-%d&gt;\n#+ARCHIVE: journal.org::\n&#34;</span> <span class="p">(</span><span class="s">&#34;%&lt;%Y-%m-%d&gt;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">     <span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c n l&#34;</span> <span class="o">.</span> <span class="nv">org-roam-buffer-toggle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n f&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-find</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n i&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-insert</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n j&#34;</span> <span class="o">.</span> <span class="nv">org-roam-dailies-capture-today</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n I&#34;</span> <span class="o">.</span> <span class="nv">org-roam-node-insert-immediate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-c n m&#34;</span> <span class="o">.</span> <span class="nv">dired-copy-images-links</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nb">:map</span> <span class="nv">org-mode-map</span>
</span></span><span class="line"><span class="cl">         <span class="c1">;; Ctrl-Alt-i</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="s">&#34;C-M-i&#34;</span> <span class="o">.</span> <span class="nv">completion-at-point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="nb">:config</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">org-roam-directory</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">org-roam-directory</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">org-roam-db-autosync-enable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;;使用侧边栏而不是完整buffer</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;display-buffer-alist</span>
</span></span><span class="line"><span class="cl">               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;\\*org-roam\\*&#34;</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">display-buffer-in-direction</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">direction</span> <span class="o">.</span> <span class="nv">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">window-width</span> <span class="o">.</span> <span class="mf">0.33</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nv">window-height</span> <span class="o">.</span> <span class="nv">fit-window-to-buffer</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-export-backends</span> <span class="p">(</span><span class="nb">quote</span> <span class="p">(</span><span class="nv">ascii</span> <span class="nv">html</span> <span class="nv">icalendar</span> <span class="nv">latex</span> <span class="nv">md</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; code hightlight</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-src-fontify-natively</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; If using org-roam-protocol</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam-protocol</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-roam-export</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-tempo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; Copy Done To-Dos to Today</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-copy-todo-to-today</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">org-refile-keep</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; Set this to nil to delete the original!</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-after-refile-insert-hook</span> <span class="nf">#&#39;</span><span class="nv">save-buffer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nv">today-file</span>
</span></span><span class="line"><span class="cl">          <span class="nv">pos</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-window-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-dailies-capture-today</span> <span class="no">t</span> <span class="s">&#34;t&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">today-file</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">;; Only refile if the target file is different than the current file</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="nv">today-file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">file-truename</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-refile</span> <span class="no">nil</span> <span class="no">nil</span> <span class="p">(</span><span class="nf">list</span> <span class="s">&#34;Tasks&#34;</span> <span class="nv">today-file</span> <span class="no">nil</span> <span class="nv">pos</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-after-todo-state-change-hook</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">;; DONE 和 CANCELLED 的 To-Dos 自动复制到今日</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">;; 同时过滤掉 habit 的 To-Dos</span>
</span></span><span class="line"><span class="cl">                 <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-state</span> <span class="s">&#34;DONE&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">org-state</span> <span class="s">&#34;CANCELLED&#34;</span><span class="p">))</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-find-property</span> <span class="s">&#34;STYLE&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">                   <span class="p">(</span><span class="nv">org-roam-copy-todo-to-today</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; node-find 的时候展示文件夹</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; org-roam-node-type</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-type</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;Return the TYPE of NODE.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">condition-case</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">file-name-nondirectory</span>
</span></span><span class="line"><span class="cl">         <span class="p">(</span><span class="nf">directory-file-name</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">file-name-directory</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="nv">file-relative-name</span> <span class="p">(</span><span class="nv">org-roam-node-file</span> <span class="nv">node</span><span class="p">)</span> <span class="nv">org-roam-directory</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Codes blow are used to general a hierachy for title nodes that under a file</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-doom-filetitle</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return the value of \&#34;#+title:\&#34; (if any) from file that NODE resides in.
</span></span></span><span class="line"><span class="cl"><span class="s">If there&#39;s no file-level title in the file, return empty string.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nv">org-roam-node-level</span> <span class="nv">node</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">org-roam-node-title</span> <span class="nv">node</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-get-keyword</span> <span class="s">&#34;TITLE&#34;</span> <span class="p">(</span><span class="nv">org-roam-node-file</span> <span class="nv">node</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">cl-defmethod</span> <span class="nv">org-roam-node-doom-hierarchy</span> <span class="p">((</span><span class="nv">node</span> <span class="nv">org-roam-node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Return hierarchy for NODE, constructed of its file title, OLP and direct title.
</span></span></span><span class="line"><span class="cl"><span class="s">  If some elements are missing, they will be stripped out.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">title</span>     <span class="p">(</span><span class="nv">org-roam-node-title</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">olp</span>       <span class="p">(</span><span class="nv">org-roam-node-olp</span>   <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">level</span>     <span class="p">(</span><span class="nv">org-roam-node-level</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">filetitle</span> <span class="p">(</span><span class="nv">org-roam-node-doom-filetitle</span> <span class="nv">node</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">separator</span> <span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34; &gt; &#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;shadow</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">cl-case</span> <span class="nv">level</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a top-level file</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="mi">0</span> <span class="nv">filetitle</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a level 1 heading</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="mi">1</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">filetitle</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="nv">title</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="c1">;; node is a heading with an arbitrary outline path</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">propertize</span> <span class="nv">filetitle</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="p">(</span><span class="nf">propertize</span> <span class="p">(</span><span class="nv">string-join</span> <span class="nv">olp</span> <span class="s">&#34; &gt; &#34;</span><span class="p">)</span> <span class="ss">&#39;face</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">shadow</span> <span class="nv">italic</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                 <span class="nv">separator</span> <span class="nv">title</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-roam-node-display-template</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;${type:15} ${doom-hierarchy:80} &#34;</span> <span class="p">(</span><span class="nf">propertize</span> <span class="s">&#34;${tags:*}&#34;</span> <span class="ss">&#39;face</span> <span class="ss">&#39;org-tag</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; 在记录的时候创建新的 node 时不退出当前状态，保存新建的 node。</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-roam-node-insert-immediate</span> <span class="p">(</span><span class="nv">arg</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">args</span> <span class="p">(</span><span class="nb">push</span> <span class="nv">arg</span> <span class="nv">args</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">org-roam-capture-templates</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">append</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">org-roam-capture-templates</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="o">&#39;</span><span class="p">(</span><span class="nb">:immediate-finish</span> <span class="no">t</span><span class="p">)))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nf">#&#39;</span><span class="nv">org-roam-node-insert</span> <span class="nv">args</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; C-x d 进入 dired 模式，m 来标记对应需要复制链接的图片，C-c n m 即可复制到需要的图片插入文本。</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; source: https://org-roam.discourse.group/t/is-there-a-solution-for-images-organization-in-org-roam/925</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">dired-copy-images-links</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Works only in dired-mode, put in kill-ring,
</span></span></span><span class="line"><span class="cl"><span class="s">  ready to be yanked in some other org-mode file,
</span></span></span><span class="line"><span class="cl"><span class="s">  the links of marked image files using file-name-base as #+CAPTION.
</span></span></span><span class="line"><span class="cl"><span class="s">  If no file marked then do it on all images files of directory.
</span></span></span><span class="line"><span class="cl"><span class="s">  No file is moved nor copied anywhere.
</span></span></span><span class="line"><span class="cl"><span class="s">  This is intended to be used with org-redisplay-inline-images.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;dired-mode</span><span class="p">)</span>                           <span class="c1">; if we are in dired-mode</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">marked-files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">))</span>         <span class="c1">; get marked file list</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">number-marked-files</span>                            <span class="c1">; store number of marked files</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">string-to-number</span>                              <span class="c1">; as a number</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nv">dired-number-of-marked-files</span><span class="p">))))</span>             <span class="c1">; for later reference</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">number-marked-files</span> <span class="mi">0</span><span class="p">)</span>                      <span class="c1">; if none marked then</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">dired-toggle-marks</span><span class="p">)</span>                               <span class="c1">; mark all files</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">marked-files</span> <span class="p">(</span><span class="nv">dired-get-marked-files</span><span class="p">)))</span>      <span class="c1">; get marked file list</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Files marked for copy&#34;</span><span class="p">)</span>                    <span class="c1">; info message</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">dired-number-of-marked-files</span><span class="p">)</span>                       <span class="c1">; marked files info</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">kill-new</span> <span class="s">&#34;\n&#34;</span><span class="p">)</span>                                      <span class="c1">; start with a newline</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">marked-file</span> <span class="nv">marked-files</span><span class="p">)</span>                   <span class="c1">; walk the marked files list</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-file-image-p</span> <span class="nv">marked-file</span><span class="p">)</span>               <span class="c1">; only on image files</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nv">kill-append</span>                                     <span class="c1">; append image to kill-ring</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;#+CAPTION: &#34;</span>                           <span class="c1">; as caption,</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="nv">file-name-base</span> <span class="nv">marked-file</span><span class="p">)</span>            <span class="c1">; use file-name-base</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;\n#+ATTR_ORG: :width 800&#34;</span>              <span class="c1">; img width</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;\n[[file:&#34;</span> <span class="nv">marked-file</span> <span class="s">&#34;]]\n\n&#34;</span><span class="p">)</span> <span class="no">nil</span><span class="p">)))</span><span class="c1">; link to marked-file</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">number-marked-files</span> <span class="mi">0</span><span class="p">)</span>                      <span class="c1">; if none were marked then</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">dired-toggle-marks</span><span class="p">)))</span>                             <span class="c1">; unmark all</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Error: Does not work outside dired-mode&#34;</span><span class="p">)</span>      <span class="c1">; can&#39;t work not in dired-mode</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">ding</span><span class="p">)))</span>                                                 <span class="c1">; error sound</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Save the corresponding buffers</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gtd-save-org-buffers</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Save </span><span class="ss">`org-agenda-files&#39;</span><span class="s"> buffers without user confirmation.
</span></span></span><span class="line"><span class="cl"><span class="s">See also </span><span class="ss">`org-save-all-org-buffers&#39;</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Saving org-agenda-files buffers...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">save-some-buffers</span> <span class="no">t</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">member</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)</span> <span class="nv">org-agenda-files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Saving org-agenda-files buffers... done&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; Add it after refile</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org-refile</span> <span class="nb">:after</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">_</span><span class="p">)</span> <span class="p">(</span><span class="nv">gtd-save-org-buffers</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">log-todo-next-creation-date</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">ignore</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Log NEXT creation time in the property drawer under the key &#39;ACTIVATED&#39;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">string=</span> <span class="p">(</span><span class="nv">org-get-todo-state</span><span class="p">)</span> <span class="s">&#34;NEXT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">org-entry-get</span> <span class="no">nil</span> <span class="s">&#34;ACTIVATED&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">org-entry-put</span> <span class="no">nil</span> <span class="s">&#34;ACTIVATED&#34;</span> <span class="p">(</span><span class="nf">format-time-string</span> <span class="s">&#34;[%Y-%m-%d]&#34;</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-after-todo-state-change-hook</span> <span class="nf">#&#39;</span><span class="nv">log-todo-next-creation-date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; Put the text property afterwards with an advice</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-override-header</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Change the face of the overriden header string if needed.
</span></span></span><span class="line"><span class="cl"><span class="s">The propertized header text is taken from </span><span class="ss">`org-agenda-overriding-header&#39;</span><span class="s">.
</span></span></span><span class="line"><span class="cl"><span class="s">The face is only changed if the overriding header is propertized with a face.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">pt</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">header</span> <span class="nv">org-agenda-overriding-header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nf">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; Only replace if there is an overriding header and not an empty string.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">;; And only if the header text has a face property.</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">header</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">header</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="p">(</span><span class="nf">get-text-property</span> <span class="mi">0</span> <span class="ss">&#39;face</span> <span class="nv">header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">pt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">;; Search for the header text.</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">search-forward</span> <span class="nv">header</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">unwind-protect</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nb">progn</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">-1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="c1">;; Replace it with the propertized text.</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nf">replace-match</span> <span class="nv">header</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nv">read-only-mode</span> <span class="mi">1</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-override-header-add-advices</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Add advices to make changing work in all agenda commands.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">fun</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-agenda-list</span> <span class="nv">org-todo-list</span> <span class="nv">org-search-view</span> <span class="nv">org-tags-view</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nv">advice-add</span> <span class="nv">fun</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">my-org-agenda-override-header</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">my-org-agenda-override-header-add-advices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; 只显示 outline 下第一个 TODO</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">my-org-agenda-skip-all-siblings-but-first</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Skip all but the first non-done entry.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">should-skip-entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">org-current-is-todo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">setq</span> <span class="nv">should-skip-entry</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">save-excursion</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">should-skip-entry</span><span class="p">)</span> <span class="p">(</span><span class="nv">org-goto-sibling</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">org-current-is-todo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">setq</span> <span class="nv">should-skip-entry</span> <span class="no">t</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="nv">should-skip-entry</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">outline-next-heading</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-current-is-todo</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;TODO&#34;</span> <span class="p">(</span><span class="nv">org-get-todo-state</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-org</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-org.el ends here</span>
</span></span></code></pre></div><h4 id="org-babel">Org-babel<a hidden class="anchor" aria-hidden="true" href="#org-babel">¶</a></h4>
<p>输出 <code>:results</code> 有不同的选项，其中 <code>silent</code> 是指：Do not insert results in the Org mode buffer, but echo them in the minibuffer. Usage example: ‘:results output silent’.</p>
<p>Rust 运行代码块，需要安装 <a href="https://github.com/brotzeit/rustic">GitHub - brotzeit/rustic: Rust development environment for Emacs</a>，具体执行的时候会提示需要安装 <code>lsp-mode</code>​，确定即可。</p>
<h4 id="plantuml">PlantUML<a hidden class="anchor" aria-hidden="true" href="#plantuml">¶</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install graphviz
</span></span></code></pre></div><table>
<thead>
<tr>
<th>Type</th>
<th>Symbol</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zero or One</td>
<td>o|&ndash;</td>
</tr>
<tr>
<td>Exactly One</td>
<td>||&ndash;</td>
</tr>
<tr>
<td>Zero or Many</td>
<td>}o&ndash;</td>
</tr>
<tr>
<td>One or Many</td>
<td>}|&ndash;</td>
</tr>
</tbody>
</table>
<pre tabindex="0"><code class="language-nil" data-lang="nil">@startumlg
scale 2
Entity01 }|..|| Entity02
Entity03 }o..o| Entity04
Entity05 ||--o{ Entity06
Entity07 |o--|| Entity08
@enduml
</code></pre><p>PlantUML 默认的样式比较古老，可以用更加现代一些的样式：<a href="https://github.com/xuanye/plantuml-style-c4">GitHub - xuanye/plantuml-style-c4: 自定义的plantuml 样式</a>。</p>
<figure>
    <img loading="lazy" src="/ox-hugo/ERD-example.jpg"/> 
</figure>

<h3 id="init-font-dot-el">init-font.el<a hidden class="anchor" aria-hidden="true" href="#init-font-dot-el">¶</a></h3>
<p>使用的是 <code>Iosevka</code> 和 <code>LXGW WenKai Mono</code> 分别作为英文和中文字体，字体大小设置 13/14 就可以完美对齐了。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-font.el --- Dired customisations -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; base on https://gist.github.com/coldnew/7398835</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">emacs-english-font</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;The font name of English.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">emacs-cjk-font</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;The font name for CJK.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">emacs-font-size-pair</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Default font size pair for (english . chinese)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">emacs-font-size-pair-list</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;This list is used to store matching (englis . chinese) font-size.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">font-exist-p</span> <span class="p">(</span><span class="nv">fontname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;test if this font is exist or not.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">fontname</span><span class="p">)</span> <span class="p">(</span><span class="nv">string=</span> <span class="nv">fontname</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="no">nil</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">x-list-fonts</span> <span class="nv">fontname</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="no">nil</span> <span class="no">t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">set-font</span> <span class="p">(</span><span class="nv">english</span> <span class="nv">chinese</span> <span class="nv">size-pair</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Setup emacs English and Chinese font on x window-system.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">font-exist-p</span> <span class="nv">english</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">set-frame-font</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s:pixelsize=%d&#34;</span> <span class="nv">english</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">size-pair</span><span class="p">))</span> <span class="no">t</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">font-exist-p</span> <span class="nv">chinese</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">charset</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">kana</span> <span class="nv">han</span> <span class="nv">symbol</span> <span class="nv">cjk-misc</span> <span class="nv">bopomofo</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nf">set-fontset-font</span> <span class="p">(</span><span class="nf">frame-parameter</span> <span class="no">nil</span> <span class="ss">&#39;font</span><span class="p">)</span> <span class="nv">charset</span>
</span></span><span class="line"><span class="cl">                          <span class="p">(</span><span class="nf">font-spec</span> <span class="nb">:family</span> <span class="nv">chinese</span> <span class="nb">:size</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">size-pair</span><span class="p">))))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">emacs-step-font-size</span> <span class="p">(</span><span class="nv">step</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Increase/Decrease emacs&#39;s font size.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">scale-steps</span> <span class="nv">emacs-font-size-pair-list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&lt;</span> <span class="nv">step</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">scale-steps</span> <span class="p">(</span><span class="nf">reverse</span> <span class="nv">scale-steps</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">emacs-font-size-pair</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">cadr</span> <span class="p">(</span><span class="nf">member</span> <span class="nv">emacs-font-size-pair</span> <span class="nv">scale-steps</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">              <span class="nv">emacs-font-size-pair</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">when</span> <span class="nv">emacs-font-size-pair</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;emacs font size set to %.1f&#34;</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">emacs-font-size-pair</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">set-font</span> <span class="nv">emacs-english-font</span> <span class="nv">emacs-cjk-font</span> <span class="nv">emacs-font-size-pair</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">increase-emacs-font-size</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Decrease emacs&#39;s font-size acording emacs-font-size-pair-list.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nv">emacs-step-font-size</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">defun</span> <span class="nv">decrease-emacs-font-size</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;Increase emacs&#39;s font-size acording emacs-font-size-pair-list.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="p">(</span><span class="nv">emacs-step-font-size</span> <span class="mi">-1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">list-faces-sample-text</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nf">concat</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;ABCDEFTHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz\n&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="s">&#34;11223344556677889900       壹貳參肆伍陸柒捌玖零&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="nf">window-system</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; setup change size font, base on emacs-font-size-pair-list</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M-=&#34;</span><span class="p">)</span> <span class="ss">&#39;increase-emacs-font-size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-M--&#34;</span><span class="p">)</span> <span class="ss">&#39;decrease-emacs-font-size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; setup default english font and cjk font</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">emacs-english-font</span> <span class="s">&#34;Iosevka&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">emacs-cjk-font</span> <span class="s">&#34;LXGW WenKai Mono&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">emacs-font-size-pair</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">13</span> <span class="o">.</span> <span class="mi">14</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq</span> <span class="nv">emacs-font-size-pair-list</span> <span class="o">&#39;</span><span class="p">((</span> <span class="mi">5</span> <span class="o">.</span>  <span class="mi">6</span><span class="p">)</span> <span class="p">(</span><span class="mi">10</span> <span class="o">.</span> <span class="mi">12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">(</span><span class="mi">13</span> <span class="o">.</span> <span class="mi">16</span><span class="p">)</span> <span class="p">(</span><span class="mi">15</span> <span class="o">.</span> <span class="mi">18</span><span class="p">)</span> <span class="p">(</span><span class="mi">17</span> <span class="o">.</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">(</span><span class="mi">19</span> <span class="o">.</span> <span class="mi">22</span><span class="p">)</span> <span class="p">(</span><span class="mi">20</span> <span class="o">.</span> <span class="mi">24</span><span class="p">)</span> <span class="p">(</span><span class="mi">21</span> <span class="o">.</span> <span class="mi">26</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">(</span><span class="mi">24</span> <span class="o">.</span> <span class="mi">28</span><span class="p">)</span> <span class="p">(</span><span class="mi">26</span> <span class="o">.</span> <span class="mi">32</span><span class="p">)</span> <span class="p">(</span><span class="mi">28</span> <span class="o">.</span> <span class="mi">34</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                    <span class="p">(</span><span class="mi">30</span> <span class="o">.</span> <span class="mi">36</span><span class="p">)</span> <span class="p">(</span><span class="mi">34</span> <span class="o">.</span> <span class="mi">40</span><span class="p">)</span> <span class="p">(</span><span class="mi">36</span> <span class="o">.</span> <span class="mi">44</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">  <span class="c1">;; Setup font size based on emacs-font-size-pair</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">set-font</span> <span class="nv">emacs-english-font</span> <span class="nv">emacs-cjk-font</span> <span class="nv">emacs-font-size-pair</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-font</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-font.el ends here</span>
</span></span></code></pre></div><h3 id="init-corfu-dot-el">init-corfu.el<a hidden class="anchor" aria-hidden="true" href="#init-corfu-dot-el">¶</a></h3>
<p>增加了 <code>kind-icon</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elisp" data-lang="elisp"><span class="line"><span class="cl"><span class="c1">;;; init-corfu.el --- Interactive completion in buffers -*- lexical-binding: t -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Commentary:</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; Code:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">;; WAITING: haskell-mode sets tags-table-list globally, breaks tags-completion-at-point-function</span>
</span></span><span class="line"><span class="cl"><span class="c1">;; TODO Default sort order should place [a-z] before punctuation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">tab-always-indent</span> <span class="ss">&#39;complete</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;orderless</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;vertico</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;orderless</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-styles</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">orderless</span> <span class="nv">basic</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-category-defaults</span> <span class="no">nil</span>
</span></span><span class="line"><span class="cl">      <span class="nv">completion-category-overrides</span> <span class="no">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">setq</span> <span class="nv">completion-cycle-threshold</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;corfu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">corfu-auto</span> <span class="no">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">corfu-quit-no-match</span> <span class="ss">&#39;separator</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="ss">&#39;global-corfu-mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;corfu-doc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;corfu</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;corfu-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">corfu-doc-mode</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">;; TODO: https://github.com/jdtsmith/kind-icon</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">maybe-require-package</span> <span class="ss">&#39;kind-icon</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;corfu</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;corfu-margin-formatters</span> <span class="nf">#&#39;</span><span class="nv">kind-icon-margin-formatter</span><span class="p">)</span> <span class="c1">; Enable `kind-icon&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;init-corfu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">;;; init-corfu.el ends here</span>
</span></span></code></pre></div><h2 id="export">Export<a hidden class="anchor" aria-hidden="true" href="#export">¶</a></h2>
<p>对于只需要导出某个 header 下的内容的需求，只需要在 header 上加上 <code>:export:</code> 即可。</p>
<h3 id="markdown-file">Markdown file<a hidden class="anchor" aria-hidden="true" href="#markdown-file">¶</a></h3>
<p>这里用的是 <a href="https://github.com/kawabata/ox-pandoc">ox-pandoc</a>， ~M-x org-pandoc-export-as-gfm~算是我找到最符合 MarkDown 语法的转换了，Emacs 自己的转换会将 Table 转换成 HTML 标签的格式。</p>
<h3 id="hugo">Hugo<a hidden class="anchor" aria-hidden="true" href="#hugo">¶</a></h3>
<p>在文件头部添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#+HUGO_BASE_DIR: ~/Dropbox/hugo/
</span></span><span class="line"><span class="cl">#+HUGO_SECTION: posts/main
</span></span><span class="line"><span class="cl">#+HUGO_WEIGHT: auto
</span></span><span class="line"><span class="cl">#+HUGO_AUTO_SET_LASTMOD: t
</span></span></code></pre></div><p>需要导出为 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时<sup id="fnref1:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><p>需要导出为块级 <code>&lt;mark&gt;&lt;/mark&gt;</code> 时，也就是前后的空格不进行 trim。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+header</span><span class="c">: :trim-pre nil :trim-post nil</span>
</span></span><span class="line"><span class="cl"><span class="c">#+begin_mark</span>
</span></span><span class="line"><span class="cl">marked text
</span></span><span class="line"><span class="cl"><span class="c">#+end_mark</span>
</span></span></code></pre></div><h3 id="latex">Latex<a hidden class="anchor" aria-hidden="true" href="#latex">¶</a></h3>
<h4 id="dependency">Dependency<a hidden class="anchor" aria-hidden="true" href="#dependency">¶</a></h4>
<p>需要安装 texlive</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install texlive
</span></span></code></pre></div><h4 id="latex-语法">Latex 语法<a hidden class="anchor" aria-hidden="true" href="#latex-语法">¶</a></h4>
<p><a href="/posts/main/20220616162256-latex/">Latex 语法</a></p>
<h4 id="pdf-导出报错">PDF 导出报错<a hidden class="anchor" aria-hidden="true" href="#pdf-导出报错">¶</a></h4>
<ul>
<li><code>Unicode character 考 (U+8003) not set up for use with LaTeX.</code> 是因为 Latex 本身不支持中文。</li>
</ul>
<h4 id="中文-pdf-导出设置">中文 PDF 导出设置<a hidden class="anchor" aria-hidden="true" href="#中文-pdf-导出设置">¶</a></h4>
<ol>
<li>使用 <a href="https://github.com/ElegantLaTeX/ElegantPaper">ElegantPaper</a>，需要将 elegantpaper.cls 文件放在 org 目录下。</li>
<li>安装依赖</li>
</ol>
<p>代码块需要用到 <code>minted</code>​，需要用到 <code>pygments</code> 作为依赖。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">brew install pygments
</span></span></code></pre></div><ol>
<li>导出文件头部增加</li>
</ol>
<!--listend-->
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-org" data-lang="org"><span class="line"><span class="cl"><span class="cs">#+LATEX_COMPILER</span><span class="c">: xelatex</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+LATEX_CLASS</span><span class="c">: elegantpaper</span>
</span></span><span class="line"><span class="cl"><span class="cs">#+OPTIONS</span><span class="c">: prop:t</span>
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://orgmode.org/manual/Tracking-your-habits.html">Tracking your habits</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://gist.github.com/kepi/2f4acc3cc93403c75fbba5684c5d852d">Hierarchical archiving for Org-mode</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://ox-hugo.scripter.co/doc/org-special-blocks/">Org Special Blocks</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


    


   

   

   

   

   

   
	  
   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

<hr>

  <div class="bl-section">
	<h4 style="color: var(--secondary);">Links to this note</h4>
	<div class="backlinks">
	  <ul>
	   
		  <li><a href="/posts/main/20220508195206-personal_knowledge_wiki/">Personal Knowledge Wiki</a></li>
	   
	 </ul>
	</div>
  </div>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="next" href="https://sheerwill.live/posts/main/20220506185941-tools_to_increase_productivity_and_efficiency/">
    <span class="title">Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select: text;"><line x1="5" y1="12" x2="19" y2="12" style="user-select: text;"></line><polyline points="12 5 19 12 12 19" style="user-select: text;"></polyline></svg>
    </span>
    <br>
    <span>Tools to Increase Productivity and Efficiency</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2022 <a href="https://sheerwill.live/">Lucius | Braindump</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '1' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>

<script src="/js/instantclick.min.js" data-no-instant
></script>
<script data-no-instant>
  
  
  
  
  
  
  InstantClick.init();
</script>
</body>

</html>
